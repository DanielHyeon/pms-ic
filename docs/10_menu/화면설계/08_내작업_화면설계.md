# 08. 내 작업(My Work) 화면설계

> 작성일: 2026-02-08
> 버전: v2.1
> 라우트: `/my-work`
> 필요 Capability: `view_my_work` (DEV 전용)
> 기본 Preset: `DEV_EXECUTION` (유일)
> 노드 역할: **Detail** (상세 노드 -- 개인 작업 집중 뷰)
> 우선순위: 4
>
> **v2.1 변경**: Sprint(07) 교차 검토 기반 일관성 개선 14항목 반영.
> FilterSpec/ViewState 분리(tab은 ViewState, 필터와 혼합 금지),
> Scope 2-tier 패턴 적용(securityKeys + explorationKeys),
> Reliability 3-tuple 표준화(completeness: {overall, breakdown?}, warnings: {code,message,severity}[]),
> Scope echo(모든 API 응답에 scope: {projectId} 포함),
> `sprintId=current` 의미 토큰 서버 치환 규칙 확정,
> Capability 조회/변경 분리(DevReader는 read-only, DEV만 상태변경/시간기록/코멘트),
> AI Navigation fallbackNodeId 추가(비DEV Preset의 "내 작업" 요청 시 대체 목적지),
> TaskStatus/StoryStatus 상태 사전 교차 참조 명시,
> 이벤트 기반 refetch 정책(상태 변경 직후 1회 강제 refetch + 폴링 보조),
> Sprint Close → My Work 영향 범위 명시(Task 리셋 → overdue/today 급변 방어),
> 깨지기 쉬운 곳 5→7 확장, DoD v2.1 항목 추가.

---

## 1. 화면 개요

### 1.1 목적

내 작업은 **"오늘 나는 무엇을 해야 하는가?"**에 대한 단일 답변을 제공한다.
DEV(개발자) 전용 **개인 커맨드 센터**로, 모든 스프린트에 걸친 내 할당 Task,
내 이슈, 내 산출물 대기 건을 한 화면에서 확인하고 즉시 상태를 변경할 수 있다.

> **핵심 분리 원칙**: 칸반 보드(`/kanban`)는 **팀 전체 흐름의 시각화**이고,
> 내 작업(`/my-work`)은 **개인 실행 집중 뷰**이다.
> 칸반에서 `assignee=me` 필터를 거는 것과 내 작업 화면은 다르다:
> - 내 작업은 **여러 스프린트에 걸친 Task를 통합**한다.
> - 내 작업은 **오늘 할 일 / 이번 스프린트 / 지연 건** 3개의 시간 렌즈를 제공한다.
> - 내 작업은 **빠른 상태 변경, 시간 기록, 코멘트 추가**를 인라인으로 지원한다.

> **접근 제한**: 이 화면은 **DEV / DevReader 역할만 접근 가능**하다 (00_총괄 SS3 참조).
> Sponsor, PMO, PM, Customer PM, 외부 감사는 이 메뉴 자체가 숨김 처리된다.
> PM의 "내 할 일"은 대시보드 PM_WORK Preset의 Action Items 위젯이 담당한다.

### 1.2 설계 원칙

| 원칙 | 설명 |
|------|------|
| **DEV 전용** | `view_my_work` Capability가 없으면 메뉴 숨김 + 라우트 가드 |
| **개인 집중** | 팀 전체가 아닌 "나"에게 할당된 항목만 표시 |
| **시간 렌즈 3종** | Today's Focus / This Sprint / Overdue로 시간 기준 분류 |
| **Task Card = Story 맥락** | Task 카드에 상위 Story 컨텍스트를 항상 표시 |
| **Quick Action 우선** | 상태 변경, 시간 기록, 코멘트를 인라인으로 즉시 실행 |
| **FilterSpec = 온톨로지** | 필터 키가 AI/URL/백엔드 공통 스키마로 통합 |
| **알림 통합** | 지연 알림, 리뷰 요청, 할당 알림을 화면 내 배지로 표시 |
| **단일 Preset** | DEV_EXECUTION만 의미 있음 -- 다른 Preset은 이 화면에 접근 불가 |
| **상태 사전 = 제품 공통** | TaskStatus(TODO/IN_PROGRESS/IN_REVIEW/DONE/BLOCKED)와 StoryStatus는 칸반/스프린트/백로그 전 화면 공통. 07_스프린트 1.2 참조 |
| **FilterSpec ≠ ViewState** | 필터(status/sprintId/priority/dueDate/q)는 FilterSpec, 탭(tab)은 ViewState로 분리 -- AI/백엔드는 FilterSpec만 신뢰 |
| **Reliability Envelope = 표준** | `asOf` + `completeness: {overall, breakdown?}` + `warnings: {code,message,severity}[]` 형태로 모든 API 응답에 적용 |
| **Capability 조회/변경 분리** | DevReader는 `view_my_work`(read-only), DEV만 상태 변경/시간 기록/코멘트 수행 가능 -- 서버에서 역할별 행위 검증 |
| **이벤트 기반 refetch** | 상태 변경/Sprint 전이 직후 1회 강제 refetch + 폴링은 보조. optimistic update로 체감 즉시 반영 |

### 1.3 핵심 질문 -> 위젯 매핑

| 사용자 질문 | 위젯 / 영역 | 설명 |
|-----------|-----------|------|
| "오늘 내가 뭘 해야 하지?" | Today's Focus 섹션 | 오늘 마감 + 진행 중 Task 우선 표시 |
| "내 진행 중 작업이 몇 개야?" | 상단 KPI | my_tasks_in_progress 카운트 |
| "지연된 건 있어?" | Overdue 섹션 + KPI | my_overdue_count + 지연 Task 리스트 |
| "이번 스프린트 내 남은 작업은?" | This Sprint 섹션 | 현재 Sprint 범위 내 할당 Task |
| "내 BLOCKED 건은?" | 필터 + KPI | my_blocked_count + status=BLOCKED 필터 |
| "오늘 몇 개 완료했어?" | 상단 KPI | my_completed_today 카운트 |
| "남은 Story Point는?" | 상단 KPI | my_sprint_remaining_sp |
| "내가 보고한 이슈는?" | My Issues 탭 | reporter=me 이슈 목록 |
| "리뷰 요청 들어온 거 있어?" | 알림 배지 + Today's Focus | review_request 알림 통합 |
| "Task를 Done으로 바꿔줘" | Quick Action | 인라인 상태 변경 버튼 |

---

## 2. MenuOntology 노드

### 2.1 타입 확정

| 항목 | 값 | 비고 |
|------|-----|------|
| `nodeId` | `"my-work"` | - |
| `domain` | `"execution"` | 칸반/스프린트와 동일 도메인 |
| `nodeRole` | `"detail"` | 행동/필터 질문에 +10 가산 |
| `requiredCaps` | `["view_my_work"]` | DEV 전용 |
| `defaultPreset` | `"DEV_EXECUTION"` | 유일한 Preset |
| `priority` | `4` | 칸반(3), 스프린트(3.5) 다음 |
| Preset 정책 | DEV_EXECUTION 1종만 | EXEC/PMO/PM/CUSTOMER/AUDIT는 이 화면 접근 불가 |

### 2.2 FilterSpec 정의

FilterSpec은 **이 화면이 지원하는 필터 스키마**를 온톨로지 내부에 선언한다.
AI가 딥링크를 생성할 때, URL 파라미터 문자열이 아니라 **FilterSpec 키 기반 필터 객체**를 반환한다.

```typescript
/** 내 작업 필터 스키마 -- 온톨로지 내장 */
export interface MyWorkFilterSpec {
  /** Task 상태 */
  status?: "TODO" | "IN_PROGRESS" | "IN_REVIEW" | "DONE" | "BLOCKED";
  /** Sprint ID (특정 스프린트 범위) */
  sprintId?: string;
  /** 우선순위 */
  priority?: "CRITICAL" | "HIGH" | "MEDIUM" | "LOW";
  /** 마감일 기준 필터 */
  dueDate?: "today" | "this_week" | "overdue" | "no_date";
  /** 자유 검색어 */
  q?: string;
}
```

**FilterSpec URL 직렬화 규칙**:

```typescript
/** FilterSpec -> URL 직렬화 */
function serializeMyWorkFilter(filter: MyWorkFilterSpec): URLSearchParams {
  const params = new URLSearchParams();
  for (const [key, value] of Object.entries(filter)) {
    if (value === undefined || value === null) continue;
    params.set(key, String(value));
  }
  return params;
}

/** URL -> FilterSpec 역직렬화 */
function deserializeMyWorkFilter(params: URLSearchParams): MyWorkFilterSpec {
  const filter: MyWorkFilterSpec = {};
  const enumKeys = {
    status: ["TODO", "IN_PROGRESS", "IN_REVIEW", "DONE", "BLOCKED"],
    priority: ["CRITICAL", "HIGH", "MEDIUM", "LOW"],
    dueDate: ["today", "this_week", "overdue", "no_date"],
  } as const;

  for (const [key, value] of params.entries()) {
    // enum validation -- invalid value -> skip (silent drop)
    if (key in enumKeys) {
      if ((enumKeys as any)[key].includes(value)) {
        (filter as any)[key] = value;
      }
      continue;
    }
    // string keys (sprintId, q)
    if (["sprintId", "q"].includes(key)) {
      (filter as any)[key] = value;
    }
    // unknown keys -> silent drop (forward compatibility)
  }
  return filter;
}
```

| 규칙 | 예시 | 설명 |
|------|------|------|
| enum은 화이트리스트 검증 | `?status=IN_PROGRESS` | 유효하지 않은 값은 silent drop |
| 복수 필터는 `&`로 연결 | `?status=BLOCKED&priority=HIGH` | 표준 query string |
| 미지 키는 무시 | `?futureKey=x` -> 무시 | 하위 호환성 보장 |
| userId는 서버 강제 | 클라이언트 전송 불가 | JWT에서 추출 (위변조 방지) |
| `sprintId=current` 의미 토큰 | `?sprintId=current` | 서버가 ACTIVE Sprint ID로 치환. 응답에는 실제 Sprint ID 반환 (v2.1) |

**FilterSpec vs ViewState 분리 (v2.1)**:

> **원칙**: FilterSpec은 **데이터 필터**(AI/백엔드/딥링크가 신뢰하는 스키마),
> ViewState는 **UI 표시 상태**(탭, 정렬, 패널 모드)로 분리한다.
> 탭(tab)을 FilterSpec에 넣으면 "필터=온톨로지" 의미가 흐려지고,
> AI가 생성한 딥링크에 tab이 강제되어 예기치 않은 탭 전환이 발생할 수 있다.

```typescript
/** UI 표시 상태 -- FilterSpec과 분리 (v2.1) */
export interface MyWorkViewState {
  /** 활성 탭 -- URL에는 반영하되 FilterSpec과 별도 직렬화 */
  tab?: "today" | "sprint" | "overdue" | "all" | "issues";
  /** 정렬 기준 (향후 확장) */
  sortBy?: "priority" | "dueDate" | "status";
}

/** URL 직렬화 = FilterSpec + ViewState 합산 */
// ?status=BLOCKED&tab=all  -> filter: {status:"BLOCKED"}, viewState: {tab:"all"}
// AI는 filter만 반환, tab은 프론트가 자동 결정
// AI 딥링크: /my-work?status=BLOCKED -> 프론트가 tab="all"로 매핑 (KPI_FILTER_MAP 참조)
```

| 구분 | 키 | 소유자 | AI 신뢰 |
|------|-----|--------|---------|
| FilterSpec | status, sprintId, priority, dueDate, q | AI + 백엔드 + 프론트 공통 | O |
| ViewState | tab, sortBy | 프론트 전용 | X -- AI는 tab을 직접 지정하지 않음 |

### 2.3 My Work 노드 (확정본)

```typescript
const myWorkNode: MenuOntologyNodeV2 = {
  nodeId: "my-work",
  label: "내 작업",
  route: "/my-work",
  icon: "AssignmentIndRounded",
  domain: "execution",
  nodeRole: "detail",              // detail 노드 -- 행동/필터 질문에 +10 가산

  requiredCaps: ["view_my_work"],

  // --- 인텐트: 14개 ---
  intents: [
    // Ask 계열 -- 조회/질문
    "ask_my_work",                 // "내 작업 보여줘"
    "ask_my_tasks_status",         // "내 작업 현황 알려줘"
    "ask_my_today",                // "오늘 내가 뭘 해야 해?"
    "ask_my_overdue",              // "지연된 작업 있어?"
    "ask_my_sprint_tasks",         // "이번 스프린트 내 작업은?"
    "ask_my_blocked",              // "내 BLOCKED 건 있어?"
    "ask_my_completed_today",      // "오늘 몇 개 완료했어?"
    "ask_my_remaining_sp",         // "남은 Story Point 얼마야?"
    "ask_my_issues",               // "내 이슈 보여줘"
    "ask_my_review_requests",      // "리뷰 요청 들어온 거 있어?"
    // Do 계열 -- 실행/변경
    "do_move_task",                // "Task를 Done으로 바꿔줘"
    "do_log_hours",                // "시간 기록해줘"
    "do_add_comment",              // "코멘트 추가해줘"
    "do_create_issue",             // "이슈 등록해줘"
  ],
  canonicalQuestions: [
    "오늘 내가 뭘 해야 하지?",
    "내 작업 현황 알려줘",
    "지연된 작업 있어?",
    "이번 스프린트 내 남은 작업은?",
    "내 BLOCKED 건 보여줘",
    "오늘 몇 개 완료했어?",
    "남은 Story Point 얼마야?",
    "내가 보고한 이슈 보여줘",
    "리뷰 요청 들어온 거 있어?",
    "Task를 Done으로 바꾸고 싶어",
    "시간 기록하고 싶어",
    "진행 중인 내 작업 보여줘",
  ],
  entities: ["Task", "Sprint", "Story", "Issue", "User"],
  keywords: [
    "내 작업", "할 일", "내 태스크", "오늘", "지연", "마감",
    "my work", "my task", "today", "overdue", "due",
    "진행 중", "리뷰", "블로킹", "완료", "남은",
    "in progress", "blocked", "review", "done", "remaining",
    "시간 기록", "코멘트", "hours", "comment",
  ],
  metrics: [
    "my_tasks_total",
    "my_tasks_in_progress",
    "my_blocked_count",
    "my_overdue_count",
    "my_completed_today",
    "my_sprint_remaining_sp",
  ],

  // --- FilterSpec 온톨로지 내장 ---
  filterSpec: {
    keys: ["status", "sprintId", "priority", "dueDate", "q"],
    defaults: {},
  },

  defaultPreset: "DEV_EXECUTION",
  presetPolicies: [
    {
      preset: "DEV_EXECUTION",
      ui: {
        density: "standard",
        defaultRightPanel: "closed",
        highlight: {
          metricKeys: [
            "my_tasks_in_progress",
            "my_overdue_count",
            "my_blocked_count",
            "my_completed_today",
            "my_sprint_remaining_sp",
          ],
          widgetKeys: [
            "KPI_IN_PROGRESS",
            "KPI_OVERDUE",
            "KPI_BLOCKED",
            "KPI_COMPLETED_TODAY",
            "KPI_REMAINING_SP",
            "TODAY_FOCUS",
            "THIS_SPRINT",
            "OVERDUE_LIST",
            "MY_ISSUES",
            "NOTIFICATIONS",
          ],
        },
      },
      suggestedActions: [
        {
          key: "go_kanban",
          label: "칸반 보드",
          requiredCaps: ["view_kanban"],
          targetNodeId: "kanban",
        },
        {
          key: "go_sprint",
          label: "스프린트",
          requiredCaps: ["view_sprints"],
          targetNodeId: "sprints",
        },
        {
          key: "create_issue",
          label: "이슈 등록",
          requiredCaps: ["view_issues"],
          targetNodeId: "issues",
        },
      ],
    },
    // EXEC_SUMMARY / PMO_CONTROL / PM_WORK / CUSTOMER_APPROVAL / AUDIT_EVIDENCE
    // -- 이 Preset들은 내 작업 화면에 접근 불가 (메뉴 숨김 + 라우트 가드)
    // -- 만약 URL 직접 접근 시 /dashboard로 리다이렉트
  ],

  // --- DeepLink: routeTemplate 표준 (:param 형태) ---
  deepLinks: [
    {
      pattern: "/my-work?status=:status",
      description: "상태별 내 작업 필터",
      requiredParams: ["status"],
    },
    {
      pattern: "/my-work?dueDate=overdue",
      description: "지연 작업 필터",
      requiredParams: [],
    },
    {
      pattern: "/my-work?dueDate=today",
      description: "오늘 마감 작업 필터",
      requiredParams: [],
    },
    {
      pattern: "/my-work?sprintId=:sprintId",
      description: "스프린트별 내 작업 필터",
      requiredParams: ["sprintId"],
    },
    {
      pattern: "/my-work?priority=:priority",
      description: "우선순위별 내 작업 필터",
      requiredParams: ["priority"],
    },
    {
      pattern: "/my-work?status=BLOCKED",
      description: "BLOCKED 내 작업",
      requiredParams: [],
    },
  ],

  // --- 가상 노드: 딥링크를 온톨로지 2계층으로 승격 ---
  virtualNodes: [
    {
      virtualId: "my-work.today",
      label: "오늘 할 일",
      routeTemplate: "/my-work?dueDate=today",
      requiredParams: [],
      intents: ["ask_my_today"],
      description: "오늘 마감이거나 오늘 집중해야 할 Task 목록",
    },
    {
      virtualId: "my-work.overdue",
      label: "지연 작업",
      routeTemplate: "/my-work?dueDate=overdue",
      requiredParams: [],
      intents: ["ask_my_overdue"],
      description: "마감일이 지난 미완료 Task 목록",
    },
    {
      virtualId: "my-work.blocked",
      label: "블로킹 작업",
      routeTemplate: "/my-work?status=BLOCKED",
      requiredParams: [],
      intents: ["ask_my_blocked"],
      description: "BLOCKED 상태인 내 할당 Task 목록",
    },
    {
      virtualId: "my-work.in-progress",
      label: "진행 중",
      routeTemplate: "/my-work?status=IN_PROGRESS",
      requiredParams: [],
      intents: ["ask_my_tasks_status"],
      description: "현재 진행 중인 내 Task 목록",
    },
    {
      virtualId: "my-work.sprint",
      label: "이번 스프린트",
      routeTemplate: "/my-work?sprintId=current",
      requiredParams: [],
      intents: ["ask_my_sprint_tasks"],
      description: "현재 활성 Sprint 범위 내 할당 Task",
    },
  ],

  // --- Scope: 2-tier (v2.1) ---
  scope: {
    securityKeys: ["projectId", "userId"],   // tenant boundary -- 서버가 JWT + projectId 교차 검증, userId는 JWT 강제
    explorationKeys: ["sprintId", "status", "priority", "dueDate"], // user drill-down -- 프론트 필터 전용, 보안 경계 아님
  },

  priority: 4,
};
```

---

## 3. 화면 구조

### 3.1 Right Panel panelMode 정의

```typescript
/** Right Panel 모드 -- 내 작업 화면 */
export type MyWorkPanelMode =
  | "none"            // Right Panel 숨김 (기본)
  | "task-detail"     // Task 상세 정보 (Task 카드 클릭)
  | "issue-detail"    // Issue 상세 정보 (Issue 행 클릭)
  | "time-log";       // 시간 기록 패널 (시간 기록 CTA 클릭)
```

**panelMode 결정 규칙**:

| 컨텍스트 | panelMode |
|---------|-----------|
| 페이지 최초 진입 | `"none"` |
| Task 카드 클릭 | `"task-detail"` |
| Issue 행 클릭 | `"issue-detail"` |
| 시간 기록 버튼 클릭 | `"time-log"` |
| Right Panel 닫기 | `"none"` |

### 3.2 메인 레이아웃 (`/my-work`)

```
+--------------------------------------------------------------+
|  Page Header                                                  |
|  내 작업  [ AI 보험금지급심사 구축 ]                          |
|  [ 필터 v ]  [ 검색 :mag: ]                [ :bell: 알림 3건 ]|
+--------------------------------------------------------------+
|                                                              |
|  +---------+  +---------+  +---------+  +---------+          |
|  | 진행중  |  | 지연    |  | 블로킹  |  | 오늘    |          |
|  |   3건   |  |   2건   |  |   1건   |  | 완료    |          |
|  | In Prog |  | Overdue |  | Blocked |  |   4건   |          |
|  +---------+  +---------+  +---------+  +---------+          |
|                                                              |
|  +---------+  +---------+                                    |
|  | 전체    |  | Sprint  |                                    |
|  | Task    |  | 남은 SP |                                    |
|  |  12건   |  |  18 SP  |                                    |
|  +---------+  +---------+                                    |
|                                                              |
|  +- 필터 바 -------------------------------------------+     |
|  | 상태: [전체v] 스프린트: [전체v] 우선순위: [전체v]    |     |
|  | 마감: [전체v]  [검색...]                             |     |
|  +-----------------------------------------------------+     |
|                                                              |
|  +- [Today] [Sprint] [Overdue] [All] [Issues] ----------+    |
|  |                                                       |    |
|  |  == Today's Focus (3건) ============================  |    |
|  |                                                       |    |
|  |  +- Task Card ------------------------------------+   |    |
|  |  | TSK-155  API 응답 코드 리뷰                     |   |    |
|  |  | Story: S-42 실시간 스코어링 API                 |   |    |
|  |  | Sprint: Sprint-5  |  Priority: HIGH             |   |    |
|  |  | Status: [IN_REVIEW v]  |  Est: 4h  |  Due: D-0  |   |    |
|  |  | [Log Hours] [Comment] [-> Kanban]               |   |    |
|  |  +------------------------------------------------+   |    |
|  |                                                       |    |
|  |  +- Task Card ------------------------------------+   |    |
|  |  | TSK-161  단위테스트 작성 - 탐지룰 모듈          |   |    |
|  |  | Story: S-43 탐지룰 관리                         |   |    |
|  |  | Sprint: Sprint-5  |  Priority: MEDIUM           |   |    |
|  |  | Status: [IN_PROGRESS v]  |  Est: 6h  |  Due: D-2|   |    |
|  |  | [Log Hours] [Comment] [-> Kanban]               |   |    |
|  |  +------------------------------------------------+   |    |
|  |                                                       |    |
|  |  +- Task Card (BLOCKED) --------------------------+   |    |
|  |  | TSK-170  외부 API 연동 - 보험사 인터페이스       |   |    |
|  |  | Story: S-44 외부 시스템 연동                     |   |    |
|  |  | Sprint: Sprint-5  |  Priority: CRITICAL         |   |    |
|  |  | Status: [BLOCKED v]  |  Est: 8h  |  Due: D-1    |   |    |
|  |  | :warn: ISS-042 외부 API 인증 이슈               |   |    |
|  |  | [Log Hours] [Comment] [Issue ->]                |   |    |
|  |  +------------------------------------------------+   |    |
|  |                                                       |    |
|  |  == This Sprint (Sprint-5, Day 7/14) ==============   |    |
|  |                                                       |    |
|  |  TODO (2건)                                           |    |
|  |  +- TSK-180  로깅 모듈 구현    | LOW  | 3h | -       |    |
|  |  +- TSK-181  에러핸들링 개선   | MED  | 4h | D-5     |    |
|  |                                                       |    |
|  |  IN_PROGRESS (1건)                                    |    |
|  |  +- TSK-161  (위 카드와 동일, 축약 표시)              |    |
|  |                                                       |    |
|  |  IN_REVIEW (1건)                                      |    |
|  |  +- TSK-155  (위 카드와 동일, 축약 표시)              |    |
|  |                                                       |    |
|  |  DONE This Sprint (4건)                               |    |
|  |  +- TSK-148, TSK-149, TSK-151, TSK-153 (접힘)        |    |
|  |                                                       |    |
|  |  == Overdue (2건) =================================   |    |
|  |                                                       |    |
|  |  +- Task Card (OVERDUE) --------------------------+   |    |
|  |  | TSK-138  데이터 마이그레이션 스크립트            |   |    |
|  |  | Story: S-38 데이터 이관                          |   |    |
|  |  | Sprint: Sprint-4  |  Priority: HIGH             |   |    |
|  |  | Status: [IN_PROGRESS v]  |  Due: 2일 지연        |   |    |
|  |  | :warn: 마감 초과 -- 즉시 조치 필요               |   |    |
|  |  | [Log Hours] [Comment] [-> Kanban]               |   |    |
|  |  +------------------------------------------------+   |    |
|  |                                                       |    |
|  |  +- Task Card (OVERDUE) --------------------------+   |    |
|  |  | TSK-141  레거시 API 호환성 테스트                |   |    |
|  |  | Story: S-39 하위호환성 보장                      |   |    |
|  |  | Sprint: Sprint-4  |  Priority: MEDIUM           |   |    |
|  |  | Status: [TODO v]  |  Due: 5일 지연               |   |    |
|  |  | [Log Hours] [Comment] [-> Kanban]               |   |    |
|  |  +------------------------------------------------+   |    |
|  |                                                       |    |
|  +-------------------------------------------------------+    |
|                                                              |
+--------------------------------------------------------------+
```

### 3.3 Task 상세 Right Panel (`panelMode: "task-detail"`)

```
+- Right Panel (420px) --------------------------+
|                                                 |
|  TSK-155  API 응답 코드 리뷰            [X 닫기]|
|                                                 |
|  == 기본 정보 ================================  |
|  Status:     IN_REVIEW                          |
|  Priority:   HIGH                               |
|  Assignee:   김개발 (me)                        |
|  Sprint:     Sprint-5 (Day 7/14)                |
|  Due Date:   2026-02-08 (D-0)                   |
|  Est Hours:  4h                                 |
|  Act Hours:  3.5h                               |
|                                                 |
|  == Story 컨텍스트 ============================  |
|  S-42  실시간 스코어링 API                      |
|  Epic: E-01  사기탐지 AI 모델                   |
|  Story Point: 8 SP                              |
|  Story Status: IN_PROGRESS                      |
|  [Story 상세 보기 ->]                           |
|                                                 |
|  == 설명 =====================================  |
|  API 응답 코드에 대한 코드리뷰를 수행한다.       |
|  - 에러 핸들링 패턴 확인                        |
|  - 응답 시간 기준 충족 여부 검증                |
|                                                 |
|  == 시간 기록 =================================  |
|  | 날짜       | 시간 | 메모              |      |
|  |------------|------|-------------------|      |
|  | 2026-02-06 | 2.0h | 초기 리뷰         |      |
|  | 2026-02-07 | 1.5h | 피드백 반영       |      |
|  | 합계       | 3.5h |                   |      |
|  [+ 시간 추가]                                  |
|                                                 |
|  == 코멘트 ===================================  |
|  [김개발] 2/7 14:30                             |
|  에러 핸들링 패턴 수정 완료, 재리뷰 요청        |
|                                                 |
|  [박시니어] 2/7 16:00                           |
|  LGTM. 응답시간 테스트 결과 첨부해주세요        |
|                                                 |
|  [코멘트 입력...]            [전송]             |
|                                                 |
|  == 연관 항목 =================================  |
|  Issues:  ISS-042 (BLOCKED 원인)                |
|  Deliverables: 없음                             |
|                                                 |
|  == Quick Actions =============================  |
|  [ Status: IN_REVIEW -> DONE v ]                |
|  [ Log Hours ]  [ 칸반에서 보기 ]               |
|                                                 |
+-------------------------------------------------+
```

### 3.4 Issues 탭 레이아웃

```
+- [Today] [Sprint] [Overdue] [All] [*Issues*] ---+
|                                                   |
|  == 내 이슈 (할당됨: 3건, 보고: 2건) =========   |
|                                                   |
|  --- 내가 담당하는 이슈 (3건) ----------------    |
|                                                   |
|  | ID      | 제목               | 심각도  | 상태 |
|  |---------|-------------------|---------|------|
|  | ISS-042 | 외부 API 인증 이슈 | blocker | OPEN |
|  | ISS-038 | 로깅 포맷 불일치   | major   | OPEN |
|  | ISS-035 | 메모리 누수 의심   | minor   | OPEN |
|                                                   |
|  --- 내가 보고한 이슈 (2건) ------------------    |
|                                                   |
|  | ID      | 제목               | 심각도  | 상태 |
|  |---------|-------------------|---------|------|
|  | ISS-040 | 테스트DB 접속 불가 | major   | OPEN |
|  | ISS-036 | 빌드 실패 이슈     | major   | DONE |
|                                                   |
|  [+ 이슈 등록]                                    |
|                                                   |
+---------------------------------------------------+
```

---

## 4. Preset별 차이

### 4.1 DEV_EXECUTION (유일한 유효 Preset)

| 영역 | 표시 내용 |
|------|---------|
| KPI Row | 진행 중(my_tasks_in_progress), 지연(my_overdue_count), 블로킹(my_blocked_count), 오늘 완료(my_completed_today), 전체 Task(my_tasks_total), 남은 SP(my_sprint_remaining_sp) |
| 탭 구조 | Today / Sprint / Overdue / All / Issues 5개 탭 |
| Task 카드 | Story 컨텍스트 + Task 상세 + 상태 드롭다운 + 예상 시간 + 마감일 |
| Quick Actions | 상태 변경, 시간 기록, 코멘트 추가 |
| Right Panel | panelMode 기반 -- 기본 closed, Task 클릭 시 상세 |
| 알림 통합 | 지연 알림, 리뷰 요청, 할당 알림 배지 |

### 4.2 비접근 Preset 처리

| Preset | 동작 |
|--------|------|
| EXEC_SUMMARY | 메뉴 숨김 + URL 직접 접근 시 `/dashboard` 리다이렉트 |
| PMO_CONTROL | 메뉴 숨김 + URL 직접 접근 시 `/dashboard` 리다이렉트 |
| PM_WORK | 메뉴 숨김 + URL 직접 접근 시 `/dashboard` 리다이렉트 (PM의 "내 할 일"은 대시보드 Action Items) |
| CUSTOMER_APPROVAL | 메뉴 숨김 + URL 직접 접근 시 `/dashboard` 리다이렉트 |
| AUDIT_EVIDENCE | 메뉴 숨김 + URL 직접 접근 시 `/audit/evidence` 리다이렉트 |

```typescript
// Route Guard
<ProtectedRoute
  path="/my-work"
  requiredCapabilities={["view_my_work"]}
  fallbackRoute="/dashboard"
>
  <MyWorkPage />
</ProtectedRoute>
```

---

## 5. 데이터 구조 / API

### 5.1 My Work Summary API

```
GET /api/my-work/summary?projectId={projectId}
```

> **userId는 서버 강제**: JWT 토큰에서 추출. 클라이언트가 userId를 전송하지 않음.
> 이는 "다른 사람의 내 작업" 조회를 원천 차단한다.

```typescript
interface MyWorkSummary {
  user: {
    id: string;
    name: string;
    partId: string;
    partName: string;
  };

  // --- KPI 메트릭 ---
  stats: {
    /** 전체 할당 Task 수 (DONE 제외) */
    myTasksTotal: number;
    /** 현재 진행 중 (IN_PROGRESS) */
    myTasksInProgress: number;
    /** BLOCKED 상태 Task */
    myBlockedCount: number;
    /** 마감 초과 미완료 Task */
    myOverdueCount: number;
    /** 오늘 DONE 처리한 Task */
    myCompletedToday: number;
    /**
     * 현재 Sprint 내 남은 SP (내 할당분)
     * v2.1: Sprint 서비스의 remainingPoints를 단일 소스로 하되,
     * assignee=me 필터를 적용한 값 (서버 내 조인/집계).
     * Sprint 서비스와 이중 계산하지 않는다.
     */
    mySprintRemainingSp: number;
    /** 현재 Sprint 내 전체 SP (내 할당분) */
    mySprintTotalSp: number;
  };

  // --- 현재 Sprint 정보 ---
  currentSprint?: {
    id: string;
    name: string;
    day: number;
    totalDays: number;
    startDate: string;
    endDate: string;
    status: "PLANNING" | "ACTIVE" | "COMPLETED";
  };

  // --- 알림/배지 ---
  notifications: {
    overdueAlerts: number;
    reviewRequests: number;
    newAssignments: number;
    totalUnread: number;
  };

  // --- reliability 3-tuple (v2.1 standardized) ---
  asOf: string;
  completeness: {
    overall: number;                              // 0~1
    breakdown?: Record<string, number>;           // e.g., { tasks: 1.0, issues: 0.8, sprints: 1.0 }
  };
  warnings: {
    code: string;
    message: string;
    severity: "info" | "warn" | "critical";
  }[];

  // --- scope echo (v2.1) ---
  scope: { projectId: string };
}
```

### 5.2 My Tasks API

```
GET /api/my-work/tasks?projectId={projectId}&status={status}&sprintId={sprintId}&priority={priority}&dueDate={dueDate}&q={q}
```

```typescript
interface MyTasksResponse {
  tasks: MyTaskItem[];
  pagination: {
    total: number;
    page: number;
    pageSize: number;
    totalPages: number;
  };
  groupedBySection: {
    todayFocus: MyTaskItem[];
    thisSprint: {
      todo: MyTaskItem[];
      inProgress: MyTaskItem[];
      inReview: MyTaskItem[];
      doneThisSprint: MyTaskItem[];
    };
    overdue: MyTaskItem[];
    otherSprints: MyTaskItem[];
  };

  // --- reliability 3-tuple (v2.1 standardized) ---
  asOf: string;
  completeness: { overall: number; breakdown?: Record<string, number> };
  warnings: { code: string; message: string; severity: "info" | "warn" | "critical" }[];

  // --- scope echo (v2.1) ---
  scope: { projectId: string };
}

interface MyTaskItem {
  // Task 기본 정보
  id: string;                   // TSK-155
  title: string;
  description?: string;
  status: "TODO" | "IN_PROGRESS" | "IN_REVIEW" | "DONE" | "BLOCKED";
  priority: "CRITICAL" | "HIGH" | "MEDIUM" | "LOW";

  // 시간/마감
  estimatedHours?: number;
  actualHours: number;
  dueDate?: string;             // ISO date
  daysRemaining?: number;       // 음수 = 지연 일수
  isOverdue: boolean;

  // Story 컨텍스트
  story: {
    id: string;                 // S-42
    title: string;
    storyPoints?: number;
    status: string;
  };

  // Epic 컨텍스트
  epic: {
    id: string;                 // E-01
    title: string;
  };

  // Sprint 컨텍스트
  sprint?: {
    id: string;
    name: string;
    day: number;
    totalDays: number;
  };

  // 관련 항목
  linkedIssues: {
    id: string;
    title: string;
    severity: string;
    status: string;
  }[];
  linkedDeliverables: {
    id: string;
    title: string;
    status: string;
  }[];

  // 알림
  hasReviewRequest: boolean;
  isNewAssignment: boolean;
  assignedAt: string;           // ISO datetime

  // 시간 기록 요약
  timeLog: {
    totalLogged: number;
    lastLoggedAt?: string;
    entries: TimeLogEntry[];
  };

  // 코멘트 수
  commentCount: number;
  lastCommentAt?: string;
}

interface TimeLogEntry {
  id: string;
  date: string;                 // ISO date
  hours: number;
  note?: string;
  createdAt: string;
}
```

### 5.3 Today's Focus 판정 로직

> **서버 측 판정**: "오늘 집중해야 할 Task" 목록은 서버가 결정한다.

```typescript
/**
 * Today's Focus 포함 조건 (OR):
 * 1. dueDate === today (오늘 마감)
 * 2. status === IN_PROGRESS (현재 진행 중)
 * 3. status === IN_REVIEW && hasReviewRequest (리뷰 요청 받음)
 * 4. status === BLOCKED (차단됨 -- 해제 필요)
 * 5. isOverdue === true (지연 중 -- 즉시 조치 필요)
 *
 * 정렬 기준:
 * 1. isOverdue DESC (지연 먼저)
 * 2. priority ASC (CRITICAL > HIGH > MEDIUM > LOW)
 * 3. daysRemaining ASC (마감 임박 순)
 *
 * --- Sprint Close 영향 (v2.1) ---
 * Sprint Close 시 Task 리셋(IN_PROGRESS/IN_REVIEW -> TODO)이 발생하면:
 * - 리셋된 Task의 dueDate가 과거면 즉시 isOverdue=true로 전환 -> Overdue 섹션 폭증 가능
 * - Story가 READY로 복귀하면 Task의 sprintId가 null이 됨 -> "This Sprint" 섹션에서 사라짐
 * - 서버는 Sprint Close 트랜잭션 완료 후 my-work 관련 캐시를 일괄 무효화
 * - 프론트는 Sprint Close 이벤트 수신 시 ["my-work","tasks"], ["my-work","summary"] 즉시 refetch
 * - 알림 폭발 방지: Close로 인한 일괄 변경은 개별 status_change 알림 대신
 *   "Sprint-N 종료: Task N건 리셋" 요약 알림 1건으로 집약 (07_스프린트 5.2.2 참조)
 */
```

### 5.4 My Issues API

```
GET /api/my-work/issues?projectId={projectId}
```

```typescript
interface MyIssuesResponse {
  assigned: MyIssueItem[];    // 내가 담당하는 이슈
  reported: MyIssueItem[];    // 내가 보고한 이슈
  watching: MyIssueItem[];    // 내가 관심 등록한 이슈
  stats: {
    assignedCount: number;
    reportedCount: number;
    watchingCount: number;
  };
  asOf: string;
}

interface MyIssueItem {
  id: string;                 // ISS-042
  title: string;
  severity: "blocker" | "critical" | "major" | "minor";
  status: "OPEN" | "IN_PROGRESS" | "RESOLVED" | "CLOSED";
  relation: "assignee" | "reporter" | "watcher";
  reportedBy: string;
  assignedTo?: string;
  createdAt: string;
  linkedTasks: string[];      // 연관된 Task ID 목록
}
```

### 5.5 Task Status Update API

```
PATCH /api/my-work/tasks/:taskId/status
```

```typescript
interface TaskStatusUpdateRequest {
  status: "TODO" | "IN_PROGRESS" | "IN_REVIEW" | "DONE" | "BLOCKED";
  /** BLOCKED 시 사유 */
  blockReason?: string;
  /** BLOCKED 연결 이슈 */
  linkedIssueId?: string;
}

interface TaskStatusUpdateResponse {
  task: MyTaskItem;

  /**
   * Story 상태 자동 전이 발생 시 (v2.1: 교차 문서 계약)
   *
   * StoryStatus 표준 enum: READY | IN_SPRINT | IN_PROGRESS | IN_REVIEW | DONE | CANCELLED
   *   - 07_스프린트 설계와 동일한 enum을 사용한다 (상태 사전 통일).
   *   - REVIEW는 IN_REVIEW로 표기 (전 화면 통일, v2.1).
   *
   * 자동 전이 규칙 (서버 트랜잭션):
   *   - Task 1개 이상 IN_PROGRESS → Story: IN_SPRINT → IN_PROGRESS
   *   - 모든 Task DONE → Story: → IN_REVIEW (리뷰 대기)
   *   - Story의 모든 Task가 DONE이고 리뷰 완료 → Story: → DONE
   *   - 이 규칙은 칸반/스프린트/내작업 어디서 변경하든 동일하게 적용 (서버 단일 소스)
   */
  storyTransition?: {
    storyId: string;
    previousStatus: string;
    newStatus: string;
    reason: string;
  };

  /** 칸반 보드 동기화 -- 칸반과 상태 일관성 보장 */
  kanbanSync: {
    columnFrom: string;
    columnTo: string;
    timestamp: string;
  };

  // --- scope echo (v2.1) ---
  scope: { projectId: string };
}
```

**상태 전이 에러 계약**:

```typescript
type TaskStatusErrorCode =
  | "INVALID_TRANSITION"         // 허용되지 않는 상태 전이
  | "BLOCKED_REQUIRES_REASON"    // BLOCKED 전환 시 사유 필수
  | "DONE_REQUIRES_ALL_SUBTASKS" // 하위 항목 미완료
  | "CONCURRENT_MODIFICATION"    // 동시 수정 감지
  | "PART_ACCESS_DENIED";        // 다른 파트 Task 수정 시도
```

| 에러 코드 | HTTP | 프론트 대응 |
|----------|------|-----------|
| `INVALID_TRANSITION` | 409 | "이 상태로의 전환은 허용되지 않습니다" + 허용 상태 목록 표시 |
| `BLOCKED_REQUIRES_REASON` | 422 | 사유 입력 모달 표시 |
| `DONE_REQUIRES_ALL_SUBTASKS` | 409 | "하위 항목을 먼저 완료하세요" + 미완료 항목 목록 |
| `CONCURRENT_MODIFICATION` | 409 | 데이터 새로고침 후 재시도 안내 |
| `PART_ACCESS_DENIED` | 403 | "접근 권한이 없습니다" |

### 5.6 Time Log API

```
POST /api/my-work/tasks/:taskId/time-log
```

```typescript
interface TimeLogRequest {
  date: string;               // ISO date (미래 날짜 불가)
  hours: number;              // 0.5 ~ 24 (0.5 단위)
  note?: string;              // 200자 이내
}

interface TimeLogResponse {
  entry: TimeLogEntry;
  updatedTask: {
    actualHours: number;      // 누적 시간
    estimatedHours?: number;  // 예상 시간
    overEstimate: boolean;    // actualHours > estimatedHours
  };
}
```

```
GET /api/my-work/tasks/:taskId/time-log
```

```typescript
interface TimeLogListResponse {
  taskId: string;
  entries: TimeLogEntry[];
  summary: {
    totalHours: number;
    estimatedHours?: number;
    variance: number;         // actual - estimated
  };
}
```

### 5.7 Task Comment API

```
POST /api/my-work/tasks/:taskId/comments
```

```typescript
interface TaskCommentRequest {
  content: string;            // 1000자 이내
  mentionedUserIds?: string[];
}

interface TaskCommentResponse {
  comment: {
    id: string;
    taskId: string;
    authorId: string;
    authorName: string;
    content: string;
    mentionedUsers: { id: string; name: string }[];
    createdAt: string;
  };
}
```

```
GET /api/my-work/tasks/:taskId/comments
```

```typescript
interface TaskCommentsListResponse {
  taskId: string;
  comments: TaskComment[];
  total: number;
}
```

### 5.8 Notifications API

```
GET /api/my-work/notifications?projectId={projectId}
```

```typescript
interface MyWorkNotifications {
  items: NotificationItem[];
  stats: {
    overdueAlerts: number;
    reviewRequests: number;
    newAssignments: number;
    totalUnread: number;
  };
}

interface NotificationItem {
  id: string;
  type: "overdue_alert" | "review_request" | "assignment" | "mention" | "status_change";
  title: string;
  description: string;
  relatedTaskId?: string;
  relatedIssueId?: string;
  createdAt: string;
  isRead: boolean;
}
```

---

## 6. 컴포넌트 분해

### 6.1 폴더 구조

```
features/
  my-work/
    pages/
      MyWorkPage.tsx                 <- 메인 페이지 (탭 구조 + KPI Row)
    components/
      // KPI & 헤더
      MyWorkKpiRow.tsx               <- 상단 KPI 카드 Row (6개 메트릭)
      MyWorkToolbar.tsx              <- 상단 툴바 (필터, 검색, 알림 배지)
      MyWorkFilters.tsx              <- 필터 바 (FilterSpec 기반)
      NotificationBadge.tsx          <- 알림 배지 (미읽은 건수)

      // 탭 구조
      MyWorkTabs.tsx                 <- Today / Sprint / Overdue / All / Issues 탭
      TodayFocusSection.tsx          <- Today's Focus 섹션
      ThisSprintSection.tsx          <- This Sprint 섹션 (status별 그룹)
      OverdueSection.tsx             <- Overdue 섹션
      AllTasksSection.tsx            <- All Tasks 섹션 (전체 목록)
      MyIssuesSection.tsx            <- Issues 섹션

      // Task 카드
      TaskCard.tsx                   <- Task 카드 (Story 컨텍스트 포함)
      TaskCardCompact.tsx            <- Task 카드 축약 (Sprint 섹션 내 DONE 등)
      TaskStatusDropdown.tsx         <- 인라인 상태 변경 드롭다운
      TaskPriorityBadge.tsx          <- 우선순위 배지
      TaskDueDateBadge.tsx           <- 마감일 배지 (D-day / 지연일 표시)
      OverdueBanner.tsx              <- 지연 경고 배너 (카드 내부)
      BlockedReasonTag.tsx           <- BLOCKED 사유 + 연결 이슈 표시
      ReviewRequestBadge.tsx         <- 리뷰 요청 배지

      // Right Panel
      MyWorkRightPanel.tsx           <- panelMode 분기 렌더링
      TaskDetailPanel.tsx            <- panelMode: "task-detail"
      IssueDetailPanel.tsx           <- panelMode: "issue-detail"
      TimeLogPanel.tsx               <- panelMode: "time-log"

      // Task 상세
      TaskBasicInfo.tsx              <- Task 기본 정보 카드
      StoryContextCard.tsx           <- Story/Epic 컨텍스트 표시
      TimeLogTable.tsx               <- 시간 기록 테이블
      TimeLogForm.tsx                <- 시간 기록 입력 폼
      TaskCommentList.tsx            <- 코멘트 목록
      TaskCommentForm.tsx            <- 코멘트 입력 폼
      LinkedItemsList.tsx            <- 연관 이슈/산출물 목록

      // Issue
      MyIssueTable.tsx               <- 내 이슈 테이블 (할당/보고/관심)
      IssueCreateQuickForm.tsx       <- 이슈 빠른 등록 폼

      // Quick Actions
      QuickActionBar.tsx             <- 빠른 액션 바 (상태변경, 시간기록, 코멘트)
      StatusTransitionDialog.tsx     <- 상태 전이 확인 다이얼로그
      BlockedReasonDialog.tsx        <- BLOCKED 사유 입력 다이얼로그

      // 상태 표시
      SprintProgressIndicator.tsx    <- Sprint 진행 표시 (Day N/M)
      TaskStatusBadge.tsx            <- Task 상태 배지 (5값)

    api/
      myWorkApi.ts                   <- My Work API 호출
    hooks/
      useMyWorkSummary.ts            <- Summary TanStack Query
      useMyTasks.ts                  <- Tasks TanStack Query (필터/탭 연동)
      useMyIssues.ts                 <- Issues TanStack Query
      useTaskStatusUpdate.ts         <- 상태 변경 Mutation
      useTimeLog.ts                  <- 시간 기록 Mutation + Query
      useTaskComments.ts             <- 코멘트 Mutation + Query
      useMyWorkNotifications.ts      <- 알림 Query
      useMyWorkPanelMode.ts          <- Right Panel 모드 상태 관리
      useMyWorkFilters.ts            <- FilterSpec 기반 필터 상태
      useMyWorkTabs.ts               <- 탭 상태 관리
```

### 6.2 MyWorkPage.tsx 구조

```typescript
function MyWorkPage() {
  const { viewMode } = useAccessContext();
  const { panelMode, setPanelMode } = useMyWorkPanelMode();
  const { activeTab, setActiveTab } = useMyWorkTabs();
  const { filters, setFilters } = useMyWorkFilters();

  // DEV_EXECUTION 전용 -- 다른 Preset은 ProtectedRoute에서 차단
  if (viewMode !== "DEV_EXECUTION") {
    return <Navigate to="/dashboard" />;
  }

  // panelMode에 따른 Right Panel 컴포넌트 결정
  const rightPanelContent = useMemo(() => {
    switch (panelMode) {
      case "none":          return undefined;
      case "task-detail":   return <TaskDetailPanel />;
      case "issue-detail":  return <IssueDetailPanel />;
      case "time-log":      return <TimeLogPanel />;
      default:              return undefined;
    }
  }, [panelMode]);

  return (
    <PageLayout
      header={<MyWorkToolbar />}
      rightPanel={rightPanelContent}
      rightPanelDefault="closed"
    >
      <MyWorkKpiRow />
      <MyWorkFilters
        filterSpec={myWorkNode.filterSpec}
        filters={filters}
        onFilterChange={setFilters}
      />
      <MyWorkTabs activeTab={activeTab} onTabChange={setActiveTab}>
        {activeTab === "today" && (
          <TodayFocusSection
            onTaskClick={(task) => {
              setPanelMode("task-detail");
              setSelectedTask(task);
            }}
          />
        )}
        {activeTab === "sprint" && (
          <ThisSprintSection
            onTaskClick={(task) => {
              setPanelMode("task-detail");
              setSelectedTask(task);
            }}
          />
        )}
        {activeTab === "overdue" && (
          <OverdueSection
            onTaskClick={(task) => {
              setPanelMode("task-detail");
              setSelectedTask(task);
            }}
          />
        )}
        {activeTab === "all" && (
          <AllTasksSection
            filters={filters}
            onTaskClick={(task) => {
              setPanelMode("task-detail");
              setSelectedTask(task);
            }}
          />
        )}
        {activeTab === "issues" && (
          <MyIssuesSection
            onIssueClick={(issue) => {
              setPanelMode("issue-detail");
              setSelectedIssue(issue);
            }}
          />
        )}
      </MyWorkTabs>
    </PageLayout>
  );
}
```

### 6.3 TaskCard.tsx 구조

```typescript
interface TaskCardProps {
  task: MyTaskItem;
  variant: "full" | "compact";   // full = Today/Overdue, compact = Sprint 목록
  onStatusChange: (taskId: string, newStatus: TaskStatus) => void;
  onLogHours: (taskId: string) => void;
  onComment: (taskId: string) => void;
  onClick: (task: MyTaskItem) => void;
}

function TaskCard({ task, variant, onStatusChange, onLogHours, onComment, onClick }: TaskCardProps) {
  const { mutate: updateStatus } = useTaskStatusUpdate();

  return (
    <Card
      onClick={() => onClick(task)}
      className={cn(
        "task-card",
        task.isOverdue && "task-card--overdue",
        task.status === "BLOCKED" && "task-card--blocked",
        task.hasReviewRequest && "task-card--review-request",
      )}
    >
      {/* Row 1: Task ID + Title */}
      <div className="task-card__header">
        <span className="task-id">{task.id}</span>
        <span className="task-title">{task.title}</span>
        {task.hasReviewRequest && <ReviewRequestBadge />}
        {task.isNewAssignment && <NewAssignmentBadge />}
      </div>

      {/* Row 2: Story Context */}
      <StoryContextCard story={task.story} epic={task.epic} />

      {/* Row 3: Meta (Sprint, Priority, Due) */}
      <div className="task-card__meta">
        {task.sprint && <SprintProgressIndicator sprint={task.sprint} />}
        <TaskPriorityBadge priority={task.priority} />
        <TaskDueDateBadge dueDate={task.dueDate} daysRemaining={task.daysRemaining} />
      </div>

      {/* Row 4: Status + Estimated Hours */}
      <div className="task-card__status">
        <TaskStatusDropdown
          currentStatus={task.status}
          onChange={(newStatus) => onStatusChange(task.id, newStatus)}
        />
        <span>Est: {task.estimatedHours}h | Act: {task.actualHours}h</span>
      </div>

      {/* Row 5: Alerts (BLOCKED, Overdue) */}
      {task.status === "BLOCKED" && task.linkedIssues.length > 0 && (
        <BlockedReasonTag issue={task.linkedIssues[0]} />
      )}
      {task.isOverdue && <OverdueBanner daysOverdue={Math.abs(task.daysRemaining!)} />}

      {/* Row 6: Quick Actions (full variant only) */}
      {variant === "full" && (
        <QuickActionBar
          onLogHours={() => onLogHours(task.id)}
          onComment={() => onComment(task.id)}
          kanbanLink={`/kanban?taskId=${task.id}`}
        />
      )}
    </Card>
  );
}
```

---

## 7. AI Navigation 연동

### 7.1 virtualNode 우선 반환 정책

AI는 가능한 경우 raw filter 대신 **virtualId를 우선 반환**한다.

```typescript
/** AI virtualNode 매칭 우선순위 */
const MY_WORK_VIRTUAL_NODE_PRIORITY: {
  virtualId: string;
  matchFilter: Partial<MyWorkFilterSpec>;
}[] = [
  { virtualId: "my-work.today",       matchFilter: { dueDate: "today" } },
  { virtualId: "my-work.overdue",     matchFilter: { dueDate: "overdue" } },
  { virtualId: "my-work.blocked",     matchFilter: { status: "BLOCKED" } },
  { virtualId: "my-work.in-progress", matchFilter: { status: "IN_PROGRESS" } },
  { virtualId: "my-work.sprint",      matchFilter: { sprintId: "current" } },
];

function resolveMyWorkNavigation(filter: MyWorkFilterSpec): AiMyWorkNavigation {
  // 1. virtualNode 매칭 시도 (우선)
  for (const vn of MY_WORK_VIRTUAL_NODE_PRIORITY) {
    if (isSubsetMatch(vn.matchFilter, filter)) {
      return { targetNodeId: "my-work", virtualId: vn.virtualId, filter, reason: "..." };
    }
  }
  // 2. 매칭 실패 시 raw filter 반환
  return { targetNodeId: "my-work", filter, reason: "..." };
}
```

### 7.2 AI 질문 -> 화면 이동 (FilterSpec + virtualId)

```typescript
/** AI가 반환하는 네비게이션 추천 (v2.1: fallbackNodeId 추가) */
interface AiMyWorkNavigation {
  targetNodeId: "my-work";
  virtualId?: string;
  filter: MyWorkFilterSpec;
  reason: string;

  /**
   * v2.1: 권한상 이동 불가 시 대체 목적지.
   * 비DEV Preset에서 "내 작업" 관련 질문이 들어오면
   * targetNodeId가 아닌 fallbackNodeId로 라우팅한다.
   * PM의 "내 할 일"은 대시보드 Action Items로 안내.
   */
  fallbackNodeId?: string;
  /** fallback 사유 메시지 -- AI가 사용자에게 안내할 때 사용 */
  fallbackReason?: string;
}
```

| 질문 | AI 반환 | virtualId? | 설명 |
|------|--------|-----------|------|
| "오늘 내 할 일은?" | `{ dueDate: "today" }` | `my-work.today` | virtualId 우선 |
| "지연 작업 있어?" | `{ dueDate: "overdue" }` | `my-work.overdue` | virtualId 우선 |
| "BLOCKED 건 보여줘" | `{ status: "BLOCKED" }` | `my-work.blocked` | virtualId 우선 |
| "진행 중 작업은?" | `{ status: "IN_PROGRESS" }` | `my-work.in-progress` | virtualId 우선 |
| "이번 스프린트 작업" | `{ sprintId: "current" }` | `my-work.sprint` | virtualId 우선 |
| "CRITICAL 작업만" | `{ priority: "CRITICAL" }` | -- | raw filter |
| "TSK-155 상세" | 직접 이동 | -- | Task 클릭으로 Right Panel |

### 7.3 연관 화면 네비게이션

```
내 작업 화면에서 다른 화면으로의 네비게이션:

Task Card -> [칸반에서 보기]
  -> targetNodeId: "kanban", deepLinkParams: { taskId, assignee: "me" }
  -> resolve: /kanban?taskId=TSK-155

Task Card -> [Story 상세]
  -> targetNodeId: "backlog", deepLinkParams: { epicId: "E-01" }
  -> resolve: /backlog/epics/E-01

Issue Row -> [이슈 상세]
  -> targetNodeId: "issues", deepLinkParams: { issueId: "ISS-042" }
  -> resolve: /issues/ISS-042

Sprint 표시 -> [스프린트 상세]
  -> targetNodeId: "sprints", deepLinkParams: { sprintId }
  -> resolve: /sprints/sprint-5
```

### 7.4 AI Insight 위젯 (내 작업 맥락)

```typescript
interface AiMyWorkInsight {
  asOf: string;
  summary: string;               // "TSK-155 리뷰가 2일째 대기 중, TSK-170은 외부 API 이슈로 BLOCKED"
  severity: "info" | "warning" | "critical";

  drivers: {
    type: "metric" | "entity" | "event";
    label: string;
    value?: string;
    link?: {
      targetNodeId: string;
      label: string;
    };
  }[];

  nextActions: {
    label: string;
    targetNodeId: string;
    deepLinkParams?: Record<string, string>;
    reason: string;
  }[];
}
```

**렌더링 예시**:

```
+------------------------------------------+
|  AI Insight                    info-icon  |
|                                          |
|  TSK-155 리뷰 2일째 대기 중               |
|  TSK-170 외부 API 이슈로 BLOCKED         |
|                                          |
|  근거:                                   |
|  - Review Wait: 2일 (TSK-155)            |
|  - Linked Issue: ISS-042 (TSK-170)       |
|                                          |
|  추천 행동:                              |
|  1차: [-> 리뷰어에게 알림 보내기]          |
|  2차: [-> 이슈 관리에서 ISS-042 확인]      |
+------------------------------------------+
```

### 7.5 Hub 페널티 / Detail 보너스

내 작업 화면은 `nodeRole: "detail"`이므로:

```
Intent -> Node 스코어링:

"내 작업 보여줘"
  -> my-work (detail): 80 + 10 = 90   <- Detail 보너스
  -> dashboard (hub):  60 - 20 = 40   <- Hub 페널티
  -> 최종: /my-work

"전체 상태 알려줘"
  -> dashboard (hub):  85 + 15 = 100  <- Hub 보너스
  -> my-work (detail): 30 + 10 = 40
  -> 최종: /dashboard
```

### 7.6 Preset별 do intent 라우팅 (내 작업 관련)

내 작업은 DEV_EXECUTION 전용이므로, 다른 Preset에서 "내 작업" 관련 질문이 들어오면:

| Preset | "내 할 일 보여줘" -> AI 라우팅 | fallbackNodeId | 이유 |
|--------|-------------------------------|---------------|------|
| DEV_EXECUTION | -> `targetNodeId: "my-work"` | -- | DEV는 내 작업 화면으로 |
| PM_WORK | -> `targetNodeId: "my-work"`, fallback: `"dashboard"` | `"dashboard"` | PM의 "내 할 일"은 대시보드 Action Items -- AI가 "PM의 할 일은 대시보드 Action Items에서 확인 가능합니다"로 안내 |
| PMO_CONTROL | -> `targetNodeId: "my-work"`, fallback: `"dashboard"` | `"dashboard"` | PMO는 프로젝트 레벨 |
| EXEC_SUMMARY | -> `targetNodeId: "my-work"`, fallback: `"dashboard"` | `"dashboard"` | Sponsor는 KPI 중심 |

> **v2.1 라우팅 규칙**: AI가 "내 작업"이라는 표현을 들었을 때:
>
> - DEV_EXECUTION이면 → `my-work` 직행
> - 그 외 Preset이면 → targetNodeId는 `my-work`이지만, 권한 검증 실패 시 `fallbackNodeId`로 대체
> - 대체 시 AI는 용어를 바꿔 안내: "PM의 '내 할 일'은 **대시보드의 Action Items**에서 확인 가능합니다"
> - 이렇게 하면 AI가 접근 불가 화면을 추천하는 혼란을 방지한다.

---

## 8. 인터랙션 상세

### 8.1 Task 상태 변경 (인라인)

```
TaskStatusDropdown 클릭
  -> 허용된 상태 목록 표시 (현재 상태 기준 전이 규칙)
  -> 상태 선택
  -> IF 새 상태 === BLOCKED:
       BlockedReasonDialog 표시 (사유 + 이슈 연결)
       확인 -> PATCH /api/my-work/tasks/:taskId/status
  -> IF 새 상태 === DONE:
       StatusTransitionDialog 표시 ("완료로 변경하시겠습니까?")
       확인 -> PATCH /api/my-work/tasks/:taskId/status
  -> ELSE:
       즉시 PATCH /api/my-work/tasks/:taskId/status
  -> 응답의 storyTransition 확인
       IF 존재 -> Toast: "Story S-42도 IN_PROGRESS로 변경됨"
  -> 응답의 kanbanSync 확인
       -> 칸반 보드 캐시 무효화 (TanStack Query invalidate)
```

**허용된 상태 전이**:

```
TODO         -> IN_PROGRESS, BLOCKED
IN_PROGRESS  -> IN_REVIEW, BLOCKED, TODO
IN_REVIEW    -> DONE, IN_PROGRESS, BLOCKED
DONE         -> IN_REVIEW (재오픈)
BLOCKED      -> (이전 상태로 복원) TODO, IN_PROGRESS, IN_REVIEW
```

### 8.2 시간 기록 (인라인)

```
[Log Hours] 버튼 클릭
  -> panelMode: "time-log" -> Right Panel 표시
  -> TimeLogForm:
       날짜: 오늘 (기본, 달력 선택 가능, 미래 불가)
       시간: 0.5h 단위 입력 (0.5 ~ 24)
       메모: 자유 텍스트 (200자)
  -> 전송 -> POST /api/my-work/tasks/:taskId/time-log
  -> 성공 -> TimeLogTable 갱신 + Task 카드 actualHours 업데이트
  -> 경고: actualHours > estimatedHours 시 "예상 시간 초과" 배지
```

### 8.3 코멘트 추가

```
[Comment] 버튼 클릭
  -> panelMode: "task-detail" -> Right Panel 표시 (코멘트 영역 스크롤)
  -> TaskCommentForm:
       내용: 자유 텍스트 (1000자)
       @멘션: 팀원 자동완성
  -> 전송 -> POST /api/my-work/tasks/:taskId/comments
  -> 성공 -> 코멘트 목록 갱신 + commentCount 증가
```

### 8.4 탭 전환

```
Today 탭 -> 오늘 집중 Task 목록 (Today's Focus 로직)
Sprint 탭 -> 현재 Sprint 내 Task (status별 그룹)
Overdue 탭 -> 지연 Task 목록 (마감 초과)
All 탭 -> 전체 Task 목록 (필터 적용)
Issues 탭 -> 내 이슈 (할당/보고/관심)

탭 전환 시 (v2.1: ViewState 분리):
  -> URL 업데이트: /my-work?tab={tabName} (tab은 ViewState, FilterSpec이 아님)
  -> 필터 유지 (탭 간 필터 공유) -- URL 예: /my-work?status=BLOCKED&tab=all
  -> 선택된 Task 초기화 (panelMode -> "none")
  -> AI 딥링크에는 tab이 포함되지 않음 -- 프론트가 filter 기반으로 tab을 자동 결정:
       filter.dueDate === "today"    -> tab = "today"
       filter.dueDate === "overdue"  -> tab = "overdue"
       filter.sprintId === "current" -> tab = "sprint"
       filter.status 지정             -> tab = "all"
       그 외                          -> tab = 현재 유지 또는 "today" (기본)
```

### 8.5 KPI 카드 클릭 -> 필터 활성화

```typescript
/** KPI 카드 클릭 시 활성화되는 필터 매핑 */
const MY_WORK_KPI_FILTER_MAP: Record<string, {
  filter: Partial<MyWorkFilterSpec>;
  tab: MyWorkTab;
}> = {
  KPI_IN_PROGRESS:     { filter: { status: "IN_PROGRESS" }, tab: "all" },
  KPI_OVERDUE:         { filter: { dueDate: "overdue" }, tab: "overdue" },
  KPI_BLOCKED:         { filter: { status: "BLOCKED" }, tab: "all" },
  KPI_COMPLETED_TODAY: { filter: { status: "DONE" }, tab: "all" },
  KPI_TOTAL:           { filter: {}, tab: "all" },
  KPI_REMAINING_SP:    { filter: {}, tab: "sprint" },
};
```

**인터랙션 흐름**:

```
1. KPI 카드 클릭
2. MY_WORK_KPI_FILTER_MAP에서 filter + tab 조회
3. 탭 전환 + 필터 적용
4. URL 업데이트 (serializeMyWorkFilter)
5. 동일 카드 재클릭 시 필터 해제 (toggle 동작)
```

### 8.6 알림 배지 인터랙션

```
알림 배지 클릭 (Page Header)
  -> 알림 드롭다운 표시
  -> 알림 항목 클릭:
       overdue_alert -> Overdue 탭 전환 + 해당 Task 하이라이트
       review_request -> Today 탭 전환 + 해당 Task 하이라이트
       assignment -> Today 탭 전환 + 해당 Task 하이라이트
       mention -> Right Panel task-detail 열기 (코멘트 섹션)
       status_change -> 해당 Task 하이라이트
  -> 읽음 처리 -> PATCH /api/my-work/notifications/:id/read
```

### 8.7 데이터 새로고침

| 항목 | 주기 |
|------|------|
| KPI 카드 | 3분 자동 갱신 (TanStack Query `refetchInterval`) |
| Task 목록 | 페이지 진입 시 + 필터 변경 시 + 상태 변경 후 |
| Issues 목록 | Issues 탭 진입 시 (캐시 5분) |
| 알림 | 1분 자동 갱신 (폴링) |
| Time Log | Right Panel 열릴 때 + 새 기록 추가 후 |
| 코멘트 | Right Panel 열릴 때 + 새 코멘트 추가 후 |
| 전체 | 수동 새로고침 (Page Header 새로고침 아이콘) |

**이벤트 기반 refetch 정책 (v2.1)**:

> 폴링만으로는 상태 변경 후 체감 지연이 발생한다. 아래 이벤트 발생 시 즉시 1회 강제 refetch를 수행하고,
> 폴링은 **보조 수단**으로만 유지한다.

| 이벤트 | 즉시 refetch 대상 | optimistic update |
|--------|------------------|-------------------|
| Task 상태 변경 성공 | `["my-work","tasks"]`, `["my-work","summary"]`, `["kanban"]` | Task 카드 상태 즉시 반영 |
| Sprint Close 수신 | `["my-work","tasks"]`, `["my-work","summary"]`, `["sprints"]`, `["backlog"]` | -- (대량 변경이므로 서버 응답 대기) |
| 시간 기록 성공 | `["my-work","tasks"]` (해당 Task만) | actualHours 즉시 반영 |
| 코멘트 추가 성공 | -- (Right Panel 내부만) | commentCount +1 즉시 반영 |
| Story 전이 발생 | `["sprints"]`, `["backlog"]` | Toast로 전이 내용 표시 |
| 알림 읽음 처리 | `["my-work","notifications"]` | 배지 카운트 -1 즉시 반영 |

### 8.8 칸반 보드와의 상태 동기화

> **핵심**: 내 작업에서 Task 상태를 변경하면 칸반 보드에도 반영되어야 한다.
> 서버가 단일 소스 오브 트루스이므로, 캐시 무효화 전략으로 동기화한다.

```typescript
// Task 상태 변경 성공 후
function onTaskStatusUpdateSuccess(response: TaskStatusUpdateResponse) {
  // 1. 내 작업 목록 캐시 무효화
  queryClient.invalidateQueries({ queryKey: ["my-work", "tasks"] });
  queryClient.invalidateQueries({ queryKey: ["my-work", "summary"] });

  // 2. 칸반 보드 캐시 무효화 (사용자가 칸반으로 이동할 때 최신 데이터)
  queryClient.invalidateQueries({ queryKey: ["kanban"] });

  // 3. Sprint 캐시 무효화 (Story 전이 발생 시)
  if (response.storyTransition) {
    queryClient.invalidateQueries({ queryKey: ["sprints"] });
    queryClient.invalidateQueries({ queryKey: ["backlog"] });
  }

  // 4. Toast 알림
  toast.success(`${response.task.id} -> ${response.task.status}`);
  if (response.storyTransition) {
    toast.info(
      `${response.storyTransition.storyId}: ` +
      `${response.storyTransition.previousStatus} -> ${response.storyTransition.newStatus}`
    );
  }
}

/**
 * v2.1: Sprint Close 이벤트 수신 시 캐시 무효화 범위
 *
 * Sprint Close는 대량 변경(Story 복귀 + Task 리셋)을 유발하므로,
 * 개별 Task 변경과 달리 광범위한 캐시 무효화가 필요하다.
 * 서버 이벤트 키 기반으로 한 번에 정리하여 프론트 invalidate 목록이 커지는 문제를 방지한다.
 */
function onSprintCloseEvent(event: SprintCloseEvent) {
  // 서버 이벤트 키: "sprint.closed" -> 아래 캐시 일괄 무효화
  const invalidateKeys = [
    ["my-work", "tasks"],     // Task 리셋으로 상태/섹션 변경
    ["my-work", "summary"],   // KPI 메트릭 변경 (overdue 폭증 가능)
    ["kanban"],               // 칸반 컬럼 재배치
    ["sprints"],              // Sprint 상태 변경
    ["backlog"],              // Story 복귀 (READY 풀)
  ];
  invalidateKeys.forEach(key =>
    queryClient.invalidateQueries({ queryKey: key })
  );

  // 요약 알림 1건 (개별 status_change 알림 대신)
  toast.info(
    `${event.sprintName} 종료: Task ${event.resetCount}건 리셋, ` +
    `Story ${event.returnedStoryCount}건 백로그 복귀`
  );
}
```

---

## 9. 반응형 대응

### 9.1 브레이크포인트별 레이아웃

| 너비 | KPI Row | Task 카드 | Right Panel | 필터 |
|------|---------|----------|-------------|------|
| >=1440px | 6열 가로 배치 (3+3) | Full 카드 (Story 컨텍스트 + Quick Actions) | Right Panel (30%) | 인라인 |
| 1280px | 3+3 2행 | Full 카드 | Drawer (toggle) | 인라인 |
| <=1024px | 3열 x 2행 | Compact 카드 (Quick Actions 접이식) | Drawer (overlay) | 접이식 |
| <=768px | 2열 x 3행 | Compact 카드 (Story 컨텍스트 축약) | Full Modal | 접이식 |

### 9.2 위젯 축소 규칙

- **>=1440px**: KPI 6개 가로 배치 (3+3 2행), Task 카드 Full, 탭 가로 배치
- **1280px**: KPI 3+3 2행, Task 카드 Full (Quick Actions 축약)
- **<=1024px**: KPI 3열 x 2행, Task 카드 Compact, Quick Actions 접이식 메뉴
- **<=768px**: KPI 2열 x 3행, Task 카드 최소, 탭 스크롤 가능

### 9.3 모바일 터치 인터랙션

| 제스처 | 동작 |
|--------|------|
| Task 카드 탭 | Right Panel -> "task-detail" (Full Modal) |
| Task 카드 길게 누르기 | Quick Action 메뉴 표시 |
| 좌 스와이프 | 상태를 다음 단계로 전환 (TODO -> IN_PROGRESS 등) |
| 우 스와이프 | Quick Action 메뉴 표시 |

---

## 10. 깨지기 쉬운 곳 체크리스트

> 이 7곳을 막으면 안정화가 빨라진다 (v2.1: 5→7).

| # | 위험 지점 | 해결책 | 검증 방법 |
|---|----------|--------|----------|
| 1 | **칸반-내작업 상태 동기화** | 서버가 단일 소스 오브 트루스. 내 작업에서 상태 변경 시 `kanbanSync` 응답 확인 + TanStack Query 캐시 무효화 (`["kanban"]`, `["my-work"]` 모두 invalidate) | 내 작업에서 Task를 DONE으로 변경 후 칸반 보드로 이동 -> DONE 컬럼에 해당 카드 표시 확인. 반대 방향(칸반 -> 내 작업)도 동일 검증 |
| 2 | **userId 위변조 방지** | userId는 JWT에서 서버가 추출. API에 userId 파라미터 없음. 클라이언트가 다른 사용자의 작업을 조회할 수 없음 | API 요청에 userId를 쿼리 파라미터로 추가해도 서버가 무시하고 JWT의 userId를 사용하는지 확인 |
| 3 | **Today's Focus 판정 일관성** | 서버가 판정 (SS5.3). 클라이언트 시간대와 서버 시간대가 다를 수 있으므로, 서버 asOf 기준으로 "오늘"을 결정 | 서버 시간대 기준 자정 전후로 Today's Focus 목록이 정확히 전환되는지 확인 |
| 4 | **지연 건 실시간 갱신** | 마감일 경과는 3분 폴링으로 감지. 하루 1회 서버 배치가 `isOverdue` 플래그를 재계산하여 확정. 프론트는 `daysRemaining < 0`으로 즉시 표시하되, 서버 배치 결과와 최종 정합 | 마감 당일 23:59에 접속 -> D-0 표시. 다음 날 00:01에 새로고침 -> "1일 지연" 표시 확인 |
| 5 | **상태 전이 권한과 Story 자동 전이** | Task 상태 변경은 DEV 역할 + 본인 할당 Task만 가능 (서버 검증, v2.1: DevReader는 read-only). 다른 사람 Task 상태 변경 시도 시 403. Story 자동 전이(모든 Task DONE -> Story IN_REVIEW)는 서버 트랜잭션 | 다른 파트원의 Task ID로 상태 변경 API 호출 -> 403 반환 확인. DevReader로 상태 변경 시도 -> 403 확인. Story의 마지막 Task를 DONE으로 변경 -> Story 상태 자동 전이 확인 |
| 6 | **Sprint Close ↔ My Work 정합성** (v2.1) | Sprint Close로 Task가 대량 리셋(IN_PROGRESS/IN_REVIEW→TODO)될 때 My Work의 Today/Overdue 판정이 급변할 수 있다. 리셋된 Task의 dueDate가 과거면 overdue가 폭증. Close 이벤트는 개별 알림 대신 요약 알림 1건으로 집약 (알림 폭발 방지) | Sprint Close 직후 My Work 진입 -> overdue 건수가 리셋된 Task 수만큼 증가했는지 확인. 알림이 요약 1건인지 확인 (N건 개별 알림이 아닌지). Sprint 컨텍스트 제거된 Task가 "This Sprint" 섹션에서 사라졌는지 확인 |
| 7 | **`sprintId=current` 토큰 해석 통일** (v2.1) | virtualNode `my-work.sprint`의 `sprintId=current`는 서버가 ACTIVE Sprint ID로 치환. 응답에는 실제 Sprint ID를 반환하여 클라이언트 상태가 실체 ID를 갖게 함. ACTIVE Sprint가 없으면 빈 목록 + warning 반환 (에러 아님) | `?sprintId=current` 요청 시 응답의 Sprint 컨텍스트에 실제 ID가 포함되는지 확인. ACTIVE Sprint가 없는 프로젝트에서 요청 -> 빈 목록 + "활성 스프린트 없음" warning 반환 확인 |

---

## 11. Capability 매핑

| Capability | 행위 | 대표 역할 | v2.1 비고 |
|-----------|------|---------|----------|
| `view_my_work` | 내 작업 화면 접근, Task 조회, Issue 조회 | DEV, DevReader | DevReader는 **read-only** -- 상태 변경/시간 기록/코멘트 불가 |
| `manage_my_tasks` | Task 상태 변경, 시간 기록, 코멘트 추가 (자기 Task만) | DEV | v2.1 신규 -- DevReader 제외 |
| `view_kanban` | 칸반 보드 링크 (연관 네비게이션) | DEV, DevReader, PM | -- |
| `view_sprints` | 스프린트 링크 (연관 네비게이션) | DEV, DevReader, PM | -- |
| `view_issues` | 이슈 등록/조회 (연관 기능) | DEV, DevReader | -- |

> **v2.1 Capability 조회/변경 분리**:
>
> - `view_my_work`: 화면 접근 + 조회만 (DevReader, DEV 공통)
> - `manage_my_tasks`: 상태 변경 + 시간 기록 + 코멘트 (DEV만)
> - DevReader는 `view_my_work`만 부여 → Task 카드의 Quick Actions(상태 드롭다운, Log Hours, Comment)가 비활성화
> - 알림 조회/읽음 처리는 `view_my_work`에 포함 (읽기 행위이므로)
>
> **분리 이유**: v2.0에서 `view_my_work`에 상태 변경이 암묵적으로 포함되어 있었으나,
> DevReader(읽기 전용에 가까운 역할)가 원치 않게 상태를 변경할 수 있는 보안/감사 위험이 있었다.
> Sprint(07) 문서에서 `manage_sprints`와 `assign_story_sprint`를 분리한 것과 동일한 철학을 적용한다.

**권한 4중 방어 적용**:

```
Layer 1: Menu/Navigation
  -> view_my_work 없으면 SideNav에서 "내 작업" 메뉴 숨김

Layer 2: Route Guard
  -> /my-work URL 직접 접근 시 view_my_work 검사
  -> 실패 시 /dashboard 리다이렉트

Layer 3: Action Guard (v2.1: manage_my_tasks 분리)
  -> Task 상태 변경: manage_my_tasks + 본인 할당 Task만 (서버 userId + capability 검증)
  -> 시간 기록: manage_my_tasks + 본인 할당 Task만
  -> 코멘트: manage_my_tasks + 본인 할당 Task만
  -> DevReader는 view_my_work만 보유 -> Quick Actions 비활성화 (프론트 + 서버 이중 검증)

Layer 4: Backend Enforcement
  -> JWT userId 강제 적용
  -> 다른 사용자 Task 접근 시 403
  -> Part scope 서버 강제 (DevReader는 자기 파트만)
```

---

## 12. DoD (본 화면 완료 기준)

- [ ] `/my-work` 라우트에서 DEV_EXECUTION Preset 전용 화면 렌더링
- [ ] Route Guard: `view_my_work` Capability 없으면 `/dashboard` 리다이렉트
- [ ] **userId 서버 강제**: JWT에서 추출, 클라이언트 파라미터 무시
- [ ] KPI Row: 진행 중 / 지연 / 블로킹 / 오늘 완료 / 전체 Task / 남은 SP 6개 메트릭
- [ ] **Today's Focus 섹션**: 서버 판정 로직 (dueDate=today + IN_PROGRESS + BLOCKED + overdue)
- [ ] **This Sprint 섹션**: 현재 Sprint 내 Task를 status별 그룹 (TODO/IN_PROGRESS/IN_REVIEW/DONE)
- [ ] **Overdue 섹션**: 마감 초과 미완료 Task 목록 + 지연 일수 표시
- [ ] **All Tasks 섹션**: FilterSpec 기반 전체 Task 목록 (status/sprintId/priority/dueDate/q)
- [ ] **Issues 탭**: 내 할당 / 내 보고 / 관심 이슈 3분류 표시
- [ ] Task 카드: Story 컨텍스트(Story ID + Title + Epic) + Task 상세 + 상태 드롭다운 + 시간 + 마감일
- [ ] **인라인 상태 변경**: TaskStatusDropdown으로 즉시 상태 변경 + 서버 검증
- [ ] **BLOCKED 상태 변경 시** 사유 입력 + 이슈 연결 다이얼로그
- [ ] **DONE 상태 변경 시** 확인 다이얼로그 + Story 자동 전이 확인
- [ ] **상태 전이 에러 처리**: 5종 에러 코드별 사용자 안내 (INVALID_TRANSITION/BLOCKED_REQUIRES_REASON/DONE_REQUIRES_ALL_SUBTASKS/CONCURRENT_MODIFICATION/PART_ACCESS_DENIED)
- [ ] **시간 기록**: POST /api/my-work/tasks/:taskId/time-log + 0.5h 단위 + 미래 날짜 불가
- [ ] **시간 초과 경고**: actualHours > estimatedHours 시 배지 표시
- [ ] **코멘트 추가**: POST /api/my-work/tasks/:taskId/comments + @멘션 자동완성
- [ ] Right Panel: panelMode 분기 (none/task-detail/issue-detail/time-log)
- [ ] Task 카드 클릭 -> Right Panel "task-detail" 표시 (기본 정보 + Story 컨텍스트 + 시간 기록 + 코멘트 + 연관 항목)
- [ ] **알림 통합**: 지연 알림 / 리뷰 요청 / 할당 알림 / 멘션 / 상태 변경 5종 알림
- [ ] 알림 배지: 미읽은 건수 표시 + 클릭 시 드롭다운 + 읽음 처리
- [ ] **KPI 카드 클릭 -> 필터 활성화**: MY_WORK_KPI_FILTER_MAP 기반 toggle 동작 + 탭 전환
- [ ] **FilterSpec URL 직렬화**: serialize/deserialize 왕복 보장, enum 화이트리스트 검증, 미지 키 silent drop
- [ ] **칸반-내작업 상태 동기화**: 상태 변경 시 kanbanSync 응답 + TanStack Query 캐시 무효화
- [ ] **이슈 빠른 등록**: Issues 탭에서 이슈 등록 폼 (targetNodeId: issues)
- [ ] **네비게이션**: 칸반 보드 링크, Story 상세 링크, Sprint 링크, Issue 링크
- [ ] **virtualNode 5개**: today/overdue/blocked/in-progress/sprint AI 우선 반환
- [ ] **AI Insight Widget**: 개인 맥락 분석 + 추천 액션 (리뷰 대기, BLOCKED 해결 등)
- [ ] **Hub 페널티/Detail 보너스**: 행동/목록 질문 시 my-work +10, dashboard -20
- [ ] 3분 자동 갱신 (KPI) + 1분 알림 폴링
- [ ] 반응형 레이아웃 (>=1440 / 1280 / <=1024 / <=768)
- [ ] WCAG AA 접근성 준수 (색상 대비 4.5:1, 키보드 순회, 스크린 리더)

**v2.1 추가 DoD**:

- [ ] **Reliability 3-tuple 표준화**: MyWorkSummary, MyTasksResponse 모두 `completeness: {overall, breakdown?}`, `warnings: {code,message,severity}[]` 형태 적용
- [ ] **Scope echo**: 모든 API 응답에 `scope: {projectId}` 포함, 클라이언트가 교차 검증 가능
- [ ] **FilterSpec/ViewState 분리**: tab은 ViewState로 분리, AI 딥링크에 tab 미포함, 프론트가 filter 기반 tab 자동 결정
- [ ] **Scope 2-tier**: securityKeys(projectId, userId)는 서버 강제, explorationKeys(sprintId, status 등)는 프론트 전용
- [ ] **`sprintId=current` 토큰**: 서버가 ACTIVE Sprint ID로 치환, 응답에 실제 ID 반환, ACTIVE 없으면 빈 목록 + warning
- [ ] **Capability 조회/변경 분리**: `view_my_work`(read-only) + `manage_my_tasks`(DEV만) 분리. DevReader는 Quick Actions 비활성화
- [ ] **StoryStatus 상태 사전 통일**: IN_REVIEW(REVIEW 아님), 자동 전이 규칙이 칸반/스프린트/내작업 동일 계약
- [ ] **이벤트 기반 refetch**: 상태 변경 직후 1회 강제 refetch + optimistic update. 폴링은 보조
- [ ] **Sprint Close → My Work 영향**: Task 리셋 시 overdue 폭증 방어, 알림 요약 집약, Sprint 컨텍스트 제거 확인
- [ ] **Sprint Close 캐시 일괄 무효화**: `sprint.closed` 이벤트 시 my-work/kanban/sprints/backlog 5개 쿼리키 일괄 invalidate
- [ ] **AI fallbackNodeId**: 비DEV Preset에서 "내 작업" 요청 시 dashboard로 fallback + 용어 변환 안내
- [ ] **깨지기 쉬운 곳 7항목**: Sprint Close ↔ My Work 정합성(#6), sprintId=current 해석 통일(#7) 검증 포함

---

## 부록 A. 기존 화면 vs 개선 화면 비교

| 항목 | 기존 (스프레드시트/메신저) | 개선 (본 설계) |
|------|------------------------|-------------|
| **진입점** | 칸반에서 내 이름 필터 | **전용 /my-work 화면** |
| **시간 렌즈** | 없음 (전체 목록) | **Today / Sprint / Overdue** 3종 |
| **상태 변경** | 칸반 D&D만 | **인라인 드롭다운** + 서버 검증 + Story 자동 전이 |
| **시간 기록** | 별도 시간 관리 도구 | **인라인 시간 기록** (0.5h 단위) |
| **Story 맥락** | Task만 표시 | **Story/Epic 컨텍스트 항상 표시** |
| **지연 관리** | 수동 확인 | **자동 지연 감지** + 알림 + 배지 |
| **이슈 연동** | 별도 화면 | **Issues 탭 통합** (할당/보고/관심) |
| **알림** | 메신저/이메일 | **화면 내 알림 배지** (5종 알림 통합) |
| **AI 지원** | 없음 | **AI Insight** (개인 맥락 분석 + 추천 액션) |
| **권한** | 전체 공개 | **JWT userId 강제** + view_my_work Capability |

---

## 부록 B. 타 화면과의 데이터 흐름

```
                   +-------------+
                   |  Backlog    |
                   | (Epic/Story)|
                   +------+------+
                          |
                   Story/Task 할당
                          |
                          v
+----------+       +------+------+       +----------+
| Sprint   | <---> |  My Work    | <---> |  Kanban  |
| (Sprint  |       | (DEV 전용)  |       |  (팀 흐름)|
|  범위)   |       +------+------+       +----------+
+----------+              |
                          |
              +-----------+-----------+
              |                       |
              v                       v
       +------+------+        +------+------+
       |  Issues     |        | Deliverables|
       | (이슈 연동) |        | (산출물 대기)|
       +-------------+        +-------------+
```

**데이터 동기화 방향**:

| 출발 화면 | 도착 화면 | 동기화 내용 | 방식 |
|----------|----------|-----------|------|
| My Work -> Kanban | Task 상태 변경 | `kanbanSync` 응답 + 캐시 무효화 |
| Kanban -> My Work | Task 상태 변경 (D&D) | 서버 반영 + 캐시 무효화 |
| Sprint -> My Work | Sprint 할당/제거 | Sprint 변경 이벤트 + 캐시 무효화 |
| My Work -> Issues | 이슈 등록 | POST /api/issues -> Issues 목록 갱신 |
| Backlog -> My Work | Task 생성/할당 | 새 할당 알림 + 캐시 무효화 |

---

## 부록 C. 변경이력

| 버전 | 날짜 | 변경 내용 |
|------|------|---------|
| v2.0 | 2026-02-08 | 초안 작성 -- DEV 전용 개인 커맨드 센터 설계. MenuOntologyNodeV2 확정 (14개 intent, 5개 virtualNode, FilterSpec 5키). Today/Sprint/Overdue/All/Issues 5탭 구조. Task 카드 (Story 컨텍스트 + Quick Actions). 인라인 상태 변경 + 시간 기록 + 코멘트. 알림 통합 5종. 칸반-내작업 상태 동기화. AI Navigation 연동 (virtualNode 우선, Hub 페널티/Detail 보너스). 깨지기 쉬운 곳 5곳 체크리스트. Capability 매핑 (view_my_work 단일 + 암묵적 행위). 반응형 4단계. |
| v2.1 | 2026-02-08 | Sprint(07) 교차 검토 기반 14항목 반영. (1)FilterSpec/ViewState 분리(tab은 ViewState), (2)Scope 2-tier 패턴(securityKeys+explorationKeys), (3)Reliability 3-tuple 표준화(completeness:{overall,breakdown?}, warnings:{code,message,severity}[]), (4)Scope echo(모든 API 응답에 scope:{projectId}), (5)sprintId=current 의미 토큰 서버 치환 규칙, (6)Capability 조회/변경 분리(view_my_work read-only + manage_my_tasks DEV만), (7)AI fallbackNodeId 추가(비DEV Preset 대체 목적지), (8)StoryStatus 상태 사전 교차 참조(IN_REVIEW 통일), (9)이벤트 기반 refetch 정책(상태 변경 직후 1회 강제 + 폴링 보조), (10)Sprint Close→My Work 영향 범위(Task 리셋→overdue 급변 방어, 알림 요약 집약), (11)Sprint Close 캐시 일괄 무효화(5개 쿼리키), (12)깨지기 쉬운 곳 5→7 확장, (13)DoD v2.1 12항목 추가, (14)설계 원칙 5행 추가. |
