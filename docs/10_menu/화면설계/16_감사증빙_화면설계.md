# 16. ê°ì‚¬ ì¦ë¹™(Audit Evidence Export) í™”ë©´ì„¤ê³„

> ì‘ì„±ì¼: 2026-02-08
> ë²„ì „: v2.1
> ë¼ìš°íŠ¸: `/audit/evidence`
> í•„ìš” Capability: `export_audit_evidence` (ì „ìš©)
> ê¸°ë³¸ Preset: `AUDIT_EVIDENCE` (ê³ ì • â€” ì „í™˜ ë¶ˆê°€)
> ë…¸ë“œ ì—­í• : **Action** (ì•¡ì…˜ ë…¸ë“œ â€” ì¦ë¹™ íŒ¨í‚¤ì§€ ìƒì„±/ë‹¤ìš´ë¡œë“œ ì „ìš©)

---

## 1. í™”ë©´ ê°œìš”

### 1.1 ëª©ì 

ê°ì‚¬ ì¦ë¹™(Audit Evidence Export)ì€ **"ì™¸ë¶€ ê°ì‚¬ì— ì œì¶œí•  ì¦ë¹™ ìë£Œë¥¼ ì„ íƒí•˜ê³  íŒ¨í‚¤ì§€ë¡œ ë¬¶ì–´ ë‹¤ìš´ë¡œë“œí•œë‹¤"**ì— ëŒ€í•œ ë‹¨ì¼ ëª©ì  í™”ë©´ì´ë‹¤.
ê¸°ì¡´ì—ëŠ” Lineage í™”ë©´ì—ì„œ ì¦ë¹™ ê´€ë ¨ ê¸°ëŠ¥ì„ ê²¸ìš©í–ˆìœ¼ë‚˜, ê°ì‚¬ ì „ìš© ì›Œí¬í”Œë¡œìš°(ì„ íƒ -> ë¯¸ë¦¬ë³´ê¸° -> íŒ¨í‚¤ì§€ ìƒì„± -> ë‹¤ìš´ë¡œë“œ)ê°€ Lineageì˜ ì¶”ì /ë¶„ì„ ëª©ì ê³¼ ì¶©ëŒí•˜ë¯€ë¡œ **ì „ìš© í™”ë©´ìœ¼ë¡œ ë¶„ë¦¬**í•œë‹¤.

> **í•µì‹¬ ë¶„ë¦¬ ì›ì¹™**: LineageëŠ” **"ë³€ê²½/ì˜í–¥ ì¶”ì  ë¶„ì„"**(ë‚´ë¶€ ê´€ë¦¬),
> Evidence ExportëŠ” **"ì¦ë¹™ ìë£Œ ì„ ë³„ -> íŒ¨í‚¤ì§€ ìƒì„± -> ì™¸ë¶€ ì œì¶œ"**(ì™¸ë¶€ ê°ì‚¬ ëŒ€ì‘).
> ë‘ í™”ë©´ì€ ë™ì¼ ë°ì´í„° ì†ŒìŠ¤ë¥¼ ì°¸ì¡°í•˜ì§€ë§Œ, ì‚¬ìš© ëª©ì ê³¼ ê¶Œí•œ ëª¨ë¸ì´ ì™„ì „íˆ ë‹¤ë¥´ë‹¤.

> **v2.0 ë³€ê²½**: 00_ì´ê´„ Â§8.4ì— ë”°ë¼ AUDIT_EVIDENCE Presetì€ **ì „í™˜ ë¶ˆê°€(locked)**ë¡œ í™•ì •.
> ì™¸ë¶€ ê°ì‚¬ì¸ì€ ëŒ€ì‹œë³´ë“œ ì ‘ê·¼ ë¶ˆê°€, `/audit/evidence` ì§ì ‘ ì§„ì…ë§Œ í—ˆìš©.
> Evidence Package ìƒì„± ì›Œí¬í”Œë¡œìš°, Compliance Checklist, ëª¨ë“  Export í–‰ìœ„ì— ëŒ€í•œ Audit Trail ë¡œê¹… í¬í•¨.

### 1.2 ì„¤ê³„ ì›ì¹™

| ì›ì¹™ | ì„¤ëª… |
|------|------|
| **Read-only ì›ì¹™** | ì¦ë¹™ ìë£Œ ìì²´ë¥¼ ìˆ˜ì •/ì‚­ì œí•  ìˆ˜ ì—†ìŒ â€” ì˜¤ì§ ì„ íƒê³¼ Exportë§Œ í—ˆìš© |
| **ë‹¨ì¼ Preset ê³ ì •** | AUDIT_EVIDENCE Presetë§Œ ìœ íš¨ â€” ë‹¤ë¥¸ Presetìœ¼ë¡œ ì „í™˜ ë¶ˆê°€ (00_ì´ê´„ Â§8.4) |
| **ë‹¨ê³„ë³„ ì¦ë¹™ í•„í„°** | Phase(ë‹¨ê³„) ê¸°ë°˜ìœ¼ë¡œ ì¦ë¹™ì„ ë¶„ë¥˜í•˜ì—¬, ê°ì‚¬ ë²”ìœ„ë³„ ìë£Œë¥¼ ë¹ ë¥´ê²Œ íŠ¹ì • |
| **ì„ íƒ -> ë¯¸ë¦¬ë³´ê¸° -> Export 3ë‹¨ê³„** | ì²´í¬ë°•ìŠ¤ ê¸°ë°˜ ë‹¤ì¤‘ ì„ íƒ -> ë¯¸ë¦¬ë³´ê¸° íŒ¨ë„ í™•ì¸ -> ZIP/PDF íŒ¨í‚¤ì§€ ìƒì„± |
| **ì™„ì „í•œ Audit Trail** | ëª¨ë“  Export í–‰ìœ„(ì¡°íšŒ, ì„ íƒ, ë‹¤ìš´ë¡œë“œ)ê°€ ì„œë²„ì— ë¡œê¹…ë˜ì–´ ì¶”ì  ê°€ëŠ¥ |
| **Compliance Checklist** | ì¦ë¹™ ì¤€ë¹„ ìƒíƒœë¥¼ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¡œ ì‹œê°í™”í•˜ì—¬ ëˆ„ë½ í•­ëª© ì‚¬ì „ ì‹ë³„ |
| **FilterSpec = ì˜¨í†¨ë¡œì§€** | í•„í„° í‚¤ê°€ AI/URL/ë°±ì—”ë“œ ê³µí†µ ìŠ¤í‚¤ë§ˆë¡œ í†µí•© |
| **Export ì „ìš© Capability** | `export_audit_evidence` ë‹¨ì¼ Capabilityë§Œìœ¼ë¡œ ì ‘ê·¼ â€” ë‹¤ë¥¸ ê´€ë¦¬ ê¶Œí•œ ë¶ˆí•„ìš” |
| **íŒ¨í‚¤ì§€ ë´‰ì¸(Seal)** | Export ê²°ê³¼ì— filterSnapshot/policySnapshot/selectionHash/sealedAtì„ ë‚¨ê²¨ ì¬í˜„ ê°€ëŠ¥ (v2.1) |
| **ì œì¶œ ìš”ì•½(Cover Sheet)** | Export ì§ì „ ì œì¶œ ë²”ìœ„ ìë™ ìš”ì•½ + í™•ì¸ ì²´í¬(confirm) í›„ Export ì‹œì‘ (v2.1) |
| **ì„œë²„ ìŠ¤ì½”í”„ ê°•ì œ** | JWT í´ë ˆì„ì— allowedProjectIds/allowedDateRange í¬í•¨ â€” ë°±ì—”ë“œì—ì„œ êµì°¨ê²€ì¦ (v2.1) |
| **Audit Trail ì›ì ì´ë²¤íŠ¸** | EXPORT_SEALED ì´ë²¤íŠ¸ë¡œ ìµœì¢… ì„ íƒ ì§‘í•©+í•„í„°+ì •ì±…ì„ 1ê°œ ì´ë²¤íŠ¸ì— ê³ ì • (v2.1) |
| **ì»¤ë²„ë¦¬ì§€ 2ë¶„í™”** | submissionReady(approved/required) vs inProgress((approved+pending)/required) ë¶„ë¦¬ (v2.1) |
| **ì „ì²´ì„ íƒ = ì„œë²„ ì „ì²´** | selectAllì€ í˜„ì¬ í˜ì´ì§€ê°€ ì•„ë‹Œ í•„í„° ê²°ê³¼ ì„œë²„ ì „ì²´ ê¸°ì¤€ (v2.1) |
| **PDF ë¶€ë¶„ ì‹¤íŒ¨ í—ˆìš©** | PDF ë³‘í•© ì‹¤íŒ¨ ì‹œ ì‹¤íŒ¨ í•­ëª© ì œì™¸ + ëŒ€ì²´ ZIP ê¶Œìœ  ì •ì±… (v2.1) |
| **ë‹¤ìš´ë¡œë“œ URL ì¬ë°œê¸‰** | ë§Œë£Œ í›„ íŒ¨í‚¤ì§€ ì¬ìƒì„± ì—†ì´ downloadUrlë§Œ ì¬ë°œê¸‰í•˜ëŠ” ì „ìš© ì—”ë“œí¬ì¸íŠ¸ (v2.1) |
| **IP ì‹ ë¢° ê³„ì¸µ** | Audit Trailì— ì›ë³¸ IP + í”„ë¡ì‹œ IP ëª¨ë‘ ê¸°ë¡, ì‹ ë¢° í”„ë¡ì‹œ ëª©ë¡ ê¸°ë°˜ (v2.1) |

### 1.3 í•µì‹¬ ì§ˆë¬¸ -> ìœ„ì ¯ ë§¤í•‘

| ì‚¬ìš©ì ì§ˆë¬¸ | í™”ë©´ ì˜ì—­ | ì„¤ëª… |
|-----------|---------|------|
| "ê°ì‚¬ ì¦ë¹™ ì¤€ë¹„ ìƒíƒœëŠ”?" | Compliance Checklist + KPI | evidence_coverage(%) + missing_evidence_count |
| "1ë‹¨ê³„ ì¦ë¹™ ìë£Œ ë‚´ë³´ë‚´ì¤˜" | Phase Filter + Evidence List | phaseId í•„í„° -> í•´ë‹¹ ë‹¨ê³„ ì¦ë¹™ ëª©ë¡ |
| "ì‚°ì¶œë¬¼ ì¦ë¹™ë§Œ ë³´ì—¬ì¤˜" | Evidence Type Filter | evidenceType=deliverable í•„í„° |
| "ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì¸ ì¦ë¹™ì´ ìˆì–´?" | KPI + í•„í„° | pending_approvals ê±´ìˆ˜ + status=pending í•„í„° |
| "ì „ì²´ ì¦ë¹™ íŒ¨í‚¤ì§€ ë§Œë“¤ì–´ì¤˜" | Export Button | ì „ì²´ ì„ íƒ -> ZIP íŒ¨í‚¤ì§€ ìƒì„± |
| "ì´ë²ˆì— ë‚´ë³´ë‚¸ ê±´ìˆ˜ëŠ”?" | KPI Card | export_count (ëˆ„ì  Export íšŸìˆ˜) |
| "ëˆ„ë½ëœ ì¦ë¹™ì´ ë­ì•¼?" | Compliance Checklist | missing_evidence_count + ìƒì„¸ ëª©ë¡ |
| "í…ŒìŠ¤íŠ¸ ê²°ê³¼ì„œ ì¦ë¹™ í™•ì¸" | Filter + Preview | evidenceType=test_result -> ë¯¸ë¦¬ë³´ê¸° |

---

## 2. MenuOntology ë…¸ë“œ

### 2.1 íƒ€ì… í™•ì • (v2.0 ë³€ê²½ì‚¬í•­)

01_ëŒ€ì‹œë³´ë“œ / 02_ìš”êµ¬ì‚¬í•­ / 03_ë°±ë¡œê·¸ v2.0 íŒ¨í„´ì„ ë™ì¼í•˜ê²Œ ì ìš©í•œë‹¤.

| í•­ëª© | v1.0 (00_ì´ê´„) | v2.0 (í™•ì •) | ë³€ê²½ ì‚¬ìœ  |
|------|---------------|------------|----------|
| `entities` | ì†Œë¬¸ì `"deliverable"` | PascalCase `"Deliverable"` | EntityType enum ì •ê·œí™” |
| `intents` | 2ê°œ | 8ê°œë¡œ í™•ì¥ | í•„í„°/ìƒíƒœ ì¡°íšŒ/Export ì§ˆë¬¸ ì»¤ë²„ë¦¬ì§€ í™•ë³´ |
| `nodeRole` | ì—†ìŒ | `"action"` ì‹ ê·œ | AI ìŠ¤ì½”ì–´ë§ ê¸°ì¤€ (í–‰ë™ ì§ˆë¬¸ì— +10 ê°€ì‚°) |
| `filterSpec` | ì—†ìŒ | ì˜¨í†¨ë¡œì§€ ë‚´ì¥ FilterSpec (5í‚¤) | AI/URL/ë°±ì—”ë“œ í†µí•© í•„í„° í‚¤ |
| `metrics` | 2ê°œ | 5ê°œë¡œ í™•ì¥ | ëˆ„ë½/Export/ì „ì²´ ê±´ìˆ˜ ì¶”ê°€ |
| `presetPolicies` | 1ê°œ | 1ê°œ (ë³€ë™ ì—†ìŒ) | AUDIT_EVIDENCE ë‹¨ë… â€” ë‹¤ë¥¸ Preset ì—†ìŒ |
| `suggestedActions.capability` | ë‹¨ì¼ | `requiredCaps?: Capability[]` + `targetNodeId?: string` | ë³µìˆ˜ ê¶Œí•œ + nodeId ê¸°ë°˜ ì´ë™ |
| `deepLinks.pattern` | `{phaseId}` í˜•íƒœ | `:phaseId` í˜•íƒœ | ë¼ìš°íŠ¸ í…œí”Œë¦¿ í‘œì¤€ í†µì¼ |
| `scopeHints` | ì¶”ìƒ ë‹¨ì¼ | `scope: { keys, params }` 2ê³„ì¸µ ë¶„ë¦¬ | ìŠ¤ì½”í”„ í•´ì„ ì•ˆì •ì„± |

### 2.2 FilterSpec ì •ì˜

FilterSpecì€ **ì´ í™”ë©´ì´ ì§€ì›í•˜ëŠ” í•„í„° ìŠ¤í‚¤ë§ˆ**ë¥¼ ì˜¨í†¨ë¡œì§€ ë‚´ë¶€ì— ì„ ì–¸í•œë‹¤.
AIê°€ ë”¥ë§í¬ë¥¼ ìƒì„±í•  ë•Œ, URL íŒŒë¼ë¯¸í„° ë¬¸ìì—´ì´ ì•„ë‹ˆë¼ **FilterSpec í‚¤ ê¸°ë°˜ í•„í„° ê°ì²´**ë¥¼ ë°˜í™˜í•œë‹¤.

```typescript
/** ê°ì‚¬ ì¦ë¹™ í•„í„° ìŠ¤í‚¤ë§ˆ -- ì˜¨í†¨ë¡œì§€ ë‚´ì¥ */
export interface AuditEvidenceFilterSpec {
  /** í”„ë¡œì íŠ¸ ë‹¨ê³„(Phase) í•„í„° */
  phaseId?: string;
  /** ì¦ë¹™ ìœ í˜• */
  evidenceType?:
    | "deliverable"      // ì‚°ì¶œë¬¼
    | "test_result"      // í…ŒìŠ¤íŠ¸ ê²°ê³¼
    | "decision_record"  // ê²°ì • ê¸°ë¡
    | "change_history"   // ë³€ê²½ ì´ë ¥
    | "approval_log"     // ìŠ¹ì¸ ë¡œê·¸
    | "meeting_minutes"; // íšŒì˜ë¡
  /** ê¸°ê°„ ë²”ìœ„ (ISO date) */
  dateRange?: {
    from?: string;       // "2026-01-01"
    to?: string;         // "2026-02-08"
  };
  /** ì¦ë¹™ ìƒíƒœ */
  status?: "approved" | "pending" | "rejected" | "missing";
  /** ììœ  ê²€ìƒ‰ì–´ */
  q?: string;
}
```

> **URL ì§ë ¬í™” ê·œì¹™** (03_ë°±ë¡œê·¸ v2.1 íŒ¨í„´ ë™ì¼):
> - ë‹¨ìˆœ ê°’: `?phaseId=PH-001&evidenceType=deliverable&status=approved`
> - dateRange: `?dateFrom=2026-01-01&dateTo=2026-02-08` (flat ë³€í™˜)
> - ê²€ìƒ‰ì–´: `?q=ì„¤ê³„ì„œ` (URL encode)
> - ë°°ì—´ ê°’ ì—†ìŒ (ê°ì‚¬ ì¦ë¹™ì€ ë‹¨ì¼ ì„ íƒ í•„í„°ë§Œ ì§€ì›)

> **dateRange ì •ê·œí™” ê·œì¹™** (v2.1):
> - `dateFrom > dateTo` â†’ swap í›„ ì ìš©
> - `dateFrom`ë§Œ ì¡´ì¬ â†’ `dateTo = today` ë³´ì •
> - `dateTo`ë§Œ ì¡´ì¬ â†’ `dateFrom` ìƒëµ(ì „ì²´ ì‹œì‘~dateTo)
> - ê°ì‚¬ ìŠ¤ì½”í”„ì— `allowedDateRange`ê°€ ì„¤ì •ëœ ê²½ìš°, UI ë¯¸ì§€ì • ì‹œ ìë™ ì„¸íŒ…
> - ë¯¸ì§€ì •(ì „ì²´ê¸°ê°„) ì‹œ Cover Sheetì— "ê¸°ê°„ ë¯¸ì§€ì •(ì „ì²´ê¸°ê°„)" ê²½ê³  í‘œì‹œ

> **ì—­ì§ë ¬í™”(Deserialization) ê²½ê³ ** (v2.1):
> - `evidenceType`/`status` URL ê°’ì´ enumì— ì—†ìœ¼ë©´ silent drop + `droppedFilters`ì— ê¸°ë¡
> - ì•Œ ìˆ˜ ì—†ëŠ” URL í‚¤ëŠ” ë¬´ì‹œ + `droppedFilters`ì— ê¸°ë¡
> - `droppedFilters`ê°€ 1ê±´ ì´ìƒì´ë©´ Page Headerì— ê²½ê³  ë°°ì§€ ë…¸ì¶œ

```typescript
/** v2.1: URL ì—­ì§ë ¬í™” ê²°ê³¼ */
interface DeserializeResult {
  filter: AuditEvidenceFilterSpec;
  droppedFilters: { key: string; value: string; reason: string }[];
}
```

### 2.3 Audit Evidence ë…¸ë“œ (í™•ì •ë³¸ v2.0)

```typescript
const auditEvidenceNode: MenuOntologyNodeV2 = {
  nodeId: "audit-evidence",
  label: "Evidence Export",
  route: "/audit/evidence",
  icon: "GavelRounded",
  domain: "audit",
  nodeRole: "action",              // â˜… ì•¡ì…˜ ë…¸ë“œ -- í–‰ë™ ì§ˆë¬¸ì— +10 ê°€ì‚°

  requiredCaps: ["export_audit_evidence"],

  // --- ì¸í…íŠ¸: 8ê°œ (v1.0 2ê°œ -> v2.0 8ê°œ) ---
  intents: [
    // Ask ê³„ì—´ -- ì¡°íšŒ/ì§ˆë¬¸
    "ask_audit_readiness",           // "ê°ì‚¬ ì¦ë¹™ ì¤€ë¹„ ìƒíƒœëŠ”?"
    "ask_evidence_coverage",         // "ì¦ë¹™ ì»¤ë²„ë¦¬ì§€ ëª‡ %ì•¼?"
    "ask_missing_evidence",          // "ëˆ„ë½ëœ ì¦ë¹™ì´ ë­ì•¼?"
    "ask_pending_evidence",          // "ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì¸ ì¦ë¹™ ìˆì–´?"
    "ask_export_history",            // "ìµœê·¼ Export ì´ë ¥ ë³´ì—¬ì¤˜"
    // Do ê³„ì—´ -- ì‹¤í–‰/ë³€ê²½
    "do_export_evidence",            // "ì¦ë¹™ íŒ¨í‚¤ì§€ ìƒì„±í•´ì¤˜"
    "do_export_phase_evidence",      // "1ë‹¨ê³„ ì¦ë¹™ ë‚´ë³´ë‚´ì¤˜"
    "do_preview_evidence",           // "ì¦ë¹™ ë¯¸ë¦¬ë³´ê¸° ë³´ì—¬ì¤˜"
  ],
  canonicalQuestions: [
    "ê°ì‚¬ ì¦ë¹™ ìë£Œë¥¼ ë‚´ë³´ë‚´ì•¼ í•´",
    "í˜„ì¬ ì¦ë¹™ ì¤€ë¹„ ìƒíƒœëŠ”?",
    "ì´ë²ˆ ê°ì‚¬ì— í•„ìš”í•œ ì‚°ì¶œë¬¼ì€ ë‹¤ ì˜¬ë¼ì™”ì–´?",
    "1ë‹¨ê³„ ì¦ë¹™ ìë£Œ ë‚´ë³´ë‚´ì¤˜",
    "ëˆ„ë½ëœ ì¦ë¹™ í•­ëª©ì´ ë­ì•¼?",
    "ì „ì²´ ì¦ë¹™ íŒ¨í‚¤ì§€ ë§Œë“¤ì–´ì¤˜",
    "í…ŒìŠ¤íŠ¸ ê²°ê³¼ì„œ ì¦ë¹™ í™•ì¸í•´ì¤˜",
    "ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì¸ ì¦ë¹™ ìˆì–´?",
    "ìµœê·¼ Export ì´ë ¥ ë³´ì—¬ì¤˜",
    "ì¦ë¹™ ì»¤ë²„ë¦¬ì§€ê°€ ì–¼ë§ˆì•¼?",
  ],
  entities: ["Deliverable", "Decision", "TestCase", "Phase", "Meeting"],
  keywords: [
    "ê°ì‚¬", "ì¦ë¹™", "ì—ë¹„ë˜ìŠ¤", "Export", "ë‚´ë³´ë‚´ê¸°", "íŒ¨í‚¤ì§€",
    "audit", "evidence", "export", "compliance", "checklist",
    "ì‚°ì¶œë¬¼", "í…ŒìŠ¤íŠ¸ê²°ê³¼", "ê²°ì •ê¸°ë¡", "ë³€ê²½ì´ë ¥", "ìŠ¹ì¸ë¡œê·¸", "íšŒì˜ë¡",
    "ëˆ„ë½", "ì»¤ë²„ë¦¬ì§€", "ì¤€ë¹„ìƒíƒœ",
  ],
  metrics: [
    "evidence_coverage",            // ì¦ë¹™ ì»¤ë²„ë¦¬ì§€ (%)
    "pending_approvals",            // ìŠ¹ì¸ ëŒ€ê¸° ê±´ìˆ˜
    "total_evidence_items",         // ì „ì²´ ì¦ë¹™ í•­ëª© ìˆ˜
    "export_count",                 // ëˆ„ì  Export íšŸìˆ˜
    "missing_evidence_count",       // ëˆ„ë½ ì¦ë¹™ ê±´ìˆ˜
  ],

  // --- FilterSpec ì˜¨í†¨ë¡œì§€ ë‚´ì¥ ---
  filterSpec: {
    keys: ["phaseId", "evidenceType", "dateRange", "status", "q"],
    defaults: {},  // AUDIT_EVIDENCE Preset ë‹¨ë… -- Presetë³„ ì˜¤ë²„ë¼ì´ë“œ ì—†ìŒ
  },

  defaultPreset: "AUDIT_EVIDENCE",
  presetPolicies: [
    {
      preset: "AUDIT_EVIDENCE",
      ui: {
        density: "compact",
        defaultRightPanel: "closed",
        highlight: {
          metricKeys: ["evidence_coverage", "missing_evidence_count", "pending_approvals"],
          widgetKeys: [
            "KPI_COVERAGE", "KPI_MISSING", "KPI_PENDING",
            "COMPLIANCE_CHECKLIST", "EVIDENCE_LIST",
          ],
        },
      },
      suggestedActions: [
        {
          key: "export_all",
          label: "ì „ì²´ ì¦ë¹™ íŒ¨í‚¤ì§€ ìƒì„±",
          requiredCaps: ["export_audit_evidence"],
        },
        {
          key: "export_phase",
          label: "ë‹¨ê³„ë³„ ì¦ë¹™ Export",
          requiredCaps: ["export_audit_evidence"],
        },
        {
          key: "view_checklist",
          label: "Compliance Checklist í™•ì¸",
          requiredCaps: ["export_audit_evidence"],
        },
      ],
    },
    // â˜… ë‹¤ë¥¸ Preset ì—†ìŒ -- AUDIT_EVIDENCE ë‹¨ë… ì‚¬ìš©
    // 00_ì´ê´„ Â§8.4: AUDIT_EVIDENCE -> ë‹¤ë¥¸ Preset ì „í™˜ ì°¨ë‹¨
    // 00_ì´ê´„ Â§8.4: ë‹¤ë¥¸ Preset -> AUDIT_EVIDENCE ì§„ì… ì°¨ë‹¨
  ],

  // --- DeepLink: routeTemplate í‘œì¤€ (:param í˜•íƒœ) ---
  deepLinks: [
    {
      pattern: "/audit/evidence?phaseId=:phaseId",
      description: "ë‹¨ê³„ë³„ ì¦ë¹™ í•„í„°",
      requiredParams: ["phaseId"],
    },
    {
      pattern: "/audit/evidence?evidenceType=:evidenceType",
      description: "ì¦ë¹™ ìœ í˜•ë³„ í•„í„°",
      requiredParams: ["evidenceType"],
    },
    {
      pattern: "/audit/evidence?status=:status",
      description: "ì¦ë¹™ ìƒíƒœë³„ í•„í„°",
      requiredParams: ["status"],
    },
    {
      pattern: "/audit/evidence?phaseId=:phaseId&evidenceType=:evidenceType",
      description: "ë‹¨ê³„ + ìœ í˜• ë³µí•© í•„í„°",
      requiredParams: ["phaseId", "evidenceType"],
    },
  ],

  // --- ê°€ìƒ ë…¸ë“œ: ë”¥ë§í¬ë¥¼ ì˜¨í†¨ë¡œì§€ 2ê³„ì¸µìœ¼ë¡œ ìŠ¹ê²© ---
  virtualNodes: [
    {
      virtualId: "audit-evidence.missing",
      label: "ëˆ„ë½ ì¦ë¹™ í™•ì¸",
      routeTemplate: "/audit/evidence?status=missing",
      requiredParams: [],
      intents: ["ask_missing_evidence", "ask_audit_readiness"],
      description: "ëˆ„ë½ëœ ì¦ë¹™ í•­ëª© ëª©ë¡ ì§ì ‘ ì§„ì…",
    },
    {
      virtualId: "audit-evidence.phase",
      label: "ë‹¨ê³„ë³„ ì¦ë¹™",
      routeTemplate: "/audit/evidence?phaseId=:phaseId",
      requiredParams: ["phaseId"],
      intents: ["do_export_phase_evidence", "ask_audit_readiness"],
      description: "íŠ¹ì • ë‹¨ê³„ì˜ ì¦ë¹™ ìë£Œë§Œ í•„í„°ë§í•˜ì—¬ ì§„ì…",
    },
    {
      virtualId: "audit-evidence.pending",
      label: "ìŠ¹ì¸ ëŒ€ê¸° ì¦ë¹™",
      routeTemplate: "/audit/evidence?status=pending",
      requiredParams: [],
      intents: ["ask_pending_evidence"],
      description: "ìŠ¹ì¸ ëŒ€ê¸° ìƒíƒœì˜ ì¦ë¹™ í•­ëª©ë§Œ í•„í„°ë§",
    },
  ],

  // --- ìŠ¤ì½”í”„ 2ê³„ì¸µ ë¶„ë¦¬ ---
  scope: {
    keys: ["project", "phase"],          // ì¶”ìƒ ScopeKey
    params: ["projectId", "phaseId"],    // êµ¬ì²´ ScopeParam
  },

  priority: 10,
};
```

---

## 3. í™”ë©´ êµ¬ì¡°

### 3.1 panelMode ì •ì˜

ê°ì‚¬ ì¦ë¹™ í™”ë©´ì€ **3ë‹¨ê³„ ì›Œí¬í”Œë¡œìš°(ì„ íƒ -> ë¯¸ë¦¬ë³´ê¸° -> Export)** êµ¬ì¡°ë¥¼ ê°€ì§„ë‹¤.
Right Panelì€ ë¯¸ë¦¬ë³´ê¸° ìš©ë„ë¡œ, ì¦ë¹™ í•­ëª© ì„ íƒ ì‹œ ì—´ë¦°ë‹¤.

| panelMode | ì¡°ê±´ | Right Panel | ì„¤ëª… |
|-----------|------|------------|------|
| `list` | ì´ˆê¸° ìƒíƒœ (ì„ íƒ ì—†ìŒ) | `closed` | í•„í„° + ì¦ë¹™ ëª©ë¡ë§Œ í‘œì‹œ |
| `preview` | 1ê°œ ì´ìƒ ì¦ë¹™ ì„ íƒ | `open` (420px) | ì„ íƒëœ ì¦ë¹™ ë¯¸ë¦¬ë³´ê¸° |
| `confirm` | Export ë²„íŠ¼ í´ë¦­ ì§í›„ | `open` (420px) | **ì œì¶œ ìš”ì•½(Cover Sheet) í™•ì¸** (v2.1) |
| `export` | Cover Sheet í™•ì¸ í›„ | `open` (420px) | íŒ¨í‚¤ì§€ ìƒì„± ì§„í–‰ ìƒíƒœ |

### 3.2 Desktop ì™€ì´ì–´í”„ë ˆì„ (AUDIT_EVIDENCE Preset -- ìœ ì¼)

```
+----------------------------------------------------------------------+
|  Top Bar (56px)                                                        |
|  [ AIMAX AI-PMS ]  [ í”„ë¡œì íŠ¸: AI ë³´í—˜ê¸ˆì§€ê¸‰ì‹¬ì‚¬ â–¼ ]  [ ì•Œë¦¼ ] [ ğŸ‘¤ ]  |
+--------+-------------------------------------------------------------+
|        |  Page Header (48px)                                           |
|  Side  |  Evidence Export  [ Phase: ì „ì²´ â–¼ ] [ ìœ í˜•: ì „ì²´ â–¼ ]          |
|  Nav   |  asOf: 2026-02-08 10:00  [ Preset: AUDIT (locked) ] [ìƒˆë¡œê³ ì¹¨]|
| (240px)+-------------------------------------------------------------+
|        |                                                               |
|  ---   |  +----------+ +----------+ +----------+ +----------+         |
|  ë©”ë‰´  |  | Coverage | | Missing  | | Pending  | | Exports  |         |
|  í•­ëª©  |  |   87%    | |   5ê±´    | |   3ê±´    | |  12íšŒ    |         |
|  ---   |  |  â–ˆâ–ˆâ–ˆâ–ˆâ–‘   | |  !       | |  ...     | |          |         |
|  (ê°ì‚¬ |  +----------+ +----------+ +----------+ +----------+         |
|   ì „ìš© |                                                               |
|   ë©”ë‰´)|  +------------------------------------------------------+    |
|        |  |  Compliance Checklist                                 |    |
|  ---   |  |                                                       |    |
|  ë Œì¦ˆ  |  |  Phase 1: ìš”ê±´ë¶„ì„     [====] 100%  âœ…                |    |
|  ì „í™˜  |  |  Phase 2: ì„¤ê³„         [===.] 85%   âš  ëˆ„ë½ 2ê±´       |    |
|  ë¶ˆê°€  |  |  Phase 3: ê°œë°œ         [==..] 65%   âš  ëˆ„ë½ 3ê±´       |    |
|  ğŸ”’    |  |  Phase 4: í…ŒìŠ¤íŠ¸       [....]  0%   âŒ ë¯¸ì‹œì‘         |    |
|        |  +------------------------------------------------------+    |
|        |                                                               |
|        |  +------------------------------------------------------+    |
|        |  |  Evidence List                              [ì „ì²´ì„ íƒ]|    |
|        |  |                                                       |    |
|        |  |  Filter: [ Phase â–¼ ] [ ìœ í˜• â–¼ ] [ ìƒíƒœ â–¼ ] [ ê²€ìƒ‰ğŸ” ]|    |
|        |  |  --------------------------------------------------- |    |
|        |  |  [x] | ìœ í˜•     | í•­ëª©ëª…           | Phase | ìƒíƒœ    |    |
|        |  |  --------------------------------------------------- |    |
|        |  |  [x] | ì‚°ì¶œë¬¼   | ìš”ê±´ì •ì˜ì„œ_v3    | PH-1  | âœ…ìŠ¹ì¸  |    |
|        |  |  [x] | ì‚°ì¶œë¬¼   | ì„¤ê³„ì„œ_v2        | PH-2  | âœ…ìŠ¹ì¸  |    |
|        |  |  [ ] | í…ŒìŠ¤íŠ¸   | ë‹¨ìœ„í…ŒìŠ¤íŠ¸_ê²°ê³¼  | PH-2  | â³ëŒ€ê¸°  |    |
|        |  |  [x] | ê²°ì •ê¸°ë¡ | ì•„í‚¤í…ì²˜ë³€ê²½_001 | PH-2  | âœ…ìŠ¹ì¸  |    |
|        |  |  [ ] | ë³€ê²½ì´ë ¥ | REQ-034 ë³€ê²½ì´ë ¥ | PH-2  | âœ…ìŠ¹ì¸  |    |
|        |  |  [ ] | ìŠ¹ì¸ë¡œê·¸ | DLV-007 ìŠ¹ì¸ê¸°ë¡ | PH-2  | âœ…ìŠ¹ì¸  |    |
|        |  |  [ ] | íšŒì˜ë¡   | ì£¼ê°„íšŒì˜_0205    | PH-2  | âœ…ìŠ¹ì¸  |    |
|        |  |  ...                                                  |    |
|        |  |                                                       |    |
|        |  |  â”€ 3ê±´ ì„ íƒë¨ â”€                                       |    |
|        |  |  +-------------------+  +------------------+          |    |
|        |  |  | ğŸ“¦ ZIP ë‹¤ìš´ë¡œë“œ   |  | ğŸ“„ PDF ë¦¬í¬íŠ¸    |          |    |
|        |  |  +-------------------+  +------------------+          |    |
|        |  +------------------------------------------------------+    |
|        |                                                               |
+--------+---------------------------------------------------------------+
```

### 3.3 ì¦ë¹™ í•­ëª© ì„ íƒ í›„ ë¯¸ë¦¬ë³´ê¸° (panelMode: preview)

```
+----------------------------------------------------------------------+
|  Top Bar                                                               |
+--------+------------------------------------------+------------------+
|        |  Page Header                              |                  |
|  Side  |  Evidence Export  [Phase: PH-2 â–¼]         |                  |
|  Nav   |  3ê±´ ì„ íƒë¨  [ Preset: AUDIT ğŸ”’ ]         |                  |
+--------+------------------------------------------+------------------+
|        |                                           |                  |
|  ë©”ë‰´  |  +------------------------------------+   | Preview Panel    |
|        |  |  Evidence List                     |   | (420px)          |
|        |  |                                    |   |                  |
|        |  |  [x] ìš”ê±´ì •ì˜ì„œ_v3     PH-1 âœ…     |   | ì„¤ê³„ì„œ_v2        |
|        |  |  [x] ì„¤ê³„ì„œ_v2  â—€â”€â”€â”€  PH-2 âœ…     |   | â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      |
|        |  |  [x] ì•„í‚¤í…ì²˜ë³€ê²½_001  PH-2 âœ…     |   | ìœ í˜•: ì‚°ì¶œë¬¼     |
|        |  |  [ ] ë‹¨ìœ„í…ŒìŠ¤íŠ¸_ê²°ê³¼   PH-2 â³     |   | Phase: PH-2      |
|        |  |  [ ] REQ-034 ë³€ê²½ì´ë ¥  PH-2 âœ…     |   | ìƒíƒœ: ìŠ¹ì¸       |
|        |  |  ...                               |   | ìŠ¹ì¸ì¼: 02-06    |
|        |  |                                    |   | ìŠ¹ì¸ì: ê¹€ê°ì‚¬   |
|        |  +------------------------------------+   |                  |
|        |                                           | íŒŒì¼ ì •ë³´:       |
|        |  3ê±´ ì„ íƒë¨ (ZIP ì˜ˆìƒ í¬ê¸°: 4.2MB)        | ì„¤ê³„ì„œ_v2.pdf    |
|        |                                           | í¬ê¸°: 2.1MB      |
|        |  +-------------------+ +--------------+   | í˜ì´ì§€: 48p      |
|        |  | ğŸ“¦ ZIP ë‹¤ìš´ë¡œë“œ   | | ğŸ“„ PDF í†µí•©  |   |                  |
|        |  +-------------------+ +--------------+   | [ğŸ“ ë¯¸ë¦¬ë³´ê¸°]    |
|        |                                           | [â¬‡ ê°œë³„ ë‹¤ìš´]    |
|        |                                           |                  |
+--------+-------------------------------------------+------------------+
```

### 3.4 Export ì§„í–‰ ì¤‘ (panelMode: export)

```
+----------------------------------------------------------------------+
|  Top Bar                                                               |
+--------+------------------------------------------+------------------+
|        |  Page Header                              |                  |
|  Side  |  Evidence Export  [íŒ¨í‚¤ì§€ ìƒì„± ì¤‘...]      |                  |
|  Nav   |  [ Preset: AUDIT ğŸ”’ ]                     |                  |
+--------+------------------------------------------+------------------+
|        |                                           |                  |
|  ë©”ë‰´  |  +------------------------------------+   | Export Progress  |
|        |  |  Evidence List                     |   | (420px)          |
|        |  |  (ì„ íƒ ë¹„í™œì„± -- ìƒì„± ì¤‘)           |   |                  |
|        |  |                                    |   | íŒ¨í‚¤ì§€ ìƒì„± ì¤‘   |
|        |  |  [x] ìš”ê±´ì •ì˜ì„œ_v3     âœ… ì™„ë£Œ      |   | â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     |
|        |  |  [x] ì„¤ê³„ì„œ_v2         ğŸ”„ ì²˜ë¦¬ì¤‘    |   |                  |
|        |  |  [x] ì•„í‚¤í…ì²˜ë³€ê²½_001  â³ ëŒ€ê¸°      |   | ì§„í–‰ë¥ : 66%      |
|        |  |                                    |   | [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘]   |
|        |  +------------------------------------+   |                  |
|        |                                           | ì²˜ë¦¬ í•­ëª©:       |
|        |                                           | âœ… ìš”ê±´ì •ì˜ì„œ    |
|        |                                           | ğŸ”„ ì„¤ê³„ì„œ (PDF)  |
|        |                                           | â³ ì•„í‚¤í…ì²˜ë³€ê²½  |
|        |                                           |                  |
|        |                                           | ì˜ˆìƒ ì™„ë£Œ: ~30ì´ˆ |
|        |                                           |                  |
|        |                                           | [ì·¨ì†Œ]           |
|        |                                           |                  |
+--------+-------------------------------------------+------------------+

--- ì™„ë£Œ í›„ ---

|        |                                           | Export ì™„ë£Œ!     |
|        |                                           |                  |
|        |                                           | ğŸ“¦ evidence_     |
|        |                                           |   2026-02-08.zip |
|        |                                           | í¬ê¸°: 4.2MB      |
|        |                                           | í•­ëª©: 3ê±´        |
|        |                                           |                  |
|        |                                           | [â¬‡ ë‹¤ìš´ë¡œë“œ]     |
|        |                                           | [ğŸ“‹ ë¡œê·¸ í™•ì¸]   |
|        |                                           |                  |
```

---

## 4. Presetë³„ ì°¨ì´

### 4.1 AUDIT_EVIDENCE Preset (ìœ ì¼)

ê°ì‚¬ ì¦ë¹™ í™”ë©´ì€ **AUDIT_EVIDENCE Presetë§Œ ì§€ì›**í•œë‹¤.
00_ì´ê´„ Â§8.4ì— ë”°ë¼ ë‹¤ë¥¸ Presetìœ¼ë¡œì˜ ì „í™˜ì´ ì°¨ë‹¨ëœë‹¤.

| í•­ëª© | AUDIT_EVIDENCE |
|------|---------------|
| **ëŒ€ìƒ ì—­í• ** | External Auditor (ì™¸ë¶€ ê°ì‚¬) |
| **UI ë°€ë„** | `compact` |
| **Right Panel ê¸°ë³¸** | `closed` (ì¦ë¹™ ì„ íƒ ì‹œ `open`) |
| **Preset ì „í™˜** | **ë¶ˆê°€** (locked) |
| **ë‹¤ë¥¸ í™”ë©´ ì´ë™** | Lineage, Reports, PMO(ìš”ì•½), Statsë§Œ ì ‘ê·¼ ê°€ëŠ¥ (00_ì´ê´„ Â§3) |
| **CTA** | ZIP ë‹¤ìš´ë¡œë“œ, PDF í†µí•© ë¦¬í¬íŠ¸ |
| **í•„í„° ê¸°ë³¸ê°’** | ì—†ìŒ (ì „ì²´ í‘œì‹œ) |

### 4.2 ë‹¤ë¥¸ Presetì—ì„œì˜ ì ‘ê·¼ ì°¨ë‹¨

```typescript
// 00_ì´ê´„ Â§8.4 Preset ì „í™˜ ì •ì±… ì ìš©
const PRESET_TRANSITION_RULES: Record<ViewModePreset, ViewModePreset[]> = {
  EXEC_SUMMARY:      ["PMO_CONTROL", "PM_WORK", "DEV_EXECUTION", "CUSTOMER_APPROVAL"],
  PMO_CONTROL:       ["EXEC_SUMMARY", "PM_WORK", "DEV_EXECUTION", "CUSTOMER_APPROVAL"],
  PM_WORK:           ["EXEC_SUMMARY", "PMO_CONTROL", "DEV_EXECUTION", "CUSTOMER_APPROVAL"],
  DEV_EXECUTION:     ["EXEC_SUMMARY", "PMO_CONTROL", "PM_WORK", "CUSTOMER_APPROVAL"],
  CUSTOMER_APPROVAL: ["EXEC_SUMMARY", "PMO_CONTROL", "PM_WORK", "DEV_EXECUTION"],
  AUDIT_EVIDENCE:    [],  // â˜… ì „í™˜ ë¶ˆê°€
};

// Route Guard: /audit/evidence ì ‘ê·¼ ì‹œ AUDIT_EVIDENCE ì—­í• ì´ ì•„ë‹ˆë©´ ì°¨ë‹¨
function AuditEvidenceRouteGuard({ children }: { children: React.ReactNode }) {
  const { capabilities } = useAccessContext();

  if (!capabilities.includes("export_audit_evidence")) {
    return <Navigate to="/unauthorized" replace />;
  }

  return <>{children}</>;
}
```

### 4.3 Preset ì „í™˜ UI ì°¨ì´

ì¼ë°˜ í™”ë©´ì—ì„œëŠ” Page Headerì— Preset Switcherê°€ í‘œì‹œë˜ì§€ë§Œ,
ê°ì‚¬ ì¦ë¹™ í™”ë©´ì—ì„œëŠ” **ì „í™˜ ë¶ˆê°€ í‘œì‹œ**ë§Œ ë…¸ì¶œëœë‹¤.

```
ì¼ë°˜ í™”ë©´ Page Header:
+----------------------------------------------------------+
|  ëŒ€ì‹œë³´ë“œ  [ Preset: PM â–¼ ]  (ë“œë¡­ë‹¤ìš´ í™œì„±)               |
+----------------------------------------------------------+

ê°ì‚¬ ì¦ë¹™ Page Header:
+----------------------------------------------------------+
|  Evidence Export  [ Preset: AUDIT ğŸ”’ ]  (ë“œë¡­ë‹¤ìš´ ë¹„í™œì„±)  |
|  â“˜ ê°ì‚¬ ì „ìš© í™”ë©´ -- Preset ì „í™˜ì´ ì œí•œë©ë‹ˆë‹¤              |
+----------------------------------------------------------+
```

---

## 5. ì¦ë¹™ íŒ¨í‚¤ì§€ ìƒì„± ì›Œí¬í”Œë¡œìš°

### 5.1 ì „ì²´ íë¦„

```
+------------------------------------------------------------------------+
|                                                                          |
|  [1] í•„í„° ì„¤ì •     [2] ì¦ë¹™ ì„ íƒ      [3] ì œì¶œ ìš”ì•½     [4] Export      |
|  +-------------+   +---------------+   +-------------+   +-----------+  |
|  | Phase ì„ íƒ  |   | ì²´í¬ë°•ìŠ¤ ì„ íƒ  |   | Cover Sheet |   | í˜•ì‹ ì„ íƒ |  |
|  | ìœ í˜• ì„ íƒ   |-->| ì „ì²´ ì„ íƒ/í•´ì œ |-->| ë²”ìœ„ í™•ì¸   |-->| ZIP / PDF |  |
|  | ìƒíƒœ í•„í„°   |   | ë¯¸ë¦¬ë³´ê¸° í™•ì¸  |   | í™•ì¸ ì²´í¬   |   | íŒ¨í‚¤ì§€ ìƒì„±|  |
|  | ê¸°ê°„ ë²”ìœ„   |   |               |   | (v2.1)      |   | ë‹¤ìš´ë¡œë“œ   |  |
|  +-------------+   +---------------+   +-------------+   +-----------+  |
|                          |                   |                |          |
|                          v                   v                v          |
|                    Preview Panel       Cover Sheet       Audit Trail    |
|                    (Right Panel)       (Right Panel)     (ì„œë²„ ê¸°ë¡)    |
|                                                                          |
+------------------------------------------------------------------------+
```

### 5.2 ë‹¨ê³„ë³„ ìƒì„¸

#### Step 1: í•„í„° ì„¤ì •

```typescript
interface EvidenceFilterState {
  phaseId?: string;
  evidenceType?: EvidenceType;
  dateRange?: { from?: string; to?: string };
  status?: EvidenceStatus;
  q?: string;
}

type EvidenceType =
  | "deliverable"
  | "test_result"
  | "decision_record"
  | "change_history"
  | "approval_log"
  | "meeting_minutes";

type EvidenceStatus = "approved" | "pending" | "rejected" | "missing";
```

- Phase ë“œë¡­ë‹¤ìš´: í”„ë¡œì íŠ¸ì˜ ì „ì²´ ë‹¨ê³„ ëª©ë¡ (ì „ì²´/PH-1/PH-2/...)
- ìœ í˜• ë“œë¡­ë‹¤ìš´: 6ê°€ì§€ ì¦ë¹™ ìœ í˜•
- ìƒíƒœ ë“œë¡­ë‹¤ìš´: approved/pending/rejected/missing
- ê¸°ê°„ ë²”ìœ„: DateRangePicker (from ~ to)
- ê²€ìƒ‰ì–´: ì œëª©/ì„¤ëª… í…ìŠ¤íŠ¸ ê²€ìƒ‰

#### Step 2: ì¦ë¹™ ì„ íƒ

```typescript
interface EvidenceSelectionState {
  /** ì„ íƒëœ ì¦ë¹™ í•­ëª© ID ëª©ë¡ */
  selectedIds: string[];
  /** ì „ì²´ ì„ íƒ ì—¬ë¶€ -- v2.1: ì„œë²„ ì „ì²´ ê¸°ì¤€ (í˜„ì¬ í˜ì´ì§€ê°€ ì•„ë‹˜) */
  selectAll: boolean;
  /** v2.1: selectAll ì‹œ ì„œë²„ì—ì„œ ë°˜í™˜í•œ ì „ì²´ ID ìˆ˜ (pagination í™˜ê²½ ëŒ€ì‘) */
  serverTotalCount?: number;
  /** í˜„ì¬ ë¯¸ë¦¬ë³´ê¸° ì¤‘ì¸ í•­ëª© ID */
  previewId?: string;
}
```

- ì²´í¬ë°•ìŠ¤ ê¸°ë°˜ ë‹¤ì¤‘ ì„ íƒ
- í—¤ë” ì²´í¬ë°•ìŠ¤: ì „ì²´ ì„ íƒ/í•´ì œ
- í–‰ í´ë¦­: í•´ë‹¹ í•­ëª© ë¯¸ë¦¬ë³´ê¸° (Right Panel)
- ì„ íƒ ê±´ìˆ˜ + ì˜ˆìƒ ìš©ëŸ‰ í•˜ë‹¨ í‘œì‹œ
- **pending/missing ìƒíƒœ í•­ëª©ë„ ì„ íƒ ê°€ëŠ¥** (ë‹¨, Export ì‹œ Cover Sheetì—ì„œ ê²½ê³  í‘œì‹œ)

> **v2.1 ì „ì²´ì„ íƒ(Select All) ì •ì±…**:
> - **ì •ì±… A ì±„íƒ(ì„œë²„ ì „ì²´)**: "ì „ì²´ì„ íƒ"ì€ í˜„ì¬ í•„í„° ê²°ê³¼ì˜ **ì„œë²„ ê¸°ì¤€ ì „ì²´**ë¥¼ ì˜ë¯¸í•œë‹¤ (í˜„ì¬ í˜ì´ì§€ë§Œì´ ì•„ë‹˜).
> - selectAll=trueì¼ ë•Œ, í”„ë¡ íŠ¸ì—”ë“œëŠ” ê°œë³„ ID ëŒ€ì‹  `{ selectAll: true, filter: currentFilter }` í˜•íƒœë¡œ Export ìš”ì²­ì„ ë³´ë‚¸ë‹¤.
> - í•˜ë‹¨ ë°”ì— **"í˜„ì¬ í•„í„° ê²°ê³¼ Nê±´ ì¤‘ Mê±´ ì„ íƒ"** ë¬¸êµ¬ë¥¼ ê³ ì • í‘œì‹œí•˜ì—¬ ë²”ìœ„ë¥¼ ëª…í™•íˆ í•œë‹¤.
> - pagination í™˜ê²½ì—ì„œ í˜¼ë™ ë°©ì§€ë¥¼ ìœ„í•´ selectAll ì²´í¬ ì‹œ "í•„í„° ê²°ê³¼ ì „ì²´ Nê±´ì´ ì„ íƒë©ë‹ˆë‹¤" í† ìŠ¤íŠ¸ í‘œì‹œ.

#### Step 3: Export (íŒ¨í‚¤ì§€ ìƒì„±)

```typescript
interface ExportRequest {
  projectId: string;
  evidenceIds: string[];
  format: "zip" | "pdf";
  /** íŒ¨í‚¤ì§€ ë©”íƒ€ë°ì´í„° */
  metadata?: {
    auditPeriod?: string;       // "2026-01-01 ~ 2026-02-08"
    auditorName?: string;       // "ê¹€ê°ì‚¬"
    auditPurpose?: string;      // "ì •ê¸° ê°ì‚¬"
  };
}

interface ExportResponse {
  /** íŒ¨í‚¤ì§€ ê³ ìœ  ID */
  packageId: string;
  /** ìƒì„± ìƒíƒœ */
  status: "processing" | "completed" | "failed";
  /** ì§„í–‰ë¥  (0~100) */
  progress: number;
  /** ë‹¤ìš´ë¡œë“œ URL (completed ì‹œ) */
  downloadUrl?: string;
  /** íŒ¨í‚¤ì§€ ì •ë³´ */
  packageInfo?: {
    fileName: string;           // "evidence_2026-02-08_PH-2.zip"
    fileSize: number;           // bytes
    itemCount: number;
    createdAt: string;
  };
  /** Audit Trail ID */
  auditTrailId: string;
}
```

### 5.3 Export í˜•ì‹ë³„ ì°¨ì´

| í•­ëª© | ZIP íŒ¨í‚¤ì§€ | PDF í†µí•© ë¦¬í¬íŠ¸ |
|------|-----------|---------------|
| **ë‚´ìš©** | ì›ë³¸ íŒŒì¼ ë²ˆë“¤ (ê° íŒŒì¼ ìœ ì§€) | ëª¨ë“  ì¦ë¹™ì„ ë‹¨ì¼ PDFë¡œ í•©ì¹¨ |
| **êµ¬ì¡°** | í´ë” ê³„ì¸µ (Phase/Type/íŒŒì¼) | ëª©ì°¨ + í˜ì´ì§€ë³„ ì¦ë¹™ |
| **ë©”íƒ€ë°ì´í„°** | `manifest.json` í¬í•¨ | í‘œì§€ + ëª©ì°¨ + ë©”íƒ€ í˜ì´ì§€ |
| **ìš©ë„** | ì›ë³¸ ì œì¶œ (íŒŒì¼ ë‹¨ìœ„ ê²€ì¦) | ìš”ì•½ ë¦¬í¬íŠ¸ (ì¼ê´„ ì—´ëŒ) |
| **í¬ê¸°** | ì›ë³¸ í•©ì‚° í¬ê¸° | ì›ë³¸ë³´ë‹¤ ì‘ì„ ìˆ˜ ìˆìŒ (ì´ë¯¸ì§€ ì••ì¶•) |

### 5.4 ZIP íŒ¨í‚¤ì§€ êµ¬ì¡°

```
evidence_2026-02-08_PH-2.zip
â”œâ”€â”€ manifest.json                    // íŒ¨í‚¤ì§€ ë©”íƒ€ë°ì´í„°
â”œâ”€â”€ Phase_1_ìš”ê±´ë¶„ì„/
â”‚   â”œâ”€â”€ deliverables/
â”‚   â”‚   â””â”€â”€ ìš”ê±´ì •ì˜ì„œ_v3.pdf
â”‚   â””â”€â”€ approval_logs/
â”‚       â””â”€â”€ ìš”ê±´ì •ì˜ì„œ_ìŠ¹ì¸ê¸°ë¡.pdf
â”œâ”€â”€ Phase_2_ì„¤ê³„/
â”‚   â”œâ”€â”€ deliverables/
â”‚   â”‚   â””â”€â”€ ì„¤ê³„ì„œ_v2.pdf
â”‚   â”œâ”€â”€ decision_records/
â”‚   â”‚   â””â”€â”€ ì•„í‚¤í…ì²˜ë³€ê²½_001.pdf
â”‚   â”œâ”€â”€ test_results/
â”‚   â”‚   â””â”€â”€ ë‹¨ìœ„í…ŒìŠ¤íŠ¸_ê²°ê³¼.xlsx
â”‚   â”œâ”€â”€ change_history/
â”‚   â”‚   â””â”€â”€ REQ-034_ë³€ê²½ì´ë ¥.pdf
â”‚   â”œâ”€â”€ approval_logs/
â”‚   â”‚   â””â”€â”€ DLV-007_ìŠ¹ì¸ê¸°ë¡.pdf
â”‚   â””â”€â”€ meeting_minutes/
â”‚       â””â”€â”€ ì£¼ê°„íšŒì˜_0205.pdf
â””â”€â”€ index.html                       // ë¸Œë¼ìš°ì €ì—ì„œ ì—´ ìˆ˜ ìˆëŠ” ì¸ë±ìŠ¤
```

### 5.5 manifest.json ìŠ¤í‚¤ë§ˆ

```typescript
interface EvidenceManifest {
  packageId: string;
  projectId: string;
  projectName: string;
  createdAt: string;                 // ISO datetime
  createdBy: {
    userId: string;
    name: string;
    role: "EXTERNAL_AUDITOR";
  };
  auditMetadata?: {
    auditPeriod?: string;
    auditorName?: string;
    auditPurpose?: string;
  };

  // --- v2.1: ë´‰ì¸(Seal) ë©”íƒ€ë°ì´í„° ---
  /** Export ìš”ì²­ ë‹¹ì‹œ ì ìš©ëœ í•„í„° ìŠ¤ëƒ…ìƒ· */
  filterSnapshot: Partial<AuditEvidenceFilterSpec>;
  /** ì¦ë¹™ ì •ì±… ë²„ì „ + í•´ì‹œ (ì •ì±… ë³€ê²½ ì‹œ ì»¤ë²„ë¦¬ì§€ ê¸°ì¤€ì´ ë‹¬ë¼ì§€ë¯€ë¡œ ê³ ì •) */
  policySnapshot: {
    policyVersion: string;           // "evidence-policy@2026-02-01"
    policyHash: string;              // SHA-256 of policy definition
  };
  /** ë°ì´í„° ê¸°ì¤€ ì‹œê° */
  asOf: string;                      // ISO datetime
  /** íŒ¨í‚¤ì§€ ë´‰ì¸ ì‹œê° (completed ì „í™˜ ì‹œì ) */
  sealedAt: string;                  // ISO datetime
  /** ë´‰ì¸ í–‰ìœ„ì */
  sealedBy: {
    userId: string;
    name: string;
  };
  /** ì„ íƒëœ evidenceIds ì •ë ¬ í›„ SHA-256 í•´ì‹œ (ì„ íƒ ì§‘í•© ê²€ì¦ìš©) */
  selectionHash: string;

  items: {
    id: string;
    type: EvidenceType;
    title: string;
    phaseName: string;
    phaseId: string;
    status: EvidenceStatus;
    approvedAt?: string;
    approvedBy?: string;
    filePath: string;                // ZIP ë‚´ ìƒëŒ€ ê²½ë¡œ
    fileSize: number;
    hash: string;                    // SHA-256 (ë¬´ê²°ì„± ê²€ì¦)
    /** v2.1: íŒŒì¼ ì—…ë¡œë“œ ë²„ì „ (ë¦¬ë¹„ì „ ì¶”ì ) */
    fileVersion?: string;
    fileUploadedAt?: string;
  }[];
  totalItems: number;
  totalSize: number;
  integrityHash: string;            // ì „ì²´ íŒ¨í‚¤ì§€ SHA-256
}
```

### 5.6 PDF í†µí•© ë¦¬í¬íŠ¸ êµ¬ì¡°

```
+-----------------------------------+
|  AIMAX AI-PMS                      |
|  Audit Evidence Report             |
|                                    |
|  Project: AI ë³´í—˜ê¸ˆì§€ê¸‰ì‹¬ì‚¬ êµ¬ì¶•    |
|  Period: 2026-01-01 ~ 2026-02-08   |
|  Auditor: ê¹€ê°ì‚¬                   |
|  Generated: 2026-02-08 10:30       |
|                                    |
|  âš  ë¯¸ìŠ¹ì¸ ì¦ë¹™ 1ê±´ í¬í•¨ (v2.1)    |
|  Filter: Phase=PH-2, ì „ì²´ìœ í˜•     |
|  Policy: evidence-policy@2026-02   |
+-----------------------------------+
|                                    |
|  Table of Contents                 |
|  1. ìš”ê±´ì •ì˜ì„œ_v3 ... âœ… ..... 3   |
|  2. ì„¤ê³„ì„œ_v2 ....... âœ… ..... 15  |
|  3. ë‹¨ìœ„í…ŒìŠ¤íŠ¸_ê²°ê³¼ . â³ ..... 63  |
|  4. ì•„í‚¤í…ì²˜ë³€ê²½_001  âœ… ..... 78  |
|                                    |
+-----------------------------------+
|  Page 3~14: ìš”ê±´ì •ì˜ì„œ_v3          |
|  (ì›ë³¸ PDF ì‚½ì…)                   |
+-----------------------------------+
|  Page 15~62: ì„¤ê³„ì„œ_v2             |
|  (ì›ë³¸ PDF ì‚½ì…)                   |
+-----------------------------------+
|  ...                               |
+-----------------------------------+
|  Appendix A: Audit Trail Log       |
|  (Export í–‰ìœ„ ë¡œê·¸)                 |
+-----------------------------------+
|  Appendix B: Seal Metadata (v2.1)  |
|  filterSnapshot / policySnapshot   |
|  selectionHash / sealedAt          |
+-----------------------------------+
```

> **v2.1 PDF ë¶€ë¶„ ì‹¤íŒ¨ ì •ì±…**:
> - PDF ë³‘í•©ì€ íŒŒì¼ í¬ë§·/í°íŠ¸/ì•”í˜¸í™”/ì†ìƒ PDF ë•Œë¬¸ì— ì‹¤íŒ¨ê°€ ì¦ìŒ
> - **ZIPì€ "ê°€ê¸‰ì  í•­ìƒ ì„±ê³µ"**, PDFëŠ” **"ë¶€ë¶„ ì‹¤íŒ¨ í—ˆìš©"** ì •ì±… ì ìš©
> - PDF ë³‘í•© ì‹¤íŒ¨ í•­ëª©ì€ ëª©ì°¨ì— `[âŒ ë³€í™˜ ì‹¤íŒ¨]` í‘œì‹œ + í˜ì´ì§€ ìŠ¤í‚µ
> - 1ê±´ì´ë¼ë„ ì‹¤íŒ¨ ì‹œ ExportStatusResponseì— `partialFailure: true` + ì‹¤íŒ¨ í•­ëª© ëª©ë¡
> - ì‹¤íŒ¨ ë¹„ìœ¨ì´ 50% ì´ˆê³¼ ì‹œ PDF Export ìì²´ë¥¼ fail ì²˜ë¦¬ + "ZIPìœ¼ë¡œ ëŒ€ì²´ ë‹¤ìš´ë¡œë“œ" ê¶Œìœ 

### 5.7 ì œì¶œ ìš”ì•½(Cover Sheet) (v2.1)

Export ë²„íŠ¼ í´ë¦­ í›„, **ì¦‰ì‹œ Exportë¥¼ ì‹œì‘í•˜ì§€ ì•Šê³ ** Right Panelì— ì œì¶œ ìš”ì•½(Cover Sheet)ì„ í‘œì‹œí•œë‹¤.
ì‚¬ìš©ìê°€ ë²”ìœ„ë¥¼ í™•ì¸í•˜ê³  **í™•ì¸ ì²´í¬(checkbox)**ë¥¼ í•œ ë’¤ì—ë§Œ Exportê°€ ì‹œì‘ëœë‹¤.

> **í•µì‹¬ ëª©ì **: "PH-2ë§Œ ë‚´ë³´ë‚´ì•¼ í•˜ëŠ”ë° ì „ì²´ê°€ ë‚˜ê°", "pending í¬í•¨ì„ ëª¨ë¥´ê³  ì œì¶œ" ê°™ì€ ìŠ¤ì½”í”„ ì˜¤ë¥˜ë¥¼ ì‚¬ì „ ì°¨ë‹¨í•œë‹¤.

#### Cover Sheet í‘œì‹œ í•­ëª©

| í•­ëª© | ë‚´ìš© | ìœ„í—˜ ì‹œ ê°•ì¡° |
|------|------|------------|
| **í”„ë¡œì íŠ¸** | í”„ë¡œì íŠ¸ëª… + ID | - |
| **ê¸°ê°„ ë²”ìœ„** | dateRange (ë¯¸ì§€ì • ì‹œ "ì „ì²´ê¸°ê°„") | âš  "ê¸°ê°„ ë¯¸ì§€ì •(ì „ì²´ê¸°ê°„)" |
| **Phase ë²”ìœ„** | í•„í„°ëœ Phase ëª©ë¡ (ë¯¸ì§€ì • ì‹œ "ì „ì²´ Phase") | âš  "ì „ì²´ Phase" |
| **í¬í•¨ í•­ëª© ìˆ˜** | approved/pending/rejected/missingë³„ ê±´ìˆ˜ | âš  pending Nê±´, âš  rejected Nê±´ |
| **ì¦ë¹™ ìœ í˜• ë¶„í¬** | evidenceTypeë³„ ê±´ìˆ˜ (ì‚°ì¶œë¬¼ 3, í…ŒìŠ¤íŠ¸ 2, ...) | - |
| **ì˜ˆìƒ í¬ê¸°** | ZIP/PDF ì˜ˆìƒ íŒŒì¼ í¬ê¸° | âš  >100MB |
| **Export í˜•ì‹** | ZIP / PDF | - |
| **ê°ì‚¬ ë©”íƒ€ë°ì´í„°** | ê°ì‚¬ ê¸°ê°„/ê°ì‚¬ìëª…/ê°ì‚¬ ëª©ì  (ì…ë ¥ í¼) | - |

#### Cover Sheet ì™€ì´ì–´í”„ë ˆì„

```
+------------------------------------------+
|  Cover Sheet (Right Panel 420px)          |
|                                           |
|  â”€â”€ ì œì¶œ ìš”ì•½ â”€â”€                          |
|                                           |
|  í”„ë¡œì íŠ¸: AI ë³´í—˜ê¸ˆì§€ê¸‰ì‹¬ì‚¬ êµ¬ì¶•         |
|  ê¸°ê°„: 2026-01-01 ~ 2026-02-08           |
|  Phase: PH-2 ì„¤ê³„                         |
|  í˜•ì‹: ZIP                                |
|                                           |
|  â”€â”€ í¬í•¨ í•­ëª© â”€â”€                          |
|  âœ… ìŠ¹ì¸:  8ê±´                            |
|  â³ ëŒ€ê¸°:  2ê±´  âš  ë¯¸ìŠ¹ì¸ í¬í•¨            |
|  âŒ ë°˜ë ¤:  0ê±´                            |
|  ì´: 10ê±´ (ì˜ˆìƒ 12.5MB)                   |
|                                           |
|  â”€â”€ ìœ í˜• ë¶„í¬ â”€â”€                          |
|  ì‚°ì¶œë¬¼: 4 | í…ŒìŠ¤íŠ¸: 2 | ê²°ì •: 2          |
|  ë³€ê²½ì´ë ¥: 1 | ìŠ¹ì¸ë¡œê·¸: 1                |
|                                           |
|  â”€â”€ ê°ì‚¬ ë©”íƒ€ë°ì´í„° (ì„ íƒ) â”€â”€             |
|  ê°ì‚¬ ê¸°ê°„: [_______________]             |
|  ê°ì‚¬ìëª…:  [_______________]             |
|  ê°ì‚¬ ëª©ì : [_______________]             |
|                                           |
|  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  |
|  â”‚ [x] ìœ„ ì œì¶œ ë²”ìœ„ë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤     â”‚  |
|  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  |
|                                           |
|  +------------------+ +----------+        |
|  | Export ì‹œì‘      | | ì·¨ì†Œ     |        |
|  +------------------+ +----------+        |
|                                           |
+------------------------------------------+
```

#### Cover Sheet ì¸í„°í˜ì´ìŠ¤

```typescript
interface ExportCoverSheetProps {
  /** ì„ íƒëœ ì¦ë¹™ ìš”ì•½ */
  selectionSummary: {
    totalCount: number;
    byStatus: Record<EvidenceStatus, number>;
    byType: Record<EvidenceType, number>;
    estimatedSize: number;          // bytes
    phases: string[];               // í¬í•¨ëœ Phase ì´ë¦„ ëª©ë¡
  };
  /** í˜„ì¬ ì ìš©ëœ í•„í„° */
  appliedFilter: Partial<AuditEvidenceFilterSpec>;
  /** Export í˜•ì‹ */
  format: "zip" | "pdf";
  /** ê°ì‚¬ ë©”íƒ€ë°ì´í„° ì…ë ¥ */
  metadata: ExportMetadata;
  onMetadataChange: (metadata: ExportMetadata) => void;
  /** í™•ì¸ ì²´í¬ ìƒíƒœ */
  confirmed: boolean;
  onConfirmChange: (confirmed: boolean) => void;
  /** Export ì‹œì‘ */
  onExport: () => void;
  /** ì·¨ì†Œ */
  onCancel: () => void;
}

/** v2.1: Cover Sheet ìœ„í—˜ í•­ëª© ìë™ ê°ì§€ */
interface CoverSheetWarning {
  code: "PENDING_INCLUDED" | "NO_DATE_RANGE" | "ALL_PHASES" | "LARGE_PACKAGE" | "REJECTED_INCLUDED";
  message: string;
  severity: "warning" | "critical";
}
```

---

## 6. ë°ì´í„° êµ¬ì¡° / API

### 6.1 Evidence Summary API

```
GET /api/audit/evidence/summary?projectId={projectId}
```

```typescript
interface EvidenceSummary {
  project: {
    id: string;
    name: string;
  };

  // KPI Metrics
  metrics: {
    /** v2.1: ì œì¶œìš© ì»¤ë²„ë¦¬ì§€ (0~100%) -- approved / required * 100 (í° ìˆ«ì, ê¸°ë³¸) */
    submissionReadyCoverage: number;
    /** v2.1: ì§„í–‰ í¬í•¨ ì»¤ë²„ë¦¬ì§€ (0~100%) -- (approved + pending) / required * 100 (ë³´ì¡°) */
    inProgressCoverage: number;
    /** ìŠ¹ì¸ ëŒ€ê¸° ê±´ìˆ˜ */
    pendingApprovals: number;
    /** ì „ì²´ ì¦ë¹™ í•­ëª© ìˆ˜ (required ê¸°ì¤€) */
    totalEvidenceItems: number;
    /** ëˆ„ì  Export íšŸìˆ˜ */
    exportCount: number;
    /** ëˆ„ë½ ì¦ë¹™ ê±´ìˆ˜ */
    missingEvidenceCount: number;
  };

  // Phaseë³„ Compliance ìƒíƒœ
  compliance: {
    phaseId: string;
    phaseName: string;
    phaseOrder: number;
    /** í•´ë‹¹ ë‹¨ê³„ í•„ìš” ì¦ë¹™ ìˆ˜ */
    required: number;
    /** ìŠ¹ì¸ ì™„ë£Œ ì¦ë¹™ ìˆ˜ */
    approved: number;
    /** ìŠ¹ì¸ ëŒ€ê¸° ì¦ë¹™ ìˆ˜ */
    pending: number;
    /** ëˆ„ë½ ì¦ë¹™ ìˆ˜ */
    missing: number;
    /** í•´ë‹¹ ë‹¨ê³„ ì»¤ë²„ë¦¬ì§€ (%) */
    coverage: number;
    /** ìƒíƒœ */
    status: "complete" | "partial" | "not_started";
  }[];

  // ìµœê·¼ Export ì´ë ¥
  recentExports: {
    packageId: string;
    createdAt: string;
    format: "zip" | "pdf";
    itemCount: number;
    fileSize: number;
    downloadUrl: string;
  }[];

  // --- ì‹ ë¢°ë„ 3-tuple ---
  asOf: string;
  completeness: {
    deliverables: CompletenessStatus;
    testResults: CompletenessStatus;
    decisionRecords: CompletenessStatus;
    changeHistory: CompletenessStatus;
    approvalLogs: CompletenessStatus;
    meetingMinutes: CompletenessStatus;
  };
  warnings: {
    code: string;
    message: string;
    severity: "info" | "warning" | "error";
  }[];
}
```

### 6.2 Evidence List API

```
GET /api/audit/evidence?projectId={projectId}
    &phaseId={phaseId}
    &evidenceType={evidenceType}
    &dateFrom={dateFrom}
    &dateTo={dateTo}
    &status={status}
    &q={searchText}
    &page={page}
    &size={size}
    &sort={sort}
```

> **ì°¸ê³ **: ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ëŠ” 2.2 FilterSpec í‚¤ì™€ **1:1 ë§¤í•‘**ëœë‹¤.
> dateRange -> dateFrom + dateToë¡œ flat ë³€í™˜.

```typescript
interface EvidenceListResponse {
  items: EvidenceItem[];
  pagination: {
    page: number;
    size: number;
    totalItems: number;
    totalPages: number;
  };

  // í•„í„° ì ìš© ê²°ê³¼ ìš”ì•½
  filterSummary: {
    appliedFilters: Partial<AuditEvidenceFilterSpec>;
    matchedCount: number;
    totalCount: number;
  };

  asOf: string;
}

interface EvidenceItem {
  id: string;
  /** ì¦ë¹™ ìœ í˜• */
  type: EvidenceType;
  /** í•­ëª©ëª… */
  title: string;
  /** ì„¤ëª… */
  description?: string;
  /** ì†Œì† Phase */
  phase: {
    id: string;
    name: string;
    order: number;
  };
  /** ì¦ë¹™ ìƒíƒœ */
  status: EvidenceStatus;
  /** ì›ë³¸ ì—”í‹°í‹° ì°¸ì¡° */
  sourceEntity: {
    entityType: "deliverable" | "test_case" | "decision" | "issue" | "meeting" | "approval";
    entityId: string;
    entityTitle: string;
  };
  /** íŒŒì¼ ì •ë³´ (íŒŒì¼ì´ ìˆëŠ” ê²½ìš°) */
  file?: {
    fileName: string;
    fileSize: number;
    mimeType: string;
    uploadedAt: string;
    downloadUrl: string;
  };
  /** ìŠ¹ì¸ ì •ë³´ */
  approval?: {
    approvedAt: string;
    approvedBy: {
      userId: string;
      name: string;
    };
    comment?: string;
  };
  /** ìƒì„±/ìˆ˜ì • ì‹œê°„ */
  createdAt: string;
  updatedAt: string;
}
```

### 6.3 Evidence Detail API

```
GET /api/audit/evidence/:evidenceId
```

```typescript
interface EvidenceDetailResponse {
  evidence: EvidenceItem;
  /** ê´€ë ¨ Trace Chain (Lineage ì—°ê²°) */
  traceChain?: {
    requirement?: { id: string; title: string };
    epic?: { id: string; title: string };
    story?: { id: string; title: string };
    testCase?: { id: string; title: string };
    deliverable?: { id: string; title: string };
  };
  /** ìŠ¹ì¸ ì´ë ¥ */
  approvalHistory: {
    action: "submitted" | "approved" | "rejected" | "resubmitted";
    by: { userId: string; name: string };
    at: string;
    comment?: string;
  }[];
  /** ë³€ê²½ ì´ë ¥ */
  changeHistory: {
    field: string;
    oldValue: string;
    newValue: string;
    changedBy: { userId: string; name: string };
    changedAt: string;
  }[];
}
```

### 6.4 Evidence Export API

#### 6.4.1 íŒ¨í‚¤ì§€ ìƒì„± ìš”ì²­

```
POST /api/audit/evidence/export
```

```typescript
// Request
interface ExportEvidenceRequest {
  projectId: string;
  evidenceIds: string[];
  format: "zip" | "pdf";
  metadata?: {
    auditPeriod?: string;
    auditorName?: string;
    auditPurpose?: string;
  };
}

// Response (202 Accepted -- ë¹„ë™ê¸° ì²˜ë¦¬)
interface ExportEvidenceResponse {
  packageId: string;
  status: "processing";
  estimatedDuration: number;     // seconds
  pollUrl: string;               // "/api/audit/evidence/export/{packageId}"
  auditTrailId: string;
}
```

#### 6.4.2 íŒ¨í‚¤ì§€ ìƒì„± ìƒíƒœ í´ë§

```
GET /api/audit/evidence/export/:packageId
```

```typescript
interface ExportStatusResponse {
  packageId: string;
  status: "processing" | "completed" | "partial" | "failed";  // v2.1: partial ì¶”ê°€
  progress: number;              // 0~100
  processedItems: {
    evidenceId: string;
    title: string;
    status: "completed" | "processing" | "pending" | "failed";
    error?: string;
  }[];
  /** completed/partial ì‹œ ë‹¤ìš´ë¡œë“œ ì •ë³´ */
  result?: {
    downloadUrl: string;
    fileName: string;
    fileSize: number;
    itemCount: number;
    createdAt: string;
    expiresAt: string;           // ë‹¤ìš´ë¡œë“œ ë§í¬ ë§Œë£Œ ì‹œê°„ (24ì‹œê°„)
    integrityHash: string;       // SHA-256

    // --- v2.1: ë´‰ì¸(Seal) ë©”íƒ€ë°ì´í„° ---
    sealedAt: string;            // ë´‰ì¸ ì‹œê° (completed ì „í™˜ ì‹œì )
    sealedBy: {
      userId: string;
      name: string;
    };
    selectionHash: string;       // evidenceIds ì •ë ¬ í›„ SHA-256
    filterSnapshot: Partial<AuditEvidenceFilterSpec>;
    policySnapshot: {
      policyVersion: string;
      policyHash: string;
    };
  };
  /** v2.1: PDF ë¶€ë¶„ ì‹¤íŒ¨ ì •ë³´ (status=partial ì‹œ) */
  partialFailure?: {
    successCount: number;
    failedCount: number;
    failedItems: { evidenceId: string; title: string; reason: string }[];
    fallbackFormat?: "zip";      // "ZIPìœ¼ë¡œ ëŒ€ì²´ ë‹¤ìš´ë¡œë“œ" ê¶Œìœ 
  };
  /** failed ì‹œ ì˜¤ë¥˜ ì •ë³´ */
  error?: {
    code: string;
    message: string;
    failedItems: string[];
  };
}
```

#### 6.4.3 íŒ¨í‚¤ì§€ ë‹¤ìš´ë¡œë“œ

```
GET /api/audit/evidence/export/:packageId/download
```

> **ì¸ì¦ í•„ìˆ˜**: JWT + `export_audit_evidence` Capability ê²€ì¦
> **Audit Trail**: ë‹¤ìš´ë¡œë“œ í–‰ìœ„ë„ ë³„ë„ ë¡œê¹…

#### 6.4.4 ì—ëŸ¬ ê³„ì•½ ëª…ì„¸

| HTTP Status | Error Code | ì›ì¸ | í”„ë¡ íŠ¸ì—”ë“œ ëŒ€ì‘ |
|-------------|-----------|------|---------------|
| 400 | `INVALID_EVIDENCE_IDS` | ì¡´ì¬í•˜ì§€ ì•ŠëŠ” evidenceId í¬í•¨ | ìœ íš¨í•˜ì§€ ì•Šì€ í•­ëª© í‘œì‹œ + ì œê±° ì•ˆë‚´ |
| 400 | `EMPTY_SELECTION` | evidenceIds ë¹ˆ ë°°ì—´ | "1ê°œ ì´ìƒ ì„ íƒí•˜ì„¸ìš”" ë©”ì‹œì§€ |
| 403 | `INSUFFICIENT_CAPABILITY` | `export_audit_evidence` ë¯¸ë³´ìœ  | `/unauthorized` ë¦¬ë‹¤ì´ë ‰íŠ¸ |
| 404 | `PACKAGE_NOT_FOUND` | ì¡´ì¬í•˜ì§€ ì•ŠëŠ” packageId | "íŒ¨í‚¤ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤" ë©”ì‹œì§€ |
| 409 | `EXPORT_IN_PROGRESS` | ë™ì¼ í”„ë¡œì íŠ¸ì— ì§„í–‰ ì¤‘ì¸ Export ì¡´ì¬ | ê¸°ì¡´ Export ìƒíƒœ í˜ì´ì§€ë¡œ ì´ë™ |
| 410 | `DOWNLOAD_EXPIRED` | ë‹¤ìš´ë¡œë“œ ë§í¬ ë§Œë£Œ (24ì‹œê°„) | "ë§í¬ ë§Œë£Œ" ë©”ì‹œì§€ + ì¬ìƒì„± ì•ˆë‚´ |
| 500 | `EXPORT_FAILED` | ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜ | "ì¬ì‹œë„" ë²„íŠ¼ + ê´€ë¦¬ì ë¬¸ì˜ ì•ˆë‚´ |

#### 6.4.5 ë‹¤ìš´ë¡œë“œ URL ì¬ë°œê¸‰ (v2.1)

ê¸°ì¡´ íŒ¨í‚¤ì§€ë¥¼ ì¬ìƒì„±í•˜ì§€ ì•Šê³  **downloadUrlë§Œ ì¬ë°œê¸‰**í•˜ëŠ” ì „ìš© ì—”ë“œí¬ì¸íŠ¸.

```
POST /api/audit/evidence/export/:packageId/reissue
```

```typescript
// Request: body ì—†ìŒ (packageIdë§Œìœ¼ë¡œ ì‹ë³„)

// Response (200 OK)
interface ReissueDownloadUrlResponse {
  packageId: string;
  downloadUrl: string;
  expiresAt: string;              // ì¬ë°œê¸‰ ì‹œì ë¶€í„° 24ì‹œê°„
  /** Audit Trailì— REISSUE_DOWNLOAD_URL ì´ë²¤íŠ¸ ìë™ ê¸°ë¡ */
  auditTrailId: string;
}
```

> **ì¡°ê±´**: status=completedì¸ íŒ¨í‚¤ì§€ë§Œ ì¬ë°œê¸‰ ê°€ëŠ¥. processing/failed ì‹œ 404.
> **ë³´ì•ˆ**: JWT + `export_audit_evidence` Capability ê²€ì¦.
> **Audit Trail**: `REISSUE_DOWNLOAD_URL` ì´ë²¤íŠ¸ë¡œ ë³„ë„ ê¸°ë¡.

### 6.5 Audit Trail API

```
GET /api/audit/evidence/trail?projectId={projectId}&page={page}&size={size}
```

```typescript
interface AuditTrailResponse {
  trails: AuditTrailEntry[];
  pagination: {
    page: number;
    size: number;
    totalItems: number;
    totalPages: number;
  };
}

interface AuditTrailEntry {
  id: string;
  /** í–‰ìœ„ ìœ í˜• */
  action:
    | "VIEW_LIST"              // ì¦ë¹™ ëª©ë¡ ì¡°íšŒ
    | "VIEW_DETAIL"            // ì¦ë¹™ ìƒì„¸ ì¡°íšŒ
    | "SELECT_EVIDENCE"        // ì¦ë¹™ ì„ íƒ (ì²´í¬ë°•ìŠ¤)
    | "PREVIEW_EVIDENCE"       // ì¦ë¹™ ë¯¸ë¦¬ë³´ê¸°
    | "EXPORT_REQUESTED"       // Export ìš”ì²­
    | "EXPORT_SEALED"          // v2.1: íŒ¨í‚¤ì§€ ë´‰ì¸ (ìµœì¢… ì„ íƒì§‘í•©+í•„í„°+ì •ì±… ê³ ì •)
    | "EXPORT_COMPLETED"       // Export ì™„ë£Œ
    | "EXPORT_PARTIAL"         // v2.1: PDF ë¶€ë¶„ ì‹¤íŒ¨ë¡œ ì™„ë£Œ
    | "EXPORT_FAILED"          // Export ì‹¤íŒ¨
    | "DOWNLOAD_PACKAGE"       // íŒ¨í‚¤ì§€ ë‹¤ìš´ë¡œë“œ
    | "DOWNLOAD_INDIVIDUAL"    // ê°œë³„ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
    | "REISSUE_DOWNLOAD_URL";  // v2.1: ë§Œë£Œ í›„ ë‹¤ìš´ë¡œë“œ URL ì¬ë°œê¸‰
  /** í–‰ìœ„ì */
  actor: {
    userId: string;
    name: string;
    role: string;
  };
  /** ëŒ€ìƒ */
  target: {
    type: "evidence" | "package" | "filter";
    id?: string;
    title?: string;
  };
  /** ìƒì„¸ ì •ë³´ */
  details?: Record<string, string>;
  /** í–‰ìœ„ ì‹œê°„ */
  timestamp: string;
  /** IP ì£¼ì†Œ */
  ipAddress: string;
  /** v2.1: IP ì‹ ë¢° ê³„ì¸µ -- í”„ë¡ì‹œ í™˜ê²½ì—ì„œ ì›ë³¸/í”„ë¡ì‹œ IP ëª¨ë‘ ê¸°ë¡ */
  ipTrust?: {
    originalIp: string;            // X-Forwarded-For ìµœì´ˆ IP
    proxyChain: string[];          // í”„ë¡ì‹œ ì²´ì¸ (ì‹ ë¢° í”„ë¡ì‹œ ëª©ë¡ ê¸°ë°˜ ê²€ì¦)
    trusted: boolean;              // ì‹ ë¢° í”„ë¡ì‹œ ê²½ìœ  ì—¬ë¶€
  };
}
```

### 6.6 Compliance Checklist API

```
GET /api/audit/evidence/compliance?projectId={projectId}
```

```typescript
interface ComplianceChecklistResponse {
  projectId: string;
  /** ì „ì²´ ì»¤ë²„ë¦¬ì§€ */
  overallCoverage: number;
  /** Phaseë³„ ì²´í¬ë¦¬ìŠ¤íŠ¸ */
  phases: PhaseComplianceDetail[];
  /** ëˆ„ë½ í•­ëª© ëª©ë¡ */
  missingItems: MissingEvidenceItem[];
  asOf: string;
}

interface PhaseComplianceDetail {
  phaseId: string;
  phaseName: string;
  phaseOrder: number;
  status: "complete" | "partial" | "not_started";
  coverage: number;
  /** ì¦ë¹™ ìœ í˜•ë³„ ìƒì„¸ */
  breakdown: {
    type: EvidenceType;
    typeName: string;
    required: number;
    approved: number;
    pending: number;
    missing: number;
    items: {
      id: string;
      title: string;
      status: EvidenceStatus;
    }[];
  }[];
}

interface MissingEvidenceItem {
  /** ëˆ„ë½ ì¦ë¹™ì´ ì†í•œ Phase */
  phaseId: string;
  phaseName: string;
  /** ëˆ„ë½ ì¦ë¹™ ìœ í˜• */
  type: EvidenceType;
  typeName: string;
  /** ëˆ„ë½ ì‚¬ìœ  */
  reason: "not_uploaded" | "not_approved" | "rejected";
  /** ê´€ë ¨ ì—”í‹°í‹° (ìˆëŠ” ê²½ìš°) */
  relatedEntity?: {
    entityType: string;
    entityId: string;
    entityTitle: string;
  };
  /** ì˜ˆìƒ ë‹´ë‹¹ì */
  expectedOwner?: {
    userId: string;
    name: string;
  };
}
```

---

## 7. ì»´í¬ë„ŒíŠ¸ ë¶„í•´

### 7.1 í´ë” êµ¬ì¡°

```
features/
  audit-evidence/
    pages/
      AuditEvidencePage.tsx              <- ë©”ì¸ í˜ì´ì§€ (3ë‹¨ê³„ ì›Œí¬í”Œë¡œìš°)
    layout/
      AuditEvidenceShell.tsx             <- ë ˆì´ì•„ì›ƒ (KPI + Main + RightPanel)
      AuditEvidenceHeader.tsx            <- Page Header (í•„í„° + Preset ì ê¸ˆ í‘œì‹œ)
    components/
      // KPI Cards
      KpiCardRow.tsx                     <- ìƒë‹¨ KPI Row (4ê°œ ì¹´ë“œ)
      CoverageKpiCard.tsx                <- Coverage % ì „ìš© (ê²Œì´ì§€ ì°¨íŠ¸)
      MissingKpiCard.tsx                 <- ëˆ„ë½ ê±´ìˆ˜ ì „ìš© (ê²½ê³  ìŠ¤íƒ€ì¼)
      PendingKpiCard.tsx                 <- ìŠ¹ì¸ ëŒ€ê¸° ê±´ìˆ˜
      ExportCountKpiCard.tsx             <- ëˆ„ì  Export íšŸìˆ˜

      // Compliance
      ComplianceChecklist.tsx            <- Phaseë³„ Compliance ì²´í¬ë¦¬ìŠ¤íŠ¸
      CompliancePhaseRow.tsx             <- ê°œë³„ Phase í–‰ (í”„ë¡œê·¸ë ˆìŠ¤ ë°” + ìƒíƒœ)
      ComplianceBreakdown.tsx            <- Phase í¼ì¹¨ ì‹œ ìœ í˜•ë³„ ìƒì„¸

      // Evidence List
      EvidenceFilterPanel.tsx            <- í•„í„° íŒ¨ë„ (Phase/ìœ í˜•/ìƒíƒœ/ê¸°ê°„/ê²€ìƒ‰)
      EvidenceSelectionList.tsx          <- ì²´í¬ë°•ìŠ¤ ê¸°ë°˜ ì¦ë¹™ ëª©ë¡ í…Œì´ë¸”
      EvidenceTableRow.tsx               <- ê°œë³„ ì¦ë¹™ í–‰
      EvidenceSelectAllHeader.tsx        <- ì „ì²´ ì„ íƒ í—¤ë”
      EvidenceStatusBadge.tsx            <- ì¦ë¹™ ìƒíƒœ ë°°ì§€ (approved/pending/missing)

      // Preview
      EvidencePreviewPanel.tsx           <- Right Panel: ì¦ë¹™ ë¯¸ë¦¬ë³´ê¸°
      EvidenceFilePreview.tsx            <- íŒŒì¼ ë¯¸ë¦¬ë³´ê¸° (PDF viewer/ì´ë¯¸ì§€)
      EvidenceMetadata.tsx               <- ë©”íƒ€ë°ì´í„° í‘œì‹œ (ìŠ¹ì¸ ì •ë³´ ë“±)
      EvidenceTraceChain.tsx             <- Trace Chain ì‹œê°í™” (ê°„ëµ)

      // Export
      ExportButton.tsx                   <- ZIP/PDF Export ë²„íŠ¼
      ExportFormatSelector.tsx           <- Export í˜•ì‹ ì„ íƒ (ZIP/PDF)
      ExportProgressPanel.tsx            <- Right Panel: Export ì§„í–‰ ìƒíƒœ
      ExportCompletePanel.tsx            <- Right Panel: Export ì™„ë£Œ + ë‹¤ìš´ë¡œë“œ
      ExportMetadataForm.tsx             <- Export ë©”íƒ€ë°ì´í„° ì…ë ¥ (ì„ íƒì )
      ExportCoverSheet.tsx               <- v2.1: ì œì¶œ ìš”ì•½ í™•ì¸ íŒ¨ë„ (Cover Sheet)

      // Audit Trail
      AuditTrailDrawer.tsx               <- Drawer: Export ì´ë ¥ ëª©ë¡

      // Common
      PresetLockedBadge.tsx              <- Preset ì ê¸ˆ í‘œì‹œ ë°°ì§€
      SelectionSummaryBar.tsx            <- í•˜ë‹¨ ì„ íƒ ìš”ì•½ ë°” (Nê±´ ì„ íƒ, ì˜ˆìƒ í¬ê¸°)

    api/
      auditEvidenceApi.ts                <- API í˜¸ì¶œ í•¨ìˆ˜
    hooks/
      useEvidenceSummary.ts              <- Summary TanStack Query
      useEvidenceList.ts                 <- List TanStack Query (í•„í„° ì—°ë™)
      useEvidenceDetail.ts               <- Detail TanStack Query
      useEvidenceExport.ts               <- Export ìƒíƒœ ê´€ë¦¬ (mutation + polling)
      useEvidenceSelection.ts            <- ì²´í¬ë°•ìŠ¤ ì„ íƒ ìƒíƒœ ê´€ë¦¬
      useComplianceChecklist.ts          <- Compliance ë°ì´í„° Query
      useAuditTrail.ts                   <- Audit Trail Query
    types/
      auditEvidence.ts                   <- íƒ€ì… ì •ì˜
    config/
      evidenceTypeConfig.ts              <- ì¦ë¹™ ìœ í˜•ë³„ ì•„ì´ì½˜/ë¼ë²¨/ìƒ‰ìƒ ë§¤í•‘
```

### 7.2 ì»´í¬ë„ŒíŠ¸ ì˜ì¡´ì„± íŠ¸ë¦¬

```
AuditEvidencePage
â”œâ”€â”€ AuditEvidenceShell
â”‚   â”œâ”€â”€ AuditEvidenceHeader
â”‚   â”‚   â”œâ”€â”€ PresetLockedBadge
â”‚   â”‚   â””â”€â”€ DataBadge (asOf)
â”‚   â”‚
â”‚   â”œâ”€â”€ KpiCardRow
â”‚   â”‚   â”œâ”€â”€ CoverageKpiCard
â”‚   â”‚   â”œâ”€â”€ MissingKpiCard
â”‚   â”‚   â”œâ”€â”€ PendingKpiCard
â”‚   â”‚   â””â”€â”€ ExportCountKpiCard
â”‚   â”‚
â”‚   â”œâ”€â”€ ComplianceChecklist
â”‚   â”‚   â”œâ”€â”€ CompliancePhaseRow (x N)
â”‚   â”‚   â””â”€â”€ ComplianceBreakdown (expand)
â”‚   â”‚
â”‚   â”œâ”€â”€ EvidenceFilterPanel
â”‚   â”‚   â”œâ”€â”€ PhaseDropdown
â”‚   â”‚   â”œâ”€â”€ EvidenceTypeDropdown
â”‚   â”‚   â”œâ”€â”€ StatusDropdown
â”‚   â”‚   â”œâ”€â”€ DateRangePicker
â”‚   â”‚   â””â”€â”€ SearchInput
â”‚   â”‚
â”‚   â”œâ”€â”€ EvidenceSelectionList
â”‚   â”‚   â”œâ”€â”€ EvidenceSelectAllHeader
â”‚   â”‚   â””â”€â”€ EvidenceTableRow (x N)
â”‚   â”‚       â””â”€â”€ EvidenceStatusBadge
â”‚   â”‚
â”‚   â”œâ”€â”€ SelectionSummaryBar
â”‚   â”‚   â”œâ”€â”€ ExportFormatSelector
â”‚   â”‚   â””â”€â”€ ExportButton
â”‚   â”‚
â”‚   â””â”€â”€ RightPanel (conditional)
â”‚       â”œâ”€â”€ [preview] EvidencePreviewPanel
â”‚       â”‚   â”œâ”€â”€ EvidenceFilePreview
â”‚       â”‚   â”œâ”€â”€ EvidenceMetadata
â”‚       â”‚   â””â”€â”€ EvidenceTraceChain
â”‚       â”‚
â”‚       â”œâ”€â”€ [confirm] ExportCoverSheet (v2.1)
â”‚       â”‚   â””â”€â”€ ExportMetadataForm
â”‚       â”‚
â”‚       â”œâ”€â”€ [export] ExportProgressPanel
â”‚       â”‚
â”‚       â””â”€â”€ [complete] ExportCompletePanel
â”‚
â””â”€â”€ AuditTrailDrawer (overlay)
```

### 7.3 í•µì‹¬ ì»´í¬ë„ŒíŠ¸ ì¸í„°í˜ì´ìŠ¤

```typescript
// --- AuditEvidencePage ---
function AuditEvidencePage() {
  const { capabilities } = useAccessContext();
  const [panelMode, setPanelMode] = useState<"list" | "preview" | "confirm" | "export">("list");

  // Capability ê²€ì¦
  if (!capabilities.includes("export_audit_evidence")) {
    return <Navigate to="/unauthorized" replace />;
  }

  // Preset ì ê¸ˆ -- ì „í™˜ ë¶ˆê°€
  // usePresetSwitch() hook ì‚¬ìš©í•˜ì§€ ì•ŠìŒ (AUDIT_EVIDENCE ê³ ì •)

  return (
    <AuditEvidenceShell panelMode={panelMode}>
      <KpiCardRow />
      <ComplianceChecklist />
      <EvidenceFilterPanel />
      <EvidenceSelectionList onSelect={(id) => setPanelMode("preview")} />
      <SelectionSummaryBar onExport={() => setPanelMode("confirm")} />

      {panelMode === "preview" && <EvidencePreviewPanel />}
      {panelMode === "confirm" && <ExportCoverSheet onConfirm={() => setPanelMode("export")} />}
      {panelMode === "export" && <ExportProgressPanel />}
    </AuditEvidenceShell>
  );
}

// --- EvidenceSelectionList ---
interface EvidenceSelectionListProps {
  items: EvidenceItem[];
  selectedIds: string[];
  onSelect: (id: string) => void;
  onToggleAll: () => void;
  onPreview: (id: string) => void;
  readOnly: true;                    // â˜… í•­ìƒ true -- ìˆ˜ì • ë¶ˆê°€
}

// --- ExportButton ---
interface ExportButtonProps {
  selectedIds: string[];
  format: "zip" | "pdf";
  disabled: boolean;                 // selectedIds.length === 0
  onExport: (request: ExportRequest) => void;
  loading: boolean;
}

// --- EvidencePreviewPanel ---
interface EvidencePreviewPanelProps {
  evidenceId: string;
  onClose: () => void;
  onDownloadIndividual: (id: string) => void;
}

// --- ExportProgressPanel ---
interface ExportProgressPanelProps {
  packageId: string;
  onComplete: (downloadUrl: string) => void;
  onCancel: () => void;
  onFailed: (error: string) => void;
}
```

### 7.4 useEvidenceExport Hook

```typescript
function useEvidenceExport() {
  const queryClient = useQueryClient();

  // 1. Export ìš”ì²­ (mutation)
  const exportMutation = useMutation({
    mutationFn: (request: ExportEvidenceRequest) =>
      auditEvidenceApi.requestExport(request),
    onSuccess: (data) => {
      // polling ì‹œì‘
      setActivePackageId(data.packageId);
    },
  });

  // 2. ìƒíƒœ í´ë§ (3ì´ˆ ê°„ê²©)
  const [activePackageId, setActivePackageId] = useState<string | null>(null);

  const statusQuery = useQuery({
    queryKey: ["audit-evidence", "export", activePackageId],
    queryFn: () => auditEvidenceApi.getExportStatus(activePackageId!),
    enabled: !!activePackageId,
    refetchInterval: (data) =>
      data?.status === "processing" ? 3000 : false,  // 3ì´ˆ ê°„ê²© í´ë§
    onSuccess: (data) => {
      if (data.status === "completed" || data.status === "failed") {
        // í´ë§ ì¤‘ì§€
        setActivePackageId(null);
        // Summary ê°±ì‹  (export_count ì¦ê°€)
        queryClient.invalidateQueries(["audit-evidence", "summary"]);
      }
    },
  });

  // 3. ë‹¤ìš´ë¡œë“œ
  const download = useCallback(async (downloadUrl: string) => {
    // Audit Trail ë¡œê¹…ì€ ì„œë²„ì—ì„œ ìë™ ì²˜ë¦¬
    window.open(downloadUrl, "_blank");
  }, []);

  return {
    requestExport: exportMutation.mutate,
    isExporting: exportMutation.isLoading,
    exportStatus: statusQuery.data,
    isPolling: !!activePackageId,
    download,
  };
}
```

---

## 8. AI Navigation ì—°ë™

### 8.1 AI ì‘ë‹µ ì‹œ ê°ì‚¬ ì¦ë¹™ ë…¸ë“œ ì¶”ì²œ

ê°ì‚¬ ì¦ë¹™ì€ `nodeRole: "action"`ì´ë¯€ë¡œ, í–‰ë™ ì§ˆë¬¸ì— ëŒ€í•´ **+10 ê°€ì‚°** ìŠ¤ì½”ì–´ë¥¼ ë°›ëŠ”ë‹¤.

```
Intent -> Node ìŠ¤ì½”ì–´ë§ (00_ì´ê´„ Â§9 ê¸°ë°˜):

ì§ˆë¬¸: "ê°ì‚¬ ì¦ë¹™ ë‚´ë³´ë‚´ì¤˜"
  Intent: do_export_evidence (40%)    -> audit-evidence âœ…
  Entity: Deliverable (25%)            -> audit-evidence âœ…, deliverables âœ…
  Keyword: "ê°ì‚¬", "ì¦ë¹™" (15%)        -> audit-evidence âœ…âœ…
  Domain: audit (10%)                  -> audit-evidence âœ…
  nodeRole bonus: action (+10)         -> audit-evidence âœ…

  Result: audit-evidence (0.95) >> deliverables (0.35) > lineage (0.20)
```

### 8.2 Audit Evidence ì „ìš© AI Navigation ê·œì¹™

> **í•µì‹¬**: AUDIT_EVIDENCE Presetì—ì„œëŠ” AI ì¶”ì²œ ëŒ€ìƒì´ ì œí•œëœë‹¤.
> ê°ì‚¬ì¸ì´ ì ‘ê·¼ ê°€ëŠ¥í•œ í™”ë©´ë§Œ ì¶”ì²œ ëŒ€ìƒì— í¬í•¨ëœë‹¤.

```typescript
/** AUDIT_EVIDENCE Presetì—ì„œ AIê°€ ì¶”ì²œ ê°€ëŠ¥í•œ nodeId ëª©ë¡ */
const AUDIT_NAVIGABLE_NODES: string[] = [
  "audit-evidence",     // ë³¸ í™”ë©´
  "lineage",            // Lineage & History (ì½ê¸°)
  "reports",            // í”„ë¡œì íŠ¸ ë¦¬í¬íŠ¸ (ì½ê¸°/Export)
  "stats",              // í†µê³„ ëŒ€ì‹œë³´ë“œ (ì½ê¸°)
  "pmo",                // PMO ëŒ€ì‹œë³´ë“œ (ìš”ì•½ ì½ê¸°)
];

/** AI Navigation í•„í„°ë§ */
function filterNavigationForAudit(
  navigation: AiNavigationResponse["navigation"]
): AiNavigationResponse["navigation"] {
  const filteredPrimary = AUDIT_NAVIGABLE_NODES.includes(
    navigation.primary.targetNodeId
  )
    ? navigation.primary
    : {
        targetNodeId: "audit-evidence",
        label: "ì¦ë¹™ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°",
        // v2.1: ì°¨ë‹¨ ì‚¬ìœ  í…ìŠ¤íŠ¸ -- ì‚¬ìš©ìì—ê²Œ ì™œ ëª» ê°€ëŠ”ì§€ 1ì¤„ ì„¤ëª…
        blockedReason: "ì™¸ë¶€ ê°ì‚¬ ì—­í• ì—ì„œëŠ” ì œì¶œ ê´€ë ¨ í™”ë©´ë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.",
      };

  const filteredSecondary = navigation.secondary?.filter(
    (n) => AUDIT_NAVIGABLE_NODES.includes(n.targetNodeId)
  );

  return {
    primary: filteredPrimary,
    secondary: filteredSecondary,
  };
}
```

### 8.3 AI ì§ˆë¬¸ -> Navigation ì˜ˆì‹œ

| ì§ˆë¬¸ | AI ì¶”ì²œ nodeId | deepLinkParams | Preset | ë¹„ê³  |
|------|---------------|---------------|--------|------|
| "ì¦ë¹™ ì¤€ë¹„ ìƒíƒœ ì•Œë ¤ì¤˜" | `audit-evidence` | - | AUDIT_EVIDENCE | ë³¸ í™”ë©´ ìœ ì§€ |
| "1ë‹¨ê³„ ì¦ë¹™ ë‚´ë³´ë‚´ì¤˜" | `audit-evidence.phase` | `{ phaseId: "PH-1" }` | AUDIT_EVIDENCE | virtualNode |
| "ëˆ„ë½ëœ ì¦ë¹™ ë­ì•¼?" | `audit-evidence.missing` | - | AUDIT_EVIDENCE | virtualNode |
| "ì „ì²´ ì¦ë¹™ íŒ¨í‚¤ì§€ ë§Œë“¤ì–´ì¤˜" | `audit-evidence` | - | AUDIT_EVIDENCE | do_export_evidence |
| "ë³€ê²½ ì´ë ¥ ì¶”ì í•´ì¤˜" | `lineage` | - | AUDIT_EVIDENCE | í—ˆìš©ëœ ì™¸ë¶€ í™”ë©´ |
| "í”„ë¡œì íŠ¸ ë¦¬í¬íŠ¸ ë³´ì—¬ì¤˜" | `reports` | - | AUDIT_EVIDENCE | í—ˆìš©ëœ ì™¸ë¶€ í™”ë©´ |
| "ì¹¸ë°˜ ë³´ë“œ ë³´ì—¬ì¤˜" | `audit-evidence` (fallback) | - | AUDIT_EVIDENCE | â˜… ì°¨ë‹¨ -> fallback + blockedReason í‘œì‹œ (v2.1) |

### 8.4 AI Insight (ê°ì‚¬ ì¦ë¹™ ì „ìš©)

ê°ì‚¬ ì¦ë¹™ í™”ë©´ì—ì„œì˜ AI InsightëŠ” **ì¦ë¹™ ì¤€ë¹„ ìƒíƒœ ì§„ë‹¨**ì— ì§‘ì¤‘í•œë‹¤.

```typescript
interface AuditEvidenceAiInsight {
  asOf: string;
  summary: string;               // "Phase 2 ì„¤ê³„ ë‹¨ê³„ ì¦ë¹™ 2ê±´ ëˆ„ë½"
  severity: "info" | "warning" | "critical";

  drivers: {
    type: "metric" | "entity";
    label: string;               // "ì„¤ê³„ì„œ ë¯¸ìŠ¹ì¸"
    value?: string;              // "2ê±´ ëˆ„ë½"
    link?: {
      targetNodeId: string;      // "audit-evidence.missing"
      label: string;
    };
  }[];

  nextActions: {
    label: string;               // "ëˆ„ë½ ì¦ë¹™ í™•ì¸"
    targetNodeId: string;        // "audit-evidence.missing"
    requiredCaps?: Capability[];
    reason: string;
  }[];
}
```

---

## 9. ì¸í„°ë™ì…˜ ìƒì„¸

### 9.1 í•„í„° ë³€ê²½

```
Phase ë“œë¡­ë‹¤ìš´ ë³€ê²½
  -> URL ê°±ì‹ : /audit/evidence?phaseId=PH-2
  -> Evidence List ì¬ì¡°íšŒ (TanStack Query refetch)
  -> KPI Cards ì¬ê³„ì‚° (í•´ë‹¹ Phase ê¸°ì¤€)
  -> Compliance Checklist í•´ë‹¹ Phase ê°•ì¡°

ìœ í˜• ë“œë¡­ë‹¤ìš´ ë³€ê²½
  -> URL ê°±ì‹ : /audit/evidence?phaseId=PH-2&evidenceType=deliverable
  -> Evidence List í•„í„° ì ìš©
  -> ì„ íƒ ìƒíƒœ ì´ˆê¸°í™” (selectedIds = [])
```

### 9.2 ì¦ë¹™ ì„ íƒ

```
ê°œë³„ ì²´í¬ë°•ìŠ¤ í´ë¦­
  -> selectedIds í† ê¸€
  -> SelectionSummaryBar ê°±ì‹  (Nê±´ ì„ íƒ, ì˜ˆìƒ í¬ê¸°)
  -> ExportButton í™œì„±í™” (selectedIds.length > 0)

ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ í´ë¦­
  -> í˜„ì¬ í•„í„° ê²°ê³¼ ì „ì²´ ì„ íƒ/í•´ì œ
  -> SelectionSummaryBar ê°±ì‹ 

í–‰ í´ë¦­ (ì²´í¬ë°•ìŠ¤ ì™¸ ì˜ì—­)
  -> panelMode = "preview"
  -> Right Panel ì—´ë¦¼ (EvidencePreviewPanel)
  -> í•´ë‹¹ ì¦ë¹™ ìƒì„¸ ë¡œë“œ (useEvidenceDetail)
```

### 9.3 ë¯¸ë¦¬ë³´ê¸°

```
Right Panel: EvidencePreviewPanel
  -> ì¦ë¹™ ë©”íƒ€ë°ì´í„° í‘œì‹œ (ìœ í˜•, Phase, ìƒíƒœ, ìŠ¹ì¸ ì •ë³´)
  -> íŒŒì¼ ë¯¸ë¦¬ë³´ê¸° (PDF viewer / ì´ë¯¸ì§€ ë·°ì–´)
  -> Trace Chain ì‹œê°í™” (ê°„ëµ: Req -> Epic -> Story -> TC -> Deliverable)
  -> [ê°œë³„ ë‹¤ìš´ë¡œë“œ] ë²„íŠ¼ -> íŒŒì¼ ë‹¤ìš´ë¡œë“œ + Audit Trail ë¡œê¹…
  -> [ë‹«ê¸°] -> panelMode = "list"
```

### 9.4 Export ì‹¤í–‰

```
[ZIP ë‹¤ìš´ë¡œë“œ] ë˜ëŠ” [PDF ë¦¬í¬íŠ¸] í´ë¦­
  -> ExportMetadataForm í‘œì‹œ (ì„ íƒì  -- ê°ì‚¬ ê¸°ê°„/ê°ì‚¬ìëª…/ê°ì‚¬ ëª©ì )
  -> panelMode = "confirm"                           -- (v2.1)
  -> Right Panel: ExportCoverSheet (ì œì¶œ ìš”ì•½)        -- (v2.1)
     - í•„í„° ë²”ìœ„ / ì„ íƒ ê±´ìˆ˜ / ìƒíƒœ ë¶„í¬ / ì˜ˆìƒ í¬ê¸° í‘œì‹œ
     - Warning ìë™ ìƒì„± (PENDING_INCLUDED, NO_DATE_RANGE ë“±)
     - [âœ“ ìœ„ ë‚´ìš©ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤] ì²´í¬ë°•ìŠ¤ í•„ìˆ˜ ì„ íƒ
  -> [Export ì‹œì‘] í´ë¦­ (ì²´í¬ë°•ìŠ¤ ë¯¸ì„ íƒ ì‹œ ë¹„í™œì„±)  -- (v2.1)
  -> POST /api/audit/evidence/export
  -> panelMode = "export"
  -> Right Panel: ExportProgressPanel
  -> 3ì´ˆ ê°„ê²© í´ë§ (GET /api/audit/evidence/export/:packageId)
  -> ì§„í–‰ë¥  í‘œì‹œ (í•­ëª©ë³„ ì²˜ë¦¬ ìƒíƒœ)

Export ì™„ë£Œ ì‹œ:
  -> Right Panel: ExportCompletePanel
  -> [ë‹¤ìš´ë¡œë“œ] ë²„íŠ¼ í‘œì‹œ
  -> ë‹¤ìš´ë¡œë“œ í´ë¦­ -> íŒŒì¼ ë‹¤ìš´ë¡œë“œ + Audit Trail ë¡œê¹…
  -> EXPORT_SEALED ì´ë²¤íŠ¸ ê¸°ë¡ (filterSnapshot + selectionHash í¬í•¨)  -- (v2.1)
  -> Summary KPI ê°±ì‹  (export_count +1)

Export ë¶€ë¶„ ì‹¤íŒ¨ ì‹œ (v2.1):
  -> status = "partial" (ì‹¤íŒ¨ í•­ëª© < 50%)
  -> Right Panel: ExportCompletePanel + partialFailure í‘œì‹œ
  -> ì‹¤íŒ¨ í•­ëª© ëª©ë¡ + reason í‘œì‹œ
  -> Toast: "Nê±´ ì‹¤íŒ¨ -- ZIP í¬ë§·ìœ¼ë¡œ ì¬ì‹œë„ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤"

Export ì‹¤íŒ¨ ì‹œ:
  -> Right Panel: ì˜¤ë¥˜ ë©”ì‹œì§€ + ì‹¤íŒ¨ í•­ëª© í‘œì‹œ
  -> [ì¬ì‹œë„] ë²„íŠ¼
  -> ì‹¤íŒ¨ í•­ëª©ë§Œ ì¬ì‹œë„ or ì „ì²´ ì¬ì‹œë„ ì„ íƒ

ë‹¤ìš´ë¡œë“œ URL ë§Œë£Œ í›„ (v2.1):
  -> 410 Gone ì‘ë‹µ ì‹œ "ë§í¬ê°€ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤" ë©”ì‹œì§€
  -> [URL ì¬ë°œê¸‰] ë²„íŠ¼ -> POST /api/audit/evidence/export/:packageId/reissue
  -> ìƒˆ downloadUrl ìˆ˜ì‹  -> ì¦‰ì‹œ ë‹¤ìš´ë¡œë“œ
```

### 9.5 Compliance Checklist ì¸í„°ë™ì…˜

```
Phase í–‰ í´ë¦­ (Compliance Checklist)
  -> Phase í¼ì¹¨/ì ‘ê¸° (Accordion)
  -> í¼ì¹¨ ì‹œ ComplianceBreakdown í‘œì‹œ (ìœ í˜•ë³„ ìƒì„¸)
  -> ìœ í˜•ë³„ í•­ëª© ëª©ë¡ + ìƒíƒœ í‘œì‹œ

ëˆ„ë½ í•­ëª© í´ë¦­
  -> Evidence List í•„í„° ì ìš©: { phaseId, evidenceType, status: "missing" }
  -> ëˆ„ë½ í•­ëª© í•˜ì´ë¼ì´íŠ¸
```

### 9.6 KPI Card í´ë¦­

```
Coverage KPI Card í´ë¦­
  -> Compliance Checklist ì„¹ì…˜ìœ¼ë¡œ ìŠ¤í¬ë¡¤

Missing KPI Card í´ë¦­
  -> í•„í„° ì ìš©: { status: "missing" }
  -> Evidence Listì—ì„œ ëˆ„ë½ í•­ëª©ë§Œ í‘œì‹œ

Pending KPI Card í´ë¦­
  -> í•„í„° ì ìš©: { status: "pending" }
  -> Evidence Listì—ì„œ ìŠ¹ì¸ ëŒ€ê¸° í•­ëª©ë§Œ í‘œì‹œ

Export Count KPI Card í´ë¦­
  -> AuditTrailDrawer ì—´ê¸° (ìµœê·¼ Export ì´ë ¥)
```

### 9.7 Audit Trail ì—´ê¸°

```
Page Header [ì´ë ¥] ë²„íŠ¼ í´ë¦­
  -> AuditTrailDrawer ì—´ë¦¼ (Drawer 420px, ìš°ì¸¡)
  -> Audit Trail ëª©ë¡ í‘œì‹œ (ì‹œê°„ìˆœ ì—­ìˆœ)
  -> ê° í•­ëª©: í–‰ìœ„, í–‰ìœ„ì, ëŒ€ìƒ, ì‹œê°„, IP
  -> í˜ì´ì§• (ë¬´í•œ ìŠ¤í¬ë¡¤)
```

### 9.8 ë°ì´í„° ìƒˆë¡œê³ ì¹¨

| í•­ëª© | ì£¼ê¸° |
|------|------|
| KPI Cards | í˜ì´ì§€ ì§„ì… ì‹œ + ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ |
| Compliance Checklist | í˜ì´ì§€ ì§„ì… ì‹œ + ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ |
| Evidence List | í•„í„° ë³€ê²½ ì‹œ + ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ |
| Export Status | 3ì´ˆ í´ë§ (Export ì§„í–‰ ì¤‘ì—ë§Œ) |
| ì „ì²´ | ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ (Page Header) |

> **ìë™ ê°±ì‹  ì—†ìŒ**: ê°ì‚¬ ì¦ë¹™ í™”ë©´ì€ ì‹¤ì‹œê°„ ë³€ë™ì´ ì ìœ¼ë¯€ë¡œ,
> ëŒ€ì‹œë³´ë“œì™€ ë‹¬ë¦¬ ìë™ ê°±ì‹ (refetchInterval)ì„ ì ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.
> Export ì§„í–‰ ì¤‘ í´ë§ë§Œ ì˜ˆì™¸.

---

## 10. ë°˜ì‘í˜• ëŒ€ì‘

### 10.1 ë¸Œë ˆì´í¬í¬ì¸íŠ¸ë³„ ë ˆì´ì•„ì›ƒ

| ë„ˆë¹„ | KPI Row | Main Content | Right Panel | ë¹„ê³  |
|------|---------|-------------|-------------|------|
| >=1440px | 4ì—´ ê°€ë¡œ ë°°ì¹˜ | 70% | 30% (420px) | í’€ ë ˆì´ì•„ì›ƒ |
| 1280px | 4ì—´ ê°€ë¡œ ë°°ì¹˜ | 100% | Drawer (toggle) | Right Panel -> Drawer |
| <=1024px | 2x2 ê·¸ë¦¬ë“œ | 100% | Drawer (overlay) | SideNav ì ‘ê¸° |
| <=768px | 1ì—´ ì„¸ë¡œ ìŠ¤íƒ | 100% | Full Modal | ëª¨ë°”ì¼ ëŒ€ì‘ |

### 10.2 ì»´í¬ë„ŒíŠ¸ë³„ ë°˜ì‘í˜• ê·œì¹™

| ì»´í¬ë„ŒíŠ¸ | >=1440px | 1280px | <=1024px | <=768px |
|----------|---------|--------|---------|---------|
| KPI Row | 4ì—´ ê°€ë¡œ | 4ì—´ ê°€ë¡œ | 2x2 ê·¸ë¦¬ë“œ | 1ì—´ ì„¸ë¡œ |
| Compliance Checklist | ì „ì²´ í‘œì‹œ | ì „ì²´ í‘œì‹œ | ì¶•ì•½ (Phaseëª… + % + ìƒíƒœë§Œ) | ì ‘ì´ì‹ |
| Evidence List | 6ì—´ í…Œì´ë¸” | 5ì—´ (ì„¤ëª… ìˆ¨ê¹€) | 4ì—´ (Phase ì•„ì´ì½˜í™”) | ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ |
| Filter Panel | ê°€ë¡œ ë°°ì¹˜ | ê°€ë¡œ ë°°ì¹˜ | 2í–‰ ë°°ì¹˜ | ì ‘ì´ì‹ í•„í„° |
| Preview Panel | Right Panel (30%) | Drawer | Drawer (overlay) | Full Modal |
| Export Progress | Right Panel | Drawer | Drawer (overlay) | Full Modal |
| Selection Summary | í•˜ë‹¨ ê³ ì • ë°” | í•˜ë‹¨ ê³ ì • ë°” | í•˜ë‹¨ ê³ ì • ë°” | í•˜ë‹¨ ê³ ì • ë°” |

### 10.3 ëª¨ë°”ì¼(<=768px) íŠ¹í™” ëŒ€ì‘

```
+---------------------------------+
| AIMAX  [ í”„ë¡œì íŠ¸ â–¼ ]  [â‰¡]     |
+---------------------------------+
| Evidence Export                  |
| [ AUDIT ğŸ”’ ]  [ìƒˆë¡œê³ ì¹¨]       |
+---------------------------------+
| +------ KPI Cards (ì„¸ë¡œ) -----+ |
| | Coverage: 87%  â–ˆâ–ˆâ–ˆâ–ˆâ–‘        | |
| | Missing: 5ê±´  âš             | |
| | Pending: 3ê±´               | |
| | Exports: 12íšŒ              | |
| +-----------------------------+ |
|                                 |
| [ Compliance â–¼ ] (ì ‘ì´ì‹)       |
|                                 |
| [ í•„í„° â–¼ ] (ì ‘ì´ì‹)             |
|                                 |
| +-- Evidence Cards -----------+ |
| | [x] ìš”ê±´ì •ì˜ì„œ_v3           | |
| |     ì‚°ì¶œë¬¼ | PH-1 | âœ…ìŠ¹ì¸  | |
| +-----------------------------+ |
| | [x] ì„¤ê³„ì„œ_v2               | |
| |     ì‚°ì¶œë¬¼ | PH-2 | âœ…ìŠ¹ì¸  | |
| +-----------------------------+ |
| | [ ] ë‹¨ìœ„í…ŒìŠ¤íŠ¸_ê²°ê³¼          | |
| |     í…ŒìŠ¤íŠ¸ | PH-2 | â³ëŒ€ê¸°  | |
| +-----------------------------+ |
| ...                             |
|                                 |
+---------------------------------+
| 2ê±´ ì„ íƒ | [ZIP] [PDF]          |
+---------------------------------+
```

---

## 11. ê¹¨ì§€ê¸° ì‰¬ìš´ ê³³ ì²´í¬ë¦¬ìŠ¤íŠ¸

### 11.1 ëŒ€ìš©ëŸ‰ Export íƒ€ì„ì•„ì›ƒ

| í•­ëª© | ìœ„í—˜ | ëŒ€ì‘ |
|------|------|------|
| **ì¦ìƒ** | 50+ íŒŒì¼ Export ì‹œ ì„œë²„ íƒ€ì„ì•„ì›ƒ (>30ì´ˆ) |
| **ì›ì¸** | ë™ê¸° íŒŒì¼ ìˆ˜ì§‘ + ì••ì¶•ì´ HTTP ìš”ì²­ ì‹œê°„ ë‚´ ì™„ë£Œ ë¶ˆê°€ |
| **ëŒ€ì‘** | ë¹„ë™ê¸° ì²˜ë¦¬ (202 Accepted + polling) í™•ì • |
| **ê²€ì¦** | 100ê±´ Export ì‹œ polling ì •ìƒ ë™ì‘ + 5ë¶„ ì´ë‚´ ì™„ë£Œ í™•ì¸ |

### 11.2 ë‹¤ìš´ë¡œë“œ ë§í¬ ë§Œë£Œ

| í•­ëª© | ìœ„í—˜ | ëŒ€ì‘ |
|------|------|------|
| **ì¦ìƒ** | Export ì™„ë£Œ í›„ 24ì‹œê°„ ê²½ê³¼ ì‹œ ë‹¤ìš´ë¡œë“œ ë¶ˆê°€ |
| **ì›ì¸** | pre-signed URL ë§Œë£Œ |
| **ëŒ€ì‘** | 410 Gone + "ë‹¤ìš´ë¡œë“œ ë§í¬ê°€ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì¬ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?" ë©”ì‹œì§€ |
| **ê²€ì¦** | ë§Œë£Œ í›„ ì¬ìƒì„± í”Œë¡œìš° ì •ìƒ ë™ì‘ í™•ì¸ |

### 11.3 ë™ì‹œ Export ì¶©ëŒ

| í•­ëª© | ìœ„í—˜ | ëŒ€ì‘ |
|------|------|------|
| **ì¦ìƒ** | ê°™ì€ í”„ë¡œì íŠ¸ì—ì„œ 2ëª…ì´ ë™ì‹œ Export ìš”ì²­ |
| **ì›ì¸** | ì„œë²„ ë¦¬ì†ŒìŠ¤ ê²½í•© + ë™ì¼ íŒŒì¼ ì¤‘ë³µ ì²˜ë¦¬ |
| **ëŒ€ì‘** | 409 Conflict + ê¸°ì¡´ Export ìƒíƒœ í˜ì´ì§€ ì•ˆë‚´ |
| **ê²€ì¦** | ë™ì‹œ ìš”ì²­ ì‹œ 2ë²ˆì§¸ ìš”ì²­ì— 409 ì •ìƒ ë°˜í™˜ í™•ì¸ |

### 11.4 ì¦ë¹™ íŒŒì¼ ë¬´ê²°ì„±

| í•­ëª© | ìœ„í—˜ | ëŒ€ì‘ |
|------|------|------|
| **ì¦ìƒ** | ë‹¤ìš´ë¡œë“œëœ íŒŒì¼ì´ ì›ë³¸ê³¼ ë‹¤ë¦„ (ì†ìƒ/ë³€ì¡°) |
| **ì›ì¸** | ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜, ìŠ¤í† ë¦¬ì§€ ì¥ì•  |
| **ëŒ€ì‘** | SHA-256 í•´ì‹œ í¬í•¨ (manifest.json) + í´ë¼ì´ì–¸íŠ¸ ê²€ì¦ |
| **ê²€ì¦** | manifest í•´ì‹œ vs ì‹¤ì œ íŒŒì¼ í•´ì‹œ ë¶ˆì¼ì¹˜ ì‹œ ê²½ê³  í‘œì‹œ |

### 11.5 Preset ì „í™˜ ìš°íšŒ ì‹œë„

| í•­ëª© | ìœ„í—˜ | ëŒ€ì‘ |
|------|------|------|
| **ì¦ìƒ** | URL ì¡°ì‘ìœ¼ë¡œ `?preset=PM_WORK` ë“± íŒŒë¼ë¯¸í„° ì‚½ì… |
| **ì›ì¸** | í”„ë¡ íŠ¸ì—”ë“œ Preset ì „í™˜ ë¡œì§ ìš°íšŒ |
| **ëŒ€ì‘** | `AUDIT_EVIDENCE` ì—­í•  ê°ì§€ ì‹œ preset íŒŒë¼ë¯¸í„° ë¬´ì‹œ + ê°•ì œ AUDIT_EVIDENCE |
| **ê²€ì¦** | URL ìˆ˜ë™ ì¡°ì‘ ì‹œ Preset ë³€ê²½ ì—†ìŒ í™•ì¸ |

### 11.6 ìŠ¹ì¸ ëŒ€ê¸° ì¦ë¹™ Export ê²½ê³ 

| í•­ëª© | ìœ„í—˜ | ëŒ€ì‘ |
|------|------|------|
| **ì¦ìƒ** | ë¯¸ìŠ¹ì¸ ì¦ë¹™ì„ í¬í•¨í•˜ì—¬ Export |
| **ì›ì¸** | ê°ì‚¬ì¸ì´ pending ìƒíƒœ ì¦ë¹™ì„ ì„ íƒí•˜ì—¬ Export |
| **ëŒ€ì‘** | Export ì „ ê²½ê³  ë‹¤ì´ì–¼ë¡œê·¸: "Nê±´ì˜ ë¯¸ìŠ¹ì¸ ì¦ë¹™ì´ í¬í•¨ë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?" |
| **ê²€ì¦** | pending ì¦ë¹™ í¬í•¨ Export ì‹œ ê²½ê³  ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ + manifestì— status ëª…ì‹œ |

### 11.7 PDF ë³‘í•© ë¶€ë¶„ ì‹¤íŒ¨ (v2.1)

| í•­ëª© | ìœ„í—˜ | ëŒ€ì‘ |
|------|------|------|
| **ì¦ìƒ** | PDF ë¦¬í¬íŠ¸ ë³‘í•© ì¤‘ ì¼ë¶€ íŒŒì¼ ë³€í™˜ ì‹¤íŒ¨ (ì´ë¯¸ì§€ ê¹¨ì§, ë¹„í‘œì¤€ ì¸ì½”ë”©) |
| **ì›ì¸** | ê°œë³„ íŒŒì¼ì˜ PDF ë³€í™˜ í˜¸í™˜ì„± ë¬¸ì œ |
| **ëŒ€ì‘** | ì‹¤íŒ¨ìœ¨ < 50% â†’ `status: "partial"` + partialFailure ì‘ë‹µ + ZIP ì¬ì‹œë„ ê¶Œìœ ; ì‹¤íŒ¨ìœ¨ â‰¥ 50% â†’ `status: "failed"` + ì „ì²´ ì¬ì‹œë„ |
| **ê²€ì¦** | ë¶€ë¶„ ì‹¤íŒ¨ ì‹œ partialFailure.failedItems ì •í™• í‘œì‹œ + fallbackFormat ì•ˆë‚´ |

### 11.8 ì„œë²„ ìŠ¤ì½”í”„ ìš°íšŒ ì‹œë„ (v2.1)

| í•­ëª© | ìœ„í—˜ | ëŒ€ì‘ |
|------|------|------|
| **ì¦ìƒ** | API ì§ì ‘ í˜¸ì¶œë¡œ allowedProjectIds/allowedDateRange ë²”ìœ„ ë°– ë°ì´í„° ìš”ì²­ |
| **ì›ì¸** | JWT í´ë ˆì„ êµì°¨ê²€ì¦ ëˆ„ë½ ì‹œ ë²”ìœ„ ì´ˆê³¼ ì ‘ê·¼ ê°€ëŠ¥ |
| **ëŒ€ì‘** | ë°±ì—”ë“œì—ì„œ JWT `allowedProjectIds`/`allowedDateRange` í´ë ˆì„ê³¼ ìš”ì²­ íŒŒë¼ë¯¸í„° êµì°¨ê²€ì¦ â†’ ë²”ìœ„ ë°–ì´ë©´ 403 ë°˜í™˜ |
| **ê²€ì¦** | JWT í´ë ˆì„ ë²”ìœ„ ë°– projectId/dateRange ìš”ì²­ ì‹œ 403 SCOPE_VIOLATION í™•ì¸ |

### 11.9 ì „ì²´ì„ íƒ í˜ì´ì§€ vs ì„œë²„ í˜¼ë™ (v2.1)

| í•­ëª© | ìœ„í—˜ | ëŒ€ì‘ |
|------|------|------|
| **ì¦ìƒ** | "ì „ì²´ ì„ íƒ"ì´ í˜„ì¬ í˜ì´ì§€ë§Œ ì„ íƒí•œë‹¤ê³  ì˜¤í•´ â†’ ê°ì‚¬ ë²”ìœ„ ëˆ„ë½ |
| **ì›ì¸** | í˜ì´ì§€ë„¤ì´ì…˜ ìƒíƒœì—ì„œ ì „ì²´ì„ íƒì˜ ì˜ë¯¸ ëª¨í˜¸ |
| **ëŒ€ì‘** | selectAll = true â†’ `{ selectAll: true, filter: currentFilter }` ì „ì†¡; Cover Sheetì— ì„œë²„ ê¸°ì¤€ ì´ ê±´ìˆ˜(`serverTotalCount`) ëª…ì‹œ í‘œì‹œ |
| **ê²€ì¦** | ì „ì²´ì„ íƒ í›„ Cover Sheetì˜ totalCount == API í•„í„° ê²°ê³¼ totalCount ì¼ì¹˜ í™•ì¸ |

### 11.10 ë‹¤ìš´ë¡œë“œ URL ì¬ë°œê¸‰ ë‚¨ìš© (v2.1)

| í•­ëª© | ìœ„í—˜ | ëŒ€ì‘ |
|------|------|------|
| **ì¦ìƒ** | ë™ì¼ packageIdì— ëŒ€í•´ ë°˜ë³µ ì¬ë°œê¸‰ ìš”ì²­ (ë§í¬ ê³µìœ  ëª©ì ) |
| **ì›ì¸** | reissue ì—”ë“œí¬ì¸íŠ¸ í˜¸ì¶œ íšŸìˆ˜ ì œí•œ ì—†ìŒ |
| **ëŒ€ì‘** | packageIdë‹¹ ì¬ë°œê¸‰ ìƒí•œ 5íšŒ ì„¤ì • â†’ ì´ˆê³¼ ì‹œ 429 Too Many Requests + "ê´€ë¦¬ì ë¬¸ì˜" ì•ˆë‚´; ëª¨ë“  ì¬ë°œê¸‰ì— REISSUE_DOWNLOAD_URL Audit Trail ê¸°ë¡ |
| **ê²€ì¦** | 6ë²ˆì§¸ ì¬ë°œê¸‰ ìš”ì²­ ì‹œ 429 ë°˜í™˜ + Audit Trailì— 5ê±´ ê¸°ë¡ í™•ì¸ |

---

## 12. Capability ë§¤í•‘

### 12.1 í™”ë©´ ì ‘ê·¼ Capability

| Capability | ì„¤ëª… | ëŒ€ìƒ ì—­í•  |
|------------|------|---------|
| `export_audit_evidence` | ê°ì‚¬ ì¦ë¹™ í™”ë©´ ì ‘ê·¼ + Export ì‹¤í–‰ | External Auditor |

### 12.2 í–‰ìœ„ë³„ Capability ë§¤í•‘

| í–‰ìœ„ | í•„ìš” Capability | ì„¤ëª… |
|------|----------------|------|
| ì¦ë¹™ ëª©ë¡ ì¡°íšŒ | `export_audit_evidence` | Evidence List ì¡°íšŒ |
| ì¦ë¹™ ìƒì„¸ ì¡°íšŒ | `export_audit_evidence` | Evidence Detail + ë¯¸ë¦¬ë³´ê¸° |
| ì¦ë¹™ ì„ íƒ | `export_audit_evidence` | ì²´í¬ë°•ìŠ¤ ì„ íƒ (Read-only ë²”ìœ„ ë‚´) |
| ZIP Export | `export_audit_evidence` | ZIP íŒ¨í‚¤ì§€ ìƒì„± + ë‹¤ìš´ë¡œë“œ |
| PDF Export | `export_audit_evidence` | PDF í†µí•© ë¦¬í¬íŠ¸ ìƒì„± + ë‹¤ìš´ë¡œë“œ |
| ê°œë³„ íŒŒì¼ ë‹¤ìš´ë¡œë“œ | `export_audit_evidence` | ë¯¸ë¦¬ë³´ê¸°ì—ì„œ ê°œë³„ íŒŒì¼ ë‹¤ìš´ë¡œë“œ |
| Compliance Checklist ì¡°íšŒ | `export_audit_evidence` | Phaseë³„ ì¦ë¹™ ì¤€ë¹„ ìƒíƒœ |
| Audit Trail ì¡°íšŒ | `export_audit_evidence` | Export ì´ë ¥ ì¡°íšŒ |
| ì¦ë¹™ ìˆ˜ì •/ì‚­ì œ | **ë¶ˆê°€** | â˜… ì–´ë–¤ Capabilityë¡œë„ ë¶ˆê°€ |
| ì¦ë¹™ ì—…ë¡œë“œ | **ë¶ˆê°€** | â˜… ì‚°ì¶œë¬¼ ê´€ë¦¬ í™”ë©´ì—ì„œë§Œ ê°€ëŠ¥ |

> **í•µì‹¬**: `export_audit_evidence`ëŠ” **ì½ê¸° + Exportë§Œ í—ˆìš©**í•˜ëŠ” Capabilityì´ë‹¤.
> ì¦ë¹™ ìì²´ë¥¼ ìˆ˜ì •/ì‚­ì œ/ì—…ë¡œë“œí•˜ëŠ” ê¸°ëŠ¥ì€ ì´ í™”ë©´ì— ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤.

### 12.3 ê¶Œí•œ 4ì¤‘ ë°©ì–´ êµ¬ì¡° ì ìš©

```
Layer 1: Menu/Navigation
  -> requiredCaps: ["export_audit_evidence"]
  -> SideNavì—ì„œ ì™¸ë¶€ ê°ì‚¬ ì—­í• ë§Œ "Evidence Export" ë©”ë‰´ ë…¸ì¶œ
  -> ë‹¤ë¥¸ ì—­í• ì€ ë©”ë‰´ ìì²´ê°€ ìˆ¨ê¹€

Layer 2: Route Guard
  -> /audit/evidence ì ‘ê·¼ ì‹œ export_audit_evidence Capability ê²€ì¦
  -> ë¯¸ë³´ìœ  ì‹œ /unauthorized ë¦¬ë‹¤ì´ë ‰íŠ¸

Layer 3: Action Guard
  -> <Can required={["export_audit_evidence"]}>
  -> Export ë²„íŠ¼, ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ë“± ëª¨ë“  ì•¡ì…˜ì— ì ìš©
  -> Preset Read-only ëª¨ë“œ ë¶ˆí•„ìš” (ë³¸ë˜ Read-only í™”ë©´)

Layer 4: Backend Enforcement
  -> API ë ˆë²¨ì—ì„œ JWT + export_audit_evidence ê²€ì¦
  -> ëª¨ë“  API í˜¸ì¶œì— Audit Trail ìë™ ê¸°ë¡
```

### 12.5 ì„œë²„ ìŠ¤ì½”í”„ ê°•ì œ (v2.1)

> JWT í´ë ˆì„ì— `allowedProjectIds`ì™€ `allowedDateRange`ë¥¼ í¬í•¨í•˜ì—¬ ë°±ì—”ë“œì—ì„œ **ëª¨ë“  /api/audit/evidence* ìš”ì²­**ì— êµì°¨ê²€ì¦ì„ ìˆ˜í–‰í•œë‹¤.

```typescript
// JWT claims for audit scope enforcement (v2.1)
interface AuditScopeClaims {
  /** Allowed project IDs for this auditor session */
  allowedProjectIds: string[];
  /** Allowed date range for evidence access */
  allowedDateRange?: {
    from: string;  // ISO date
    to: string;    // ISO date
  };
}

// Backend middleware pseudocode
function validateAuditScope(req: Request, jwtClaims: AuditScopeClaims) {
  const { projectId, dateRange } = req.query;

  // 1. Project scope check
  if (!jwtClaims.allowedProjectIds.includes(projectId)) {
    throw new ForbiddenError("SCOPE_VIOLATION", "Project not in allowed scope");
  }

  // 2. Date range check (if claim exists)
  if (jwtClaims.allowedDateRange && dateRange) {
    if (dateRange.from < jwtClaims.allowedDateRange.from ||
        dateRange.to > jwtClaims.allowedDateRange.to) {
      throw new ForbiddenError("SCOPE_VIOLATION", "Date range exceeds allowed scope");
    }
  }
}
```

| ê²€ì¦ ì‹œì  | ëŒ€ìƒ API | ì‹¤íŒ¨ ì‘ë‹µ |
|-----------|----------|----------|
| ëª¨ë“  ìš”ì²­ | `/api/audit/evidence/*` | 403 `SCOPE_VIOLATION` |
| Export ì‹œì‘ | `POST /api/audit/evidence/export` | 403 + ë²”ìœ„ ì´ˆê³¼ ìƒì„¸ ë©”ì‹œì§€ |
| URL ì¬ë°œê¸‰ | `POST /api/audit/evidence/export/:id/reissue` | 403 + ì›ë³¸ íŒ¨í‚¤ì§€ ìŠ¤ì½”í”„ ë¶ˆì¼ì¹˜ |

### 12.4 ë‹¤ë¥¸ ì—­í• ì˜ ì ‘ê·¼ ì°¨ë‹¨ ìƒì„¸

```typescript
// computeCapabilities()ì—ì„œ export_audit_evidenceëŠ” EXTERNAL_AUDITORì—ë§Œ ë¶€ì—¬
const ROLE_CAPABILITIES: Record<ProjectRole, Capability[]> = {
  SPONSOR:         ["view_dashboard", "view_reports", ...],     // export_audit_evidence ì—†ìŒ
  PMO_HEAD:        ["view_dashboard", "view_pmo", ...],         // export_audit_evidence ì—†ìŒ
  PM:              ["view_dashboard", "manage_phases", ...],    // export_audit_evidence ì—†ìŒ
  DEVELOPER:       ["view_dashboard", "view_kanban", ...],      // export_audit_evidence ì—†ìŒ
  QA:              ["view_dashboard", "view_tests", ...],       // export_audit_evidence ì—†ìŒ
  BUSINESS_ANALYST:["view_dashboard", "view_requirements", ...],// export_audit_evidence ì—†ìŒ
  MEMBER:          ["view_dashboard", ...],                     // export_audit_evidence ì—†ìŒ
  EXTERNAL_AUDITOR:["export_audit_evidence", "view_lineage",   // â˜… ìœ ì¼í•˜ê²Œ í¬í•¨
                    "view_reports", "export_reports",
                    "view_stats", "view_pmo"],
};
```

---

## 13. DoD (ë³¸ í™”ë©´ ì™„ë£Œ ê¸°ì¤€)

### 13.1 í•„ìˆ˜ í•­ëª©

- [ ] `/audit/evidence` ë¼ìš°íŠ¸ì—ì„œ **AUDIT_EVIDENCE Preset ë‹¨ë…**ìœ¼ë¡œ ë Œë”ë§
- [ ] Route Guard: `export_audit_evidence` Capability ë¯¸ë³´ìœ  ì‹œ `/unauthorized` ë¦¬ë‹¤ì´ë ‰íŠ¸
- [ ] **Preset ì ê¸ˆ**: Preset Switcher ë¹„í™œì„± + "ê°ì‚¬ ì „ìš© í™”ë©´" ì•ˆë‚´ í‘œì‹œ
- [ ] **KPI Row 4ì¢…**: Coverage(%), Missing(ê±´ìˆ˜), Pending(ê±´ìˆ˜), Export Count(íšŸìˆ˜)
- [ ] **Compliance Checklist**: Phaseë³„ ì¦ë¹™ ì¤€ë¹„ ìƒíƒœ (í”„ë¡œê·¸ë ˆìŠ¤ ë°” + ìœ í˜•ë³„ ìƒì„¸)
- [ ] **Evidence List**: ì²´í¬ë°•ìŠ¤ ê¸°ë°˜ ë‹¤ì¤‘ ì„ íƒ + ì „ì²´ ì„ íƒ/í•´ì œ
- [ ] **Evidence Filter Panel**: Phase/ìœ í˜•/ìƒíƒœ/ê¸°ê°„/ê²€ìƒ‰ 5ì¢… í•„í„°
- [ ] **Preview Panel**: ì¦ë¹™ ì„ íƒ ì‹œ Right Panelì— ìƒì„¸ ì •ë³´ + íŒŒì¼ ë¯¸ë¦¬ë³´ê¸°
- [ ] **ZIP Export**: ì„ íƒëœ ì¦ë¹™ì„ ZIP íŒ¨í‚¤ì§€ë¡œ ìƒì„± + ë‹¤ìš´ë¡œë“œ
- [ ] **PDF Export**: ì„ íƒëœ ì¦ë¹™ì„ ë‹¨ì¼ PDF ë¦¬í¬íŠ¸ë¡œ ìƒì„± + ë‹¤ìš´ë¡œë“œ
- [ ] **ë¹„ë™ê¸° Export**: POST 202 Accepted + 3ì´ˆ í´ë§ + ì§„í–‰ë¥  í‘œì‹œ
- [ ] **Export ì§„í–‰ UI**: Right Panelì—ì„œ í•­ëª©ë³„ ì²˜ë¦¬ ìƒíƒœ í‘œì‹œ
- [ ] **Audit Trail**: ëª¨ë“  ì¡°íšŒ/ì„ íƒ/Export/ë‹¤ìš´ë¡œë“œ í–‰ìœ„ ì„œë²„ ìë™ ê¸°ë¡
- [ ] **Read-only ì›ì¹™**: ì¦ë¹™ ìˆ˜ì •/ì‚­ì œ/ì—…ë¡œë“œ ê¸°ëŠ¥ ì¼ì²´ ì—†ìŒ
- [ ] **manifest.json**: ZIP íŒ¨í‚¤ì§€ì— ë©”íƒ€ë°ì´í„° + SHA-256 í•´ì‹œ í¬í•¨
- [ ] **ë‹¤ìš´ë¡œë“œ ë§í¬ ë§Œë£Œ**: 24ì‹œê°„ í›„ 410 Gone + ì¬ìƒì„± ì•ˆë‚´

### 13.2 AI ì—°ë™ í•­ëª©

- [ ] AI Navigationì—ì„œ `audit-evidence` nodeId ì •ìƒ ì¶”ì²œ
- [ ] virtualNode 3ì¢… (missing, phase, pending) ë”¥ë§í¬ ì •ìƒ ë™ì‘
- [ ] AUDIT_EVIDENCE Presetì—ì„œ AI ì¶”ì²œ ëŒ€ìƒ ì œí•œ (AUDIT_NAVIGABLE_NODESë§Œ)
- [ ] ì°¨ë‹¨ëœ í™”ë©´ ì¶”ì²œ ì‹œ audit-evidence fallback ì •ìƒ ë™ì‘

### 13.3 ì—ëŸ¬ ì²˜ë¦¬ í•­ëª©

- [ ] 400 INVALID_EVIDENCE_IDS: ìœ íš¨í•˜ì§€ ì•Šì€ í•­ëª© í‘œì‹œ + ì œê±° ì•ˆë‚´
- [ ] 400 EMPTY_SELECTION: "1ê°œ ì´ìƒ ì„ íƒí•˜ì„¸ìš”" ë©”ì‹œì§€
- [ ] 403 INSUFFICIENT_CAPABILITY: /unauthorized ë¦¬ë‹¤ì´ë ‰íŠ¸
- [ ] 409 EXPORT_IN_PROGRESS: ê¸°ì¡´ Export ìƒíƒœ í˜ì´ì§€ ì´ë™
- [ ] 410 DOWNLOAD_EXPIRED: ë§Œë£Œ ë©”ì‹œì§€ + ì¬ìƒì„± ì•ˆë‚´
- [ ] 500 EXPORT_FAILED: ì¬ì‹œë„ ë²„íŠ¼ + ê´€ë¦¬ì ë¬¸ì˜ ì•ˆë‚´
- [ ] pending ì¦ë¹™ í¬í•¨ Export ì‹œ ê²½ê³  ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ

### 13.4 ë°˜ì‘í˜• í•­ëª©

- [ ] >=1440px: í’€ ë ˆì´ì•„ì›ƒ (SideNav + Main + Right Panel 30%)
- [ ] 1280px: Right Panel -> Drawer (toggle)
- [ ] <=1024px: SideNav ì ‘ê¸° + Drawer (overlay)
- [ ] <=768px: ëª¨ë°”ì¼ ë ˆì´ì•„ì›ƒ (ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ + Full Modal)

### 13.5 ì ‘ê·¼ì„± í•­ëª©

- [ ] WCAG AA ìƒ‰ìƒ ëŒ€ë¹„ (4.5:1 ì´ìƒ)
- [ ] ìŠ¤í¬ë¦° ë¦¬ë”: KPI Card `aria-label` ("ì¦ë¹™ ì»¤ë²„ë¦¬ì§€ 87%")
- [ ] í‚¤ë³´ë“œ: Tab ìˆœíšŒ (Filter -> Checklist -> List -> Export), Enter ì„ íƒ/ì‹¤í–‰
- [ ] ì²´í¬ë°•ìŠ¤: `aria-checked` ìƒíƒœ + `aria-label` ("ìš”ê±´ì •ì˜ì„œ_v3 ì„ íƒ")
- [ ] ìƒíƒœ ìƒ‰ìƒ + í…ìŠ¤íŠ¸ ë¼ë²¨ ë³‘í–‰ (ìƒ‰ë§¹ ëŒ€ì‘)
- [ ] Export ì§„í–‰ ìƒíƒœ: `aria-live="polite"` (ì§„í–‰ë¥  ê°±ì‹  ì‹œ ì•Œë¦¼)

### 13.6 ê°ì‚¬ ë¬´ê²°ì„± í•­ëª© (v2.1)

- [ ] **ìŠ¤ì½”í”„ ìš°íšŒ ì°¨ë‹¨**: JWT `allowedProjectIds` ë²”ìœ„ ë°– projectId ìš”ì²­ ì‹œ 403 `SCOPE_VIOLATION` ë°˜í™˜ í™•ì¸
- [ ] **ì „ì²´ì„ íƒ = ì„œë²„ ì „ì²´**: selectAll ì²´í¬ í›„ Cover Sheet `totalCount`ê°€ API í•„í„° ê²°ê³¼ totalCountì™€ ì¼ì¹˜
- [ ] **PDF ë¶€ë¶„ ì‹¤íŒ¨**: ê°œë³„ íŒŒì¼ ë³€í™˜ ì‹¤íŒ¨ ì‹œ `status: "partial"` + `partialFailure.failedItems` ì •í™• ë°˜í™˜ í™•ì¸
- [ ] **ë‹¤ìš´ë¡œë“œ URL ì¬ë°œê¸‰**: ë§Œë£Œëœ packageIdì— ëŒ€í•´ reissue í˜¸ì¶œ ì‹œ ìƒˆ `downloadUrl` ìˆ˜ì‹  + 6ë²ˆì§¸ í˜¸ì¶œ ì‹œ 429 ë°˜í™˜
- [ ] **manifest ë¬´ê²°ì„±**: ZIP íŒ¨í‚¤ì§€ ë‚´ `manifest.json`ì— `sealedAt`/`selectionHash`/`filterSnapshot` í¬í•¨ + SHA-256 ê²€ì¦ í†µê³¼
- [ ] **í•„í„°-ì„ íƒ ì¼ê´€ì„±**: Export ì™„ë£Œ í›„ `EXPORT_SEALED` ì´ë²¤íŠ¸ì˜ `filterSnapshot`ê³¼ `selectionHash`ê°€ Cover Sheetì— í‘œì‹œëœ ê°’ê³¼ ì¼ì¹˜

---

## ë¶€ë¡ A. Evidence Type ì„¤ì •

```typescript
// config/evidenceTypeConfig.ts

interface EvidenceTypeConfig {
  type: EvidenceType;
  label: string;
  icon: string;
  color: string;
  description: string;
}

const EVIDENCE_TYPE_CONFIG: EvidenceTypeConfig[] = [
  {
    type: "deliverable",
    label: "ì‚°ì¶œë¬¼",
    icon: "DescriptionRounded",
    color: "#1976d2",           // blue
    description: "í”„ë¡œì íŠ¸ ì‚°ì¶œë¬¼ (ì„¤ê³„ì„œ, ìš”ê±´ì„œ, ë³´ê³ ì„œ ë“±)",
  },
  {
    type: "test_result",
    label: "í…ŒìŠ¤íŠ¸ ê²°ê³¼",
    icon: "BugReportRounded",
    color: "#388e3c",           // green
    description: "ë‹¨ìœ„/í†µí•©/ì¸ìˆ˜ í…ŒìŠ¤íŠ¸ ê²°ê³¼ì„œ",
  },
  {
    type: "decision_record",
    label: "ê²°ì • ê¸°ë¡",
    icon: "GavelRounded",
    color: "#f57c00",           // orange
    description: "ì£¼ìš” ì˜ì‚¬ê²°ì • ê¸°ë¡ (ì•„í‚¤í…ì²˜ ë³€ê²½, ë²”ìœ„ ì¡°ì • ë“±)",
  },
  {
    type: "change_history",
    label: "ë³€ê²½ ì´ë ¥",
    icon: "HistoryRounded",
    color: "#7b1fa2",           // purple
    description: "ìš”êµ¬ì‚¬í•­/ì„¤ê³„/ì½”ë“œ ë³€ê²½ ì´ë ¥",
  },
  {
    type: "approval_log",
    label: "ìŠ¹ì¸ ë¡œê·¸",
    icon: "VerifiedRounded",
    color: "#0097a7",           // teal
    description: "ì‚°ì¶œë¬¼/ê²°ì • ìŠ¹ì¸ ê¸°ë¡",
  },
  {
    type: "meeting_minutes",
    label: "íšŒì˜ë¡",
    icon: "GroupsRounded",
    color: "#5d4037",           // brown
    description: "í”„ë¡œì íŠ¸ íšŒì˜ë¡ (ì£¼ê°„íšŒì˜, ì°©ìˆ˜íšŒì˜ ë“±)",
  },
];
```

---

## ë¶€ë¡ B. Evidence Status ì‹œê°í™”

```typescript
// Evidence Status Badge ìƒ‰ìƒ/ì•„ì´ì½˜ ë§¤í•‘

const STATUS_VISUAL: Record<EvidenceStatus, {
  label: string;
  icon: string;
  color: string;
  bgColor: string;
}> = {
  approved: {
    label: "ìŠ¹ì¸",
    icon: "CheckCircle",
    color: "#2e7d32",           // green-800
    bgColor: "#e8f5e9",        // green-50
  },
  pending: {
    label: "ëŒ€ê¸°",
    icon: "HourglassEmpty",
    color: "#f57c00",           // orange-700
    bgColor: "#fff3e0",        // orange-50
  },
  rejected: {
    label: "ë°˜ë ¤",
    icon: "Cancel",
    color: "#c62828",           // red-800
    bgColor: "#ffebee",        // red-50
  },
  missing: {
    label: "ëˆ„ë½",
    icon: "ErrorOutline",
    color: "#ad1457",           // pink-800
    bgColor: "#fce4ec",        // pink-50
  },
};
```

---

## ë¶€ë¡ C. Audit Trail Action ìœ í˜• ì •ì˜

```typescript
/**
 * Audit Trail action types and their logging policies.
 *
 * ALL actions are logged server-side. The frontend does NOT control
 * whether an action is logged -- it only displays the trail.
 */
const AUDIT_TRAIL_ACTIONS = {
  VIEW_LIST: {
    description: "Evidence list viewed",
    logLevel: "INFO",
    includeFilters: true,          // Applied filters are recorded
  },
  VIEW_DETAIL: {
    description: "Evidence detail viewed",
    logLevel: "INFO",
    includeEntityId: true,
  },
  SELECT_EVIDENCE: {
    description: "Evidence item selected/deselected",
    logLevel: "DEBUG",             // High frequency -- DEBUG level
    includeEntityId: true,
  },
  PREVIEW_EVIDENCE: {
    description: "Evidence file previewed",
    logLevel: "INFO",
    includeEntityId: true,
  },
  EXPORT_REQUESTED: {
    description: "Evidence export package requested",
    logLevel: "IMPORTANT",
    includeEntityIds: true,        // All selected evidence IDs
    includeFormat: true,           // zip or pdf
  },
  EXPORT_COMPLETED: {
    description: "Evidence export package completed",
    logLevel: "IMPORTANT",
    includePackageId: true,
    includeFileSize: true,
  },
  EXPORT_FAILED: {
    description: "Evidence export package failed",
    logLevel: "ERROR",
    includeError: true,
  },
  DOWNLOAD_PACKAGE: {
    description: "Evidence package downloaded",
    logLevel: "IMPORTANT",
    includePackageId: true,
  },
  DOWNLOAD_INDIVIDUAL: {
    description: "Individual evidence file downloaded",
    logLevel: "INFO",
    includeEntityId: true,
  },
  // --- v2.1 additions ---
  EXPORT_SEALED: {
    description: "Evidence export package sealed with immutable snapshot",
    logLevel: "CRITICAL",
    includePackageId: true,
    includeFilterSnapshot: true,       // Applied filter at export time
    includeSelectionHash: true,        // SHA-256 of sorted evidence IDs
    includePolicySnapshot: true,       // Policy version + hash
  },
  EXPORT_PARTIAL: {
    description: "Evidence export completed with partial failures",
    logLevel: "WARNING",
    includePackageId: true,
    includePartialFailure: true,       // { successCount, failedCount, failedItems }
  },
  REISSUE_DOWNLOAD_URL: {
    description: "Download URL reissued for existing package",
    logLevel: "IMPORTANT",
    includePackageId: true,
    includeReissueCount: true,         // Current reissue count (max 5)
  },
} as const;

/**
 * v2.1: IP trust chain for audit trail entries.
 * All audit trail entries include ipTrust when available.
 */
interface AuditTrailIpTrust {
  originalIp: string;                  // X-Forwarded-For first hop
  proxyChain: string[];                // Full proxy chain
  trusted: boolean;                    // Matches trusted proxy allowlist
}
```

---

## ë¶€ë¡ D. v1.0 -> v2.0 ë³€ê²½ ì´ë ¥

| ì„¹ì…˜ | ë³€ê²½ | ì‚¬ìœ  |
|------|------|------|
| ì „ì²´ | ì‹ ê·œ ë¬¸ì„œ ì‘ì„± | 00_ì´ê´„ì—ì„œ ë…¸ë“œ ì •ì˜ë§Œ ìˆë˜ ê²ƒì„ í™”ë©´ì„¤ê³„ë¡œ í™•ì¥ |
| 1.2 | 8ê°œ ì„¤ê³„ ì›ì¹™ í™•ì • | Read-only, ë‹¨ì¼ Preset, Audit Trail ë“± |
| 2 ì „ì²´ | MenuOntologyNodeV2 í™•ì¥ | intents 8ê°œ, metrics 5ê°œ, virtualNodes 3ê°œ |
| 2.2 | FilterSpec 5í‚¤ í™•ì • | AI/URL/ë°±ì—”ë“œ í†µí•© í•„í„° |
| 3 ì „ì²´ | panelMode 3ì¢… + ASCII ì™€ì´ì–´í”„ë ˆì„ 3ì¢… | list/preview/export ìƒíƒœë³„ ë ˆì´ì•„ì›ƒ |
| 4 ì „ì²´ | Preset ì „í™˜ ì°¨ë‹¨ ì •ì±… ìƒì„¸í™” | Route Guard + URL ì¡°ì‘ ë°©ì–´ |
| 5 ì „ì²´ | Export ì›Œí¬í”Œë¡œìš° 3ë‹¨ê³„ í™•ì • | í•„í„°->ì„ íƒ->Export + ZIP/PDF êµ¬ì¡° |
| 6 ì „ì²´ | API 7ì¢… í™•ì • | Summary/List/Detail/Export/Status/Trail/Compliance |
| 7 ì „ì²´ | ì»´í¬ë„ŒíŠ¸ 31ê°œ ë¶„í•´ | í´ë” êµ¬ì¡° + ì˜ì¡´ì„± íŠ¸ë¦¬ + Hook 4ì¢… |
| 8 ì „ì²´ | AI Navigation ê·œì¹™ í™•ì • | AUDIT_NAVIGABLE_NODES + fallback + AI Insight |
| 9 ì „ì²´ | ì¸í„°ë™ì…˜ 8ì¢… ìƒì„¸ | í•„í„°/ì„ íƒ/ë¯¸ë¦¬ë³´ê¸°/Export/Checklist/KPI/Trail/ìƒˆë¡œê³ ì¹¨ |
| 10 ì „ì²´ | ë°˜ì‘í˜• 4ë‹¨ê³„ + ëª¨ë°”ì¼ ì™€ì´ì–´í”„ë ˆì„ | 1440/1280/1024/768 |
| 11 ì „ì²´ | ê¹¨ì§€ê¸° ì‰¬ìš´ ê³³ 6ì¢… | íƒ€ì„ì•„ì›ƒ/ë§Œë£Œ/ì¶©ëŒ/ë¬´ê²°ì„±/Presetìš°íšŒ/ë¯¸ìŠ¹ì¸ê²½ê³  |
| 12 ì „ì²´ | Capability 4ì¤‘ ë°©ì–´ ì ìš© | Menu/Route/Action/Backend |
| 13 ì „ì²´ | DoD 5ê°œ ì¹´í…Œê³ ë¦¬ | í•„ìˆ˜/AI/ì—ëŸ¬/ë°˜ì‘í˜•/ì ‘ê·¼ì„± |

---

## ë¶€ë¡ E. v2.0 -> v2.1 ë³€ê²½ ì´ë ¥

| ì„¹ì…˜ | ë³€ê²½ | ì‚¬ìœ  |
|------|------|------|
| 1.2 | ì„¤ê³„ ì›ì¹™ 9ê°œ ì¶”ê°€ | Seal, Cover Sheet, ì„œë²„ ìŠ¤ì½”í”„, Audit Trail ì›ì ì´ë²¤íŠ¸, ì»¤ë²„ë¦¬ì§€ 2ë¶„í™”, ì „ì²´ì„ íƒ ì •ì±…, PDF ë¶€ë¶„ ì‹¤íŒ¨, URL ì¬ë°œê¸‰, IP ì‹ ë¢° |
| 2.2 | dateRange ì •ê·œí™” ê·œì¹™ + DeserializeResult ì¸í„°í˜ì´ìŠ¤ ì¶”ê°€ | URL ì—­ì§ë ¬í™” ì‹œ ìœ íš¨í•˜ì§€ ì•Šì€ í•„í„° í‚¤ ëˆ„ë½ ë°©ì–´ |
| 3.1 | panelMode `confirm` ì¶”ê°€ | Cover Sheet í™•ì¸ ë‹¨ê³„ë¥¼ ìœ„í•œ ìƒˆ íŒ¨ë„ ëª¨ë“œ |
| 5.1 | 3ë‹¨ê³„ â†’ 4ë‹¨ê³„ í”Œë¡œìš° (Filterâ†’Selectâ†’Cover Sheetâ†’Export) | ì œì¶œ ì „ í™•ì¸ ë‹¨ê³„ ì‚½ì… |
| 5.2 | selectAll ì •ì±… + serverTotalCount ì¶”ê°€ | ì „ì²´ì„ íƒ = ì„œë²„ ì „ì²´ ê¸°ì¤€ ëª…ì‹œ |
| 5.5 | manifest.jsonì— filterSnapshot/policySnapshot/sealedAt/sealedBy/selectionHash ì¶”ê°€ | íŒ¨í‚¤ì§€ ë´‰ì¸(Seal) ë©”íƒ€ë°ì´í„° |
| 5.6 | pending ë±ƒì§€ + PDF ë¶€ë¶„ ì‹¤íŒ¨ ì •ì±… (50% ì„ê³„ê°’) | ë¯¸ìŠ¹ì¸ ì‹ë³„ + ë¶€ë¶„ ì‹¤íŒ¨ í—ˆìš© |
| 5.7 ì‹ ê·œ | Export Cover Sheet ì„¹ì…˜ (ì™€ì´ì–´í”„ë ˆì„ + Props + Warning ì¸í„°í˜ì´ìŠ¤) | ì œì¶œ ë²”ìœ„ í™•ì¸ UX |
| 6.1 | evidenceCoverage â†’ submissionReadyCoverage + inProgressCoverage ë¶„ë¦¬ | ê°ì‚¬ ì œì¶œ ì¤€ë¹„ ìƒíƒœì™€ ì§„í–‰ ìƒíƒœ êµ¬ë¶„ |
| 6.4.2 | ExportStatusResponseì— seal í•„ë“œ + partialFailure + status "partial" ì¶”ê°€ | ë´‰ì¸ + ë¶€ë¶„ ì‹¤íŒ¨ ì§€ì› |
| 6.4.5 ì‹ ê·œ | ë‹¤ìš´ë¡œë“œ URL ì¬ë°œê¸‰ ì—”ë“œí¬ì¸íŠ¸ (POST /:packageId/reissue) | ë§Œë£Œ í›„ íŒ¨í‚¤ì§€ ì¬ìƒì„± ì—†ì´ URLë§Œ ì¬ë°œê¸‰ |
| 6.5 | Audit Trail action 3ì¢… ì¶”ê°€ (EXPORT_SEALED, EXPORT_PARTIAL, REISSUE_DOWNLOAD_URL) + ipTrust | ê°ì‚¬ ì¶”ì  ê°•í™” + IP ì‹ ë¢° ê³„ì¸µ |
| 7 | ExportCoverSheet.tsx ì»´í¬ë„ŒíŠ¸ ì¶”ê°€ + íŠ¸ë¦¬/ë Œë”ë§ ë¡œì§ ê°±ì‹  | Cover Sheet UI ì§€ì› |
| 8.2-8.3 | AI Navigation fallbackì— blockedReason UX í…ìŠ¤íŠ¸ ì¶”ê°€ | ì°¨ë‹¨ ì‚¬ìœ  ëª…ì‹œ |
| 9.4 | Export í”Œë¡œìš°ì— Cover Sheet í™•ì¸ ë‹¨ê³„ + ë¶€ë¶„ ì‹¤íŒ¨ + URL ì¬ë°œê¸‰ í”Œë¡œìš° ì‚½ì… | 4ë‹¨ê³„ ì›Œí¬í”Œë¡œìš° ë°˜ì˜ |
| 11 | ê¹¨ì§€ê¸° ì‰¬ìš´ ê³³ 4ì¢… ì¶”ê°€ (PDF ë¶€ë¶„ ì‹¤íŒ¨, ìŠ¤ì½”í”„ ìš°íšŒ, ì „ì²´ì„ íƒ í˜¼ë™, URL ì¬ë°œê¸‰ ë‚¨ìš©) | v2.1 ì‹ ê·œ ìœ„í—˜ í•­ëª© |
| 12.5 ì‹ ê·œ | ì„œë²„ ìŠ¤ì½”í”„ ê°•ì œ (JWT allowedProjectIds/allowedDateRange êµì°¨ê²€ì¦) | ë°±ì—”ë“œ ìŠ¤ì½”í”„ ë°©ì–´ |
| 13.6 ì‹ ê·œ | ê°ì‚¬ ë¬´ê²°ì„± DoD 6ì¢… (ìŠ¤ì½”í”„ ìš°íšŒ, ì „ì²´ì„ íƒ, PDF ë¶€ë¶„ ì‹¤íŒ¨, URL ì¬ë°œê¸‰, manifest, í•„í„°-ì„ íƒ ì¼ê´€ì„±) | ê°ì‚¬ íŠ¹í™” í…ŒìŠ¤íŠ¸ |
| ë¶€ë¡ C | EXPORT_SEALED/EXPORT_PARTIAL/REISSUE_DOWNLOAD_URL + AuditTrailIpTrust ì¶”ê°€ | Audit Trail action ì •ì˜ í™•ì¥ |
