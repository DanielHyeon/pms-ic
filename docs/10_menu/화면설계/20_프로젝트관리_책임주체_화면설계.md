# 20. 프로젝트 관리 화면설계 (책임 주체 정의 / Authority Anchor)

> 작성일: 2026-02-09
> 버전: v1.0
> 라우트: `/project-management`
> 필요 Capability: `view_project`, `edit_project_accountability`
> 기본 Preset: `PM_WORK`
> 노드 역할: **Action** (액션 노드 — 책임 주체 지정·변경 전용)
> DB 설계: [20_22_DB설계_권한거버넌스.md §1](20_22_DB설계_권한거버넌스.md) (Postgres `governance` schema)

---

## 1. 화면 개요

### 1.1 목적

프로젝트 관리 화면의 존재 이유는 단 하나다.

> **"이 프로젝트에서 최종 책임자는 누구인가?"**

여기서 말하는 책임은:
- 작업 책임 (Task Responsibility) — **아님**
- 실행 권한 (Execution Authority) — **아님**
- **의사결정 책임 (Accountability)** — **이것만 해당**

이 화면은 **권한이 흘러가기 시작하는 '원천(Authority Anchor)'**이지,
사람을 배치하거나 역할을 설계하는 곳이 아니다.

> **핵심 원칙**: "이 화면에서 권한은 절대 생기지 않는다."
> 여기서는 **책임의 꼭대기를 고정**하고,
> 이후 모든 권한 위임의 **출발점**만 정의한다.

### 1.2 설계 원칙

| 원칙 | 설명 |
|------|------|
| **책임 단일성** | 반드시 1명의 Primary PM이 존재해야 하며, PM 공백은 불가 |
| **최소 편집** | 이 화면에서 편집 가능한 항목은 오직 **책임 주체 변경**뿐 |
| **변경 추적** | PM 변경 시 변경자·변경 사유·변경 시점이 반드시 기록됨 |
| **연결만 제공** | 파트·역할·권한 정보는 Read-only로 요약만 표시, 편집은 해당 메뉴로 이동 |
| **감사 대비** | 책임 변경 이력은 감사/분쟁 대비용으로 영구 보존 |
| **권한 불간섭** | 사용자 다수 할당, 파트 배정, 역할/권한 부여, 위임 생성 일체 불가 |

### 1.3 핵심 질문 → 화면 요소 매핑

| 사용자 질문 | 화면 요소 | 동작 |
|-----------|----------|------|
| "이 프로젝트 PM이 누구야?" | 책임 주체 영역 | PM(Primary) 표시 |
| "PM을 변경하고 싶어" | PM 변경 버튼 | 변경 모달 (사유 입력 필수) |
| "PM 변경 이력 보여줘" | 변경 이력 섹션 | 타임라인 표시 |
| "프로젝트 스폰서가 누구야?" | 책임 주체 영역 | Sponsor 표시 |
| "파트가 몇 개야?" | 연결 정보 (Read-only) | 숫자 표시 + 파트 관리 이동 링크 |
| "권한 위임 현황 보여줘" | 연결 정보 (Read-only) | 건수 표시 + 역할/권한 관리 이동 링크 |

---

## 2. MenuOntology 노드

### 2.1 타입 확정

| 항목 | 값 | 비고 |
|------|-----|------|
| `nodeId` | `project-management` | 단일 노드 |
| `domain` | `"project"` | 프로젝트 도메인 |
| `nodeRole` | `"action"` | 책임 주체 지정/변경 (행동 질문에 +10 가산) |
| `entities` | `"Project"`, `"User"` | 관련 엔티티 |
| `requiredCaps` | `["view_project"]` | 조회 최소 권한 |
| `editCaps` | `["edit_project_accountability"]` | 편집 권한 (PM/PMO만) |

### 2.2 MenuOntologyNode 정의

```typescript
const projectManagementNode: MenuOntologyNode = {
  nodeId: "project-management",
  label: "프로젝트 관리",
  route: "/project-management",
  icon: "FolderKanban",
  domain: "project",
  nodeRole: "action",
  entities: ["Project", "User"],
  requiredCaps: ["view_project"],

  intents: [
    "accountability",         // 책임 주체 관련
    "pm_assignment",          // PM 지정/변경
    "project_overview",       // 프로젝트 개요
    "responsibility_history", // 책임 변경 이력
  ],

  keywords: [
    "PM", "프로젝트 매니저", "책임자", "스폰서", "공동PM",
    "PM 변경", "책임 이력", "프로젝트 관리",
  ],

  scopeKeys: ["project"],

  suggestedActions: [
    {
      actionId: "change-pm",
      label: "PM 변경",
      requiredCaps: ["edit_project_accountability"],
      route: "/project-management",
    },
    {
      actionId: "view-accountability-log",
      label: "책임 변경 이력 보기",
      requiredCaps: ["view_project"],
      route: "/project-management",
    },
    {
      actionId: "go-to-role-permission",
      label: "역할/권한 관리로 이동",
      requiredCaps: ["view_role_permission"],
      route: "/role-permission",
    },
  ],

  deepLinks: {
    patterns: ["/project-management/:projectId"],
  },
};
```

---

## 3. 허용/금지 행위 매트릭스

### 3.1 허용 행위 (Do)

| 행위 | 상세 | 필요 Capability |
|------|------|----------------|
| 프로젝트 목록 조회 | 참여 중인 프로젝트 목록 표시 | `view_project` |
| 책임 주체 조회 | PM / 공동 PM / Sponsor 정보 표시 | `view_project` |
| PM 변경 | Primary PM 교체 (사유 입력 필수) | `edit_project_accountability` |
| 공동 PM 지정/해제 | 공동 PM 추가 또는 제거 | `edit_project_accountability` |
| Sponsor 지정/변경 | 승인 책임자 지정 또는 변경 | `edit_project_accountability` |
| 변경 이력 조회 | 책임 주체 변경 타임라인 조회 | `view_project` |
| 연결 정보 조회 | 파트 수, 사용자 수, 위임 건수 (Read-only) | `view_project` |

### 3.2 금지 행위 (Do Not)

| 금지 항목 | 사유 | 대신 사용할 메뉴 |
|----------|------|----------------|
| 사용자 다수 할당 | 책임 주체 화면의 범위 초과 | 파트 관리 |
| 파트 생성/배정 | 조직 구조는 파트 관리의 책임 | 파트 관리 |
| 역할 부여 | 역할은 권한 관리의 책임 | 역할 및 권한 관리 |
| 권한(Capability) 부여 | 권한은 한 곳에서만 관리 | 역할 및 권한 관리 |
| 위임 생성/수정 | 위임은 권한 관리의 책임 | 역할 및 권한 관리 |
| SoD 검증 | 거버넌스 검증은 권한 관리의 책임 | 역할 및 권한 관리 |

---

## 4. 핵심 엔티티 & 데이터 모델

### 4.1 관련 엔티티

```
Project ──1:1──▶ PrimaryPM (User)
        ──0:1──▶ CoPM (User)
        ──0:1──▶ Sponsor (User)
        ──1:N──▶ AccountabilityChangeLog
```

### 4.2 책임 주체 (ProjectAccountability)

```typescript
interface ProjectAccountability {
  projectId: string;

  /** Primary PM - 반드시 1명, null 불가 */
  primaryPmId: string;
  primaryPmName: string;

  /** 공동 PM - 선택 */
  coPmId?: string;
  coPmName?: string;

  /** Sponsor / 승인 책임자 - 선택 */
  sponsorId?: string;
  sponsorName?: string;
}
```

### 4.3 책임 변경 이력 (AccountabilityChangeLog)

```typescript
interface AccountabilityChangeLog {
  id: string;
  projectId: string;
  changeType: "PM_CHANGE" | "CO_PM_CHANGE" | "SPONSOR_CHANGE";

  /** 변경 전 */
  previousUserId: string;
  previousUserName: string;

  /** 변경 후 */
  newUserId: string;
  newUserName: string;

  /** 변경 메타 */
  changedBy: string;        // 변경을 수행한 사용자
  changedByName: string;
  changeReason: string;     // 변경 사유 (필수)
  changedAt: string;        // ISO 8601
}
```

### 4.4 연결 정보 (ProjectConnectionSummary)

```typescript
interface ProjectConnectionSummary {
  projectId: string;
  partCount: number;           // 파트 수
  totalUserCount: number;      // 총 사용자 수
  activeDelegationCount: number; // 활성 권한 위임 건수
}
```

### 4.5 DB 스키마 매핑

> 상세 DDL/인덱스/뷰는 [20_22_DB설계_권한거버넌스.md](20_22_DB설계_권한거버넌스.md) 참조.

| TypeScript 엔티티 | Postgres 테이블 | Schema | 비고 |
|-------------------|----------------|--------|------|
| `ProjectAccountability` | `governance.project_accountability` | governance | 현재 상태 (mutable, PK=project_id) |
| `AccountabilityChangeLog` | `governance.accountability_change_log` | governance | 불변 이력 (append-only) |
| `ProjectConnectionSummary` | 계산 쿼리 (§7.5) | governance + organization | parts/memberships/delegations 집계 |

**핵심 제약조건:**
- `project_accountability.primary_pm_user_id NOT NULL` — PM 공백 불가 (DB 레벨 보장)
- `accountability_change_log.change_reason NOT NULL` — 변경 사유 필수 (DB 레벨 보장)
- Neo4j 동기: PM 변경 시 `(:User)-[:PRIMARY_PM_OF]->(:Project)` 관계 갱신 (Outbox 이벤트)

---

## 5. 화면 레이아웃

### 5.1 전체 구조

```
┌─────────────────────────────────────────────────────────┐
│  [Header] 프로젝트 관리                                    │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─────────────────────────────────────────────────┐    │
│  │  프로젝트 기본 정보                                │    │
│  │                                                   │    │
│  │  프로젝트명:  AI 보험심사 처리 시스템               │    │
│  │  기간:       2025.10 ~ 2026.06                   │    │
│  │  상태:       진행중                                │    │
│  └─────────────────────────────────────────────────┘    │
│                                                         │
│  ┌─────────────────────────────────────────────────┐    │
│  │  책임 주체                          [PM 변경]     │    │
│  │  ─────────────────────────────────────────────   │    │
│  │                                                   │    │
│  │  PM (Primary)  :  홍길동                          │    │
│  │  공동 PM       :  없음                            │    │
│  │  Sponsor       :  김OO                           │    │
│  │                                                   │    │
│  │  ⓘ PM은 반드시 1명 이상 지정되어야 합니다.         │    │
│  └─────────────────────────────────────────────────┘    │
│                                                         │
│  ┌─────────────────────────────────────────────────┐    │
│  │  책임 변경 이력                     [전체 보기]    │    │
│  │  ─────────────────────────────────────────────   │    │
│  │                                                   │    │
│  │  ● 2025.11.02  PM 변경                           │    │
│  │    박OO → 홍길동                                   │    │
│  │    사유: 조직 개편에 따른 PM 교체                    │    │
│  │    변경자: 김OO (PMO)                              │    │
│  │                                                   │    │
│  │  ● 2025.10.01  최초 지정                          │    │
│  │    PM: 박OO                                       │    │
│  │    변경자: 시스템                                   │    │
│  └─────────────────────────────────────────────────┘    │
│                                                         │
│  ┌─────────────────────────────────────────────────┐    │
│  │  연결 정보 (Read-only)                             │    │
│  │  ─────────────────────────────────────────────   │    │
│  │                                                   │    │
│  │  파트 수       :  4                               │    │
│  │  총 사용자 수   :  23                              │    │
│  │  활성 위임 건수  :  7건                             │    │
│  │                                                   │    │
│  │  → 파트 관리로 이동                                │    │
│  │  → 역할 및 권한 관리로 이동                         │    │
│  └─────────────────────────────────────────────────┘    │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 5.2 프로젝트 목록 화면

프로젝트를 선택하기 전, 참여 중인 프로젝트 목록을 보여준다.

```
┌─────────────────────────────────────────────────────────┐
│  [Header] 프로젝트 관리                                    │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌──────────────────────────────────────────┐            │
│  │  AI 보험심사 처리 시스템                     │            │
│  │  PM: 홍길동  |  Sponsor: 김OO             │            │
│  │  상태: 진행중                              │            │
│  │  ─────────────────────────────────        │            │
│  │  파트: 4  |  사용자: 23  |  위임: 7건      │            │
│  └──────────────────────────────────────────┘            │
│                                                         │
│  ┌──────────────────────────────────────────┐            │
│  │  모바일 보험 플랫폼                         │            │
│  │  PM: 이OO  |  Sponsor: 없음               │            │
│  │  상태: 진행중                              │            │
│  │  ─────────────────────────────────        │            │
│  │  파트: 3  |  사용자: 15  |  위임: 3건      │            │
│  └──────────────────────────────────────────┘            │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## 6. PM 변경 플로우

### 6.1 변경 모달

```
┌──────────────────────────────────────────┐
│  PM 변경                           [✕]   │
├──────────────────────────────────────────┤
│                                          │
│  현재 PM:  홍길동                         │
│                                          │
│  새로운 PM:  [사용자 검색 ▾]              │
│              _________________________   │
│                                          │
│  변경 사유 (필수):                         │
│  ┌────────────────────────────────────┐   │
│  │                                    │   │
│  │                                    │   │
│  └────────────────────────────────────┘   │
│                                          │
│  ⚠ PM 변경 시 기존 PM의 프로젝트 수준      │
│    책임이 새 PM으로 이전됩니다.             │
│    기존 PM의 역할/권한은 변경되지 않습니다.  │
│    권한 조정은 '역할 및 권한 관리'에서       │
│    별도로 수행해 주세요.                    │
│                                          │
│         [취소]     [PM 변경 확인]          │
└──────────────────────────────────────────┘
```

### 6.2 변경 프로세스

```
PM 변경 요청
    │
    ▼
┌─────────────────────┐
│ 사유 입력 확인       │──── 사유 미입력 → 저장 불가
└─────────────────────┘
    │
    ▼
┌─────────────────────┐
│ 신규 PM 유효성 검증  │──── 비활성 사용자 → 경고
└─────────────────────┘
    │
    ▼
┌─────────────────────┐
│ 변경 이력 기록       │
│ - 변경자 ID         │
│ - 변경 사유         │
│ - 변경 시점         │
│ - 이전 PM / 신규 PM │
└─────────────────────┘
    │
    ▼
┌─────────────────────┐
│ 알림 발송            │
│ - 신규 PM           │
│ - 이전 PM           │
│ - PMO               │
└─────────────────────┘
    │
    ▼
  완료
```

### 6.3 변경 규칙

| 규칙 | 설명 |
|------|------|
| PM 공백 불가 | Primary PM은 반드시 1명 존재해야 함. 삭제만 불가, 교체만 가능 |
| 사유 필수 | 변경 사유를 입력하지 않으면 저장할 수 없음 |
| 자기 자신 불가 | 현재 PM과 동일한 사용자로 변경 불가 |
| 비활성 사용자 불가 | 비활성(disabled) 상태의 사용자를 PM으로 지정할 수 없음 |
| 권한 불변 | PM 변경이 기존 PM의 역할/권한을 자동으로 변경하지 않음 |
| 알림 자동 발송 | 변경 완료 시 관련자에게 알림 자동 발송 |

---

## 7. Preset별 화면 분기

| Preset | 노출 요소 | 편집 가능 여부 |
|--------|---------|-------------|
| `EXEC_SUMMARY` | 책임 주체 (Read-only), 연결 정보 요약 | 편집 불가 |
| `PMO_CONTROL` | 전체 표시, PM 변경 버튼 노출 | PM 변경 가능 |
| `PM_WORK` | 전체 표시, PM 변경 버튼 노출 | PM 변경 가능 (본인 제외) |
| `DEV_EXECUTION` | 책임 주체 (Read-only) | 편집 불가 |
| `CUSTOMER_APPROVAL` | 책임 주체 (Read-only), Sponsor 정보 강조 | 편집 불가 |
| `AUDIT_EVIDENCE` | 전체 표시 (Read-only), 변경 이력 강조 | 편집 불가 |

---

## 8. API 명세

### 8.1 책임 주체 조회

```
GET /api/projects/{projectId}/accountability

Response 200:
{
  "projectId": "uuid",
  "primaryPm": { "id": "uuid", "name": "홍길동", "email": "..." },
  "coPm": null,
  "sponsor": { "id": "uuid", "name": "김OO", "email": "..." },
  "connectionSummary": {
    "partCount": 4,
    "totalUserCount": 23,
    "activeDelegationCount": 7
  }
}
```

### 8.2 PM 변경

```
PUT /api/projects/{projectId}/accountability/pm

Request:
{
  "newPmId": "uuid",
  "changeReason": "조직 개편에 따른 PM 교체"
}

Response 200:
{
  "success": true,
  "changeLog": {
    "id": "uuid",
    "changeType": "PM_CHANGE",
    "previousUserId": "uuid",
    "newUserId": "uuid",
    "changedBy": "uuid",
    "changeReason": "조직 개편에 따른 PM 교체",
    "changedAt": "2025-11-02T10:30:00Z"
  }
}

Response 400 (사유 미입력):
{ "error": "REASON_REQUIRED", "message": "변경 사유는 필수입니다." }

Response 400 (동일 사용자):
{ "error": "SAME_USER", "message": "현재 PM과 동일한 사용자입니다." }
```

### 8.3 변경 이력 조회

```
GET /api/projects/{projectId}/accountability/history?page=0&size=20

Response 200:
{
  "content": [
    {
      "id": "uuid",
      "changeType": "PM_CHANGE",
      "previousUserName": "박OO",
      "newUserName": "홍길동",
      "changedByName": "김OO",
      "changeReason": "조직 개편에 따른 PM 교체",
      "changedAt": "2025-11-02T10:30:00Z"
    }
  ],
  "totalElements": 2,
  "totalPages": 1
}
```

---

## 9. 컴포넌트 설계

### 9.1 컴포넌트 트리

```
ProjectManagementPage
├── ProjectListView                    # 프로젝트 목록 (선택 전)
│   └── ProjectCard                    # 프로젝트 카드
│       └── ConnectionBadge            # 파트/사용자/위임 건수
├── ProjectAccountabilityView          # 프로젝트 상세 (선택 후)
│   ├── ProjectBasicInfo               # 기본 정보 (Read-only)
│   ├── AccountabilitySection          # 책임 주체 영역
│   │   ├── PmDisplay                  # PM 표시
│   │   ├── CoPmDisplay                # 공동 PM 표시
│   │   ├── SponsorDisplay             # Sponsor 표시
│   │   └── ChangePmButton             # PM 변경 버튼 (권한 있을 때만)
│   ├── AccountabilityHistoryTimeline  # 변경 이력 타임라인
│   │   └── HistoryItem                # 이력 항목
│   └── ConnectionInfoPanel            # 연결 정보 (Read-only)
│       ├── StatBadge                  # 파트/사용자/위임 수치
│       └── NavigationLink             # 다른 메뉴 이동 링크
└── ChangePmModal                      # PM 변경 모달
    ├── CurrentPmInfo                  # 현재 PM 정보
    ├── UserSearchInput                # 사용자 검색
    ├── ReasonTextarea                 # 변경 사유 (필수)
    └── ImpactWarning                  # 영향 안내 메시지
```

### 9.2 상태 관리

```typescript
interface ProjectManagementState {
  /** 프로젝트 목록 */
  projects: ProjectSummary[];

  /** 선택된 프로젝트 ID */
  selectedProjectId: string | null;

  /** 책임 주체 정보 */
  accountability: ProjectAccountability | null;

  /** 변경 이력 */
  changeHistory: AccountabilityChangeLog[];

  /** 연결 정보 */
  connectionSummary: ProjectConnectionSummary | null;

  /** PM 변경 모달 */
  isChangePmModalOpen: boolean;
}
```

---

## 10. 메뉴 간 연결 관계

### 10.1 이 화면에서 다른 화면으로

| 대상 메뉴 | 연결 방식 | 용도 |
|----------|---------|------|
| 파트 관리 | Read-only 링크 | "파트 수: 4 → 파트 관리로 이동" |
| 역할 및 권한 관리 | Read-only 링크 | "활성 위임 건수: 7건 → 역할 및 권한 관리로 이동" |

### 10.2 다른 화면에서 이 화면으로

| 출발 메뉴 | 연결 방식 | 용도 |
|----------|---------|------|
| 역할 및 권한 관리 | 위임 맵 상단 | "PM (Primary): 홍길동 → 프로젝트 관리로 이동" |
| 파트 관리 | 프로젝트 정보 영역 | "프로젝트 PM: 홍길동 → 프로젝트 관리로 이동" |

---

## 11. 접근 제어

### 11.1 Capability 기반 제어

| 동작 | 필요 Capability | 비고 |
|------|----------------|------|
| 프로젝트 목록 조회 | `view_project` | 참여 중인 프로젝트만 |
| 책임 주체 조회 | `view_project` | 해당 프로젝트 소속 사용자 |
| PM 변경 | `edit_project_accountability` | PM, PMO만 |
| 공동 PM 지정 | `edit_project_accountability` | PM, PMO만 |
| Sponsor 변경 | `edit_project_accountability` | PM, PMO만 |
| 변경 이력 조회 | `view_project` | 해당 프로젝트 소속 사용자 |

### 11.2 라우트 가드

```typescript
{
  path: "/project-management",
  component: ProjectManagementPage,
  guard: {
    requiredCaps: ["view_project"],
    fallback: "/dashboard",
  },
}
```

---

## 12. 핵심 UX 원칙 요약

| 번호 | 원칙 | 설명 |
|------|------|------|
| 1 | **보여주기 + 이동만** | 다른 메뉴의 정보는 Read-only 요약 + 이동 링크 |
| 2 | **편집은 딱 하나** | PM / 공동PM / Sponsor 변경만 가능 |
| 3 | **사유 없으면 변경 없음** | 변경 사유가 없으면 저장 버튼 비활성화 |
| 4 | **권한 경계 명확** | "권한은 이 화면에서 다루지 않습니다" 안내 표시 |
| 5 | **감사 추적 완결** | 누가, 왜, 언제 변경했는지 항상 기록 |
